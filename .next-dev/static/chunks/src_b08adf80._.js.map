{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/RequireAuth.tsx"],"sourcesContent":["// src/components/RequireAuth.tsx\r\n'use client';\r\n\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useEffect, useState } from 'react';\r\nimport { z } from 'zod';\r\n\r\nconst VALID_ROLES = ['buyer', 'seller', 'admin'] as const;\r\ntype ValidRole = (typeof VALID_ROLES)[number];\r\n\r\nconst RoleSchema = z.enum(VALID_ROLES);\r\n\r\nexport default function RequireAuth({\r\n  role,\r\n  children,\r\n}: {\r\n  role: ValidRole;\r\n  children: React.ReactNode;\r\n}) {\r\n  const { user, isAuthReady } = useAuth();\r\n  const router = useRouter();\r\n  const [authorized, setAuthorized] = useState(false);\r\n  const [hasChecked, setHasChecked] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!isAuthReady || hasChecked) return;\r\n\r\n    // Runtime validation of `role` prop (dev-only noise)\r\n    const parsed = RoleSchema.safeParse(role);\r\n    if (!parsed.success) {\r\n      if (process.env.NODE_ENV === 'development') {\r\n        console.warn('[RequireAuth] Invalid role prop supplied:', role);\r\n      }\r\n      router.push('/login');\r\n      setHasChecked(true);\r\n      return;\r\n    }\r\n\r\n    const userRole = user?.role as ValidRole | undefined;\r\n\r\n    // NEW: strict role matching — no admin override for buyer/seller routes\r\n    let hasAccess = false;\r\n    if (parsed.data === 'admin') {\r\n      hasAccess = userRole === 'admin';\r\n    } else {\r\n      hasAccess = userRole === parsed.data; // admin can’t view buyer/seller pages\r\n    }\r\n\r\n    if (!user || !hasAccess) {\r\n      router.push('/login');\r\n    } else {\r\n      setAuthorized(true);\r\n    }\r\n\r\n    setHasChecked(true);\r\n  }, [isAuthReady, user, role, router, hasChecked]);\r\n\r\n  if (!isAuthReady || !hasChecked) {\r\n    return (\r\n      <div className=\"min-h-screen bg-black flex items-center justify-center\" role=\"status\" aria-label=\"Checking access\">\r\n        <div className=\"flex items-center space-x-2\">\r\n          <div className=\"w-4 h-4 bg-[#ff950e] rounded-full animate-pulse\" />\r\n          <div className=\"w-4 h-4 bg-[#ff950e] rounded-full animate-pulse\" style={{ animationDelay: '0.2s' }} />\r\n          <div className=\"w-4 h-4 bg-[#ff950e] rounded-full animate-pulse\" style={{ animationDelay: '0.4s' }} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!authorized) return null;\r\n\r\n  return <>{children}</>;\r\n}\r\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;AA+BvB;;AA5BV;AACA;AACA;AACA;;;AALA;;;;;AAOA,MAAM,cAAc;IAAC;IAAS;IAAU;CAAQ;AAGhD,MAAM,aAAa,qKAAA,CAAA,IAAC,CAAC,IAAI,CAAC;;AAEX,SAAS,YAAY,KAMnC;QANmC,EAClC,IAAI,EACJ,QAAQ,EAIT,GANmC;;IAOlC,MAAM,EAAE,IAAI,EAAE,WAAW,EAAE,GAAG,CAAA,GAAA,iIAAA,CAAA,UAAO,AAAD;IACpC,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAE7C,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;iCAAE;YACR,IAAI,CAAC,eAAe,YAAY;YAEhC,qDAAqD;YACrD,MAAM,SAAS,WAAW,SAAS,CAAC;YACpC,IAAI,CAAC,OAAO,OAAO,EAAE;gBACnB,wCAA4C;oBAC1C,QAAQ,IAAI,CAAC,6CAA6C;gBAC5D;gBACA,OAAO,IAAI,CAAC;gBACZ,cAAc;gBACd;YACF;YAEA,MAAM,WAAW,iBAAA,2BAAA,KAAM,IAAI;YAE3B,wEAAwE;YACxE,IAAI,YAAY;YAChB,IAAI,OAAO,IAAI,KAAK,SAAS;gBAC3B,YAAY,aAAa;YAC3B,OAAO;gBACL,YAAY,aAAa,OAAO,IAAI,EAAE,sCAAsC;YAC9E;YAEA,IAAI,CAAC,QAAQ,CAAC,WAAW;gBACvB,OAAO,IAAI,CAAC;YACd,OAAO;gBACL,cAAc;YAChB;YAEA,cAAc;QAChB;gCAAG;QAAC;QAAa;QAAM;QAAM;QAAQ;KAAW;IAEhD,IAAI,CAAC,eAAe,CAAC,YAAY;QAC/B,qBACE,6LAAC;YAAI,WAAU;YAAyD,MAAK;YAAS,cAAW;sBAC/F,cAAA,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;;;;;kCACf,6LAAC;wBAAI,WAAU;wBAAkD,OAAO;4BAAE,gBAAgB;wBAAO;;;;;;kCACjG,6LAAC;wBAAI,WAAU;wBAAkD,OAAO;4BAAE,gBAAgB;wBAAO;;;;;;;;;;;;;;;;;IAIzG;IAEA,IAAI,CAAC,YAAY,OAAO;IAExB,qBAAO;kBAAG;;AACZ;GA5DwB;;QAOQ,iIAAA,CAAA,UAAO;QACtB,qIAAA,CAAA,YAAS;;;MARF","debugId":null}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/utils/cloudinary.ts"],"sourcesContent":["// src/utils/cloudinary.ts\r\n\r\n// Cloudinary configuration\r\nconst CLOUD_NAME = process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME || '';\r\nconst UPLOAD_PRESET = process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET || '';\r\n\r\n// Check if Cloudinary is properly configured\r\nconst isCloudinaryConfigured = () => {\r\n  return CLOUD_NAME && \r\n         UPLOAD_PRESET && \r\n         CLOUD_NAME !== 'your_cloud_name' && \r\n         UPLOAD_PRESET !== 'your_upload_preset';\r\n};\r\n\r\n// Mock image URLs for development\r\nconst MOCK_IMAGE_URLS = [\r\n  'https://picsum.photos/400/600?random=1',\r\n  'https://picsum.photos/400/600?random=2',\r\n  'https://picsum.photos/400/600?random=3',\r\n  'https://picsum.photos/400/600?random=4',\r\n  'https://picsum.photos/400/600?random=5',\r\n  'https://picsum.photos/400/600?random=6',\r\n  'https://picsum.photos/400/600?random=7',\r\n  'https://picsum.photos/400/600?random=8',\r\n  'https://picsum.photos/400/600?random=9',\r\n  'https://picsum.photos/400/600?random=10',\r\n];\r\n\r\n// Types\r\nexport interface CloudinaryUploadResult {\r\n  url: string;\r\n  publicId: string;\r\n  format: string;\r\n  width: number;\r\n  height: number;\r\n  bytes: number;\r\n  createdAt: string;\r\n}\r\n\r\nexport interface CloudinaryDeleteResult {\r\n  result: 'ok' | 'not found' | 'error';\r\n  publicId: string;\r\n}\r\n\r\nexport interface BatchDeleteResult {\r\n  successful: string[];\r\n  failed: Array<{\r\n    publicId: string;\r\n    error: string;\r\n  }>;\r\n}\r\n\r\n/**\r\n * Convert File to base64 data URL\r\n */\r\nconst fileToDataURL = (file: File): Promise<string> => {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.onload = (e) => {\r\n      if (e.target?.result) {\r\n        resolve(e.target.result as string);\r\n      } else {\r\n        reject(new Error('Failed to read file'));\r\n      }\r\n    };\r\n    reader.onerror = () => reject(new Error('Failed to read file'));\r\n    reader.readAsDataURL(file);\r\n  });\r\n};\r\n\r\n/**\r\n * Generate a mock upload result for development using actual uploaded file\r\n */\r\nconst generateMockUploadResult = async (file: File, index: number): Promise<CloudinaryUploadResult> => {\r\n  const randomId = `mock_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  \r\n  // Convert the actual file to a data URL\r\n  const dataUrl = await fileToDataURL(file);\r\n  \r\n  return {\r\n    url: dataUrl,\r\n    publicId: randomId,\r\n    format: file.type.split('/')[1] || 'jpeg',\r\n    width: 400, // We could calculate actual dimensions if needed\r\n    height: 600,\r\n    bytes: file.size,\r\n    createdAt: new Date().toISOString(),\r\n  };\r\n};\r\n\r\n/**\r\n * Upload a single file to Cloudinary\r\n * @param file - The file to upload\r\n * @returns Promise with upload result\r\n */\r\nexport const uploadToCloudinary = async (\r\n  file: File\r\n): Promise<CloudinaryUploadResult> => {\r\n  // Validate file before upload\r\n  if (!isValidImageFile(file)) {\r\n    throw new Error(`Invalid file: ${file.name}. Must be JPEG, PNG, WebP, or GIF under 10MB.`);\r\n  }\r\n  \r\n  // Check if we should use mock data\r\n  if (!isCloudinaryConfigured()) {\r\n    console.warn('Cloudinary not configured. Using local image data for development.');\r\n    // Simulate upload delay\r\n    await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 1000));\r\n    return await generateMockUploadResult(file, 0);\r\n  }\r\n  \r\n  const formData = new FormData();\r\n  formData.append('file', file);\r\n  formData.append('upload_preset', UPLOAD_PRESET);\r\n  \r\n  try {\r\n    const response = await fetch(\r\n      `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,\r\n      {\r\n        method: 'POST',\r\n        body: formData,\r\n      }\r\n    );\r\n    \r\n    if (!response.ok) {\r\n      const error = await response.text();\r\n      throw new Error(`Upload failed: ${response.statusText || error}`);\r\n    }\r\n    \r\n    const data = await response.json();\r\n    \r\n    return {\r\n      url: data.secure_url,\r\n      publicId: data.public_id,\r\n      format: data.format,\r\n      width: data.width,\r\n      height: data.height,\r\n      bytes: data.bytes,\r\n      createdAt: data.created_at,\r\n    };\r\n  } catch (error) {\r\n    console.error('Cloudinary upload error:', error);\r\n    throw error instanceof Error ? error : new Error('Upload failed');\r\n  }\r\n};\r\n\r\n/**\r\n * Upload multiple files to Cloudinary with progress tracking\r\n * @param files - Array of files to upload\r\n * @param onProgress - Progress callback\r\n * @returns Promise with array of upload results\r\n */\r\nexport const uploadMultipleToCloudinary = async (\r\n  files: File[],\r\n  onProgress?: (progress: number) => void\r\n): Promise<CloudinaryUploadResult[]> => {\r\n  // Validate all files first\r\n  const invalidFiles = files.filter(file => !isValidImageFile(file));\r\n  if (invalidFiles.length > 0) {\r\n    const invalidFileNames = invalidFiles.map(f => f.name).join(', ');\r\n    throw new Error(\r\n      `Invalid files detected: ${invalidFileNames}. ` +\r\n      `All files must be JPEG, PNG, WebP, or GIF under 10MB each.`\r\n    );\r\n  }\r\n  \r\n  // Check if we should use mock data\r\n  if (!isCloudinaryConfigured()) {\r\n    console.warn('Cloudinary not configured. Using local image data for development.');\r\n    const results: CloudinaryUploadResult[] = [];\r\n    \r\n    for (let i = 0; i < files.length; i++) {\r\n      // Simulate upload delay\r\n      await new Promise(resolve => setTimeout(resolve, 300 + Math.random() * 700));\r\n      results.push(await generateMockUploadResult(files[i], i));\r\n      \r\n      if (onProgress) {\r\n        const progress = ((i + 1) / files.length) * 100;\r\n        onProgress(progress);\r\n      }\r\n    }\r\n    \r\n    return results;\r\n  }\r\n  \r\n  const results: CloudinaryUploadResult[] = [];\r\n  const totalFiles = files.length;\r\n  \r\n  for (let i = 0; i < files.length; i++) {\r\n    try {\r\n      const result = await uploadToCloudinary(files[i]);\r\n      results.push(result);\r\n      \r\n      if (onProgress) {\r\n        const progress = ((i + 1) / totalFiles) * 100;\r\n        onProgress(progress);\r\n      }\r\n    } catch (error) {\r\n      console.error(`Failed to upload file ${i + 1}:`, error);\r\n      // Clean up any successful uploads if one fails\r\n      if (results.length > 0 && isCloudinaryConfigured()) {\r\n        console.log('Rolling back successful uploads:', results.map(r => r.publicId));\r\n        // Attempt to delete successfully uploaded images\r\n        await batchDeleteFromCloudinary(results.map(r => r.publicId));\r\n      }\r\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\r\n      throw new Error(`Failed to upload file ${files[i].name}: ${errorMessage}`);\r\n    }\r\n  }\r\n  \r\n  return results;\r\n};\r\n\r\n/**\r\n * Delete an image from Cloudinary\r\n * @param publicId - The public ID of the image to delete\r\n * @returns Promise indicating success\r\n */\r\nexport const deleteFromCloudinary = async (publicId: string): Promise<CloudinaryDeleteResult> => {\r\n  // If using mock data, just return success\r\n  if (!isCloudinaryConfigured() || publicId.startsWith('mock_')) {\r\n    console.log('Mock mode: Simulating image deletion for', publicId);\r\n    return {\r\n      result: 'ok',\r\n      publicId: publicId,\r\n    };\r\n  }\r\n  \r\n  try {\r\n    // For now, make a request to the mock API endpoint\r\n    const response = await fetch('/api/cloudinary/delete', {\r\n      method: 'DELETE',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({ publicId }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({ message: 'Delete failed' }));\r\n      throw new Error(error.message || `Delete failed: ${response.statusText}`);\r\n    }\r\n\r\n    const result = await response.json();\r\n    return result;\r\n  } catch (error) {\r\n    console.error('Delete from Cloudinary error:', error);\r\n    throw error instanceof Error ? error : new Error('Delete failed');\r\n  }\r\n};\r\n\r\n/**\r\n * Batch delete multiple images from Cloudinary\r\n * @param publicIds - Array of public IDs to delete\r\n * @returns Promise with batch delete results\r\n */\r\nexport const batchDeleteFromCloudinary = async (\r\n  publicIds: string[]\r\n): Promise<BatchDeleteResult> => {\r\n  const results: BatchDeleteResult = {\r\n    successful: [],\r\n    failed: [],\r\n  };\r\n\r\n  // Process deletions in parallel with error handling for each\r\n  const deletePromises = publicIds.map(async (publicId) => {\r\n    try {\r\n      const result = await deleteFromCloudinary(publicId);\r\n      if (result.result === 'ok') {\r\n        results.successful.push(publicId);\r\n      } else {\r\n        results.failed.push({\r\n          publicId,\r\n          error: result.result === 'not found' ? 'Image not found' : 'Delete failed',\r\n        });\r\n      }\r\n    } catch (error) {\r\n      results.failed.push({\r\n        publicId,\r\n        error: error instanceof Error ? error.message : 'Unknown error',\r\n      });\r\n    }\r\n  });\r\n\r\n  await Promise.allSettled(deletePromises);\r\n  return results;\r\n};\r\n\r\n/**\r\n * Delete image by URL (extracts public ID and deletes)\r\n * @param url - Cloudinary URL\r\n * @returns Promise indicating success\r\n */\r\nexport const deleteImageByUrl = async (url: string): Promise<CloudinaryDeleteResult> => {\r\n  // Handle data URLs (local images)\r\n  if (url.includes('data:image')) {\r\n    return {\r\n      result: 'ok',\r\n      publicId: 'local_image',\r\n    };\r\n  }\r\n  \r\n  // Handle mock URLs\r\n  if (url.includes('picsum.photos')) {\r\n    const mockId = url.match(/id=(mock_[a-zA-Z0-9_]+)/)?.[1] || 'mock_unknown';\r\n    return deleteFromCloudinary(mockId);\r\n  }\r\n  \r\n  const publicId = extractPublicId(url);\r\n  if (!publicId) {\r\n    throw new Error('Invalid Cloudinary URL: Unable to extract public ID');\r\n  }\r\n  \r\n  return deleteFromCloudinary(publicId);\r\n};\r\n\r\n/**\r\n * Generate a thumbnail URL for a Cloudinary image\r\n * @param url - The original Cloudinary URL\r\n * @param width - Thumbnail width\r\n * @param height - Thumbnail height\r\n * @returns Thumbnail URL\r\n */\r\nexport const generateThumbnailUrl = (\r\n  url: string,\r\n  width: number = 300,\r\n  height: number = 300\r\n): string => {\r\n  // Handle mock URLs (data URLs)\r\n  if (url.includes('data:image')) {\r\n    return url; // Data URLs can't be resized via URL manipulation\r\n  }\r\n  \r\n  // Handle picsum photos\r\n  if (url.includes('picsum.photos')) {\r\n    return url.replace(/\\/\\d+\\/\\d+/, `/${width}/${height}`);\r\n  }\r\n  \r\n  return url.replace('/upload/', `/upload/w_${width},h_${height},c_fill,q_auto/`);\r\n};\r\n\r\n/**\r\n * Generate an optimized URL for a Cloudinary image\r\n * @param url - The original Cloudinary URL\r\n * @param options - Optimization options\r\n * @returns Optimized URL\r\n */\r\nexport const generateOptimizedUrl = (\r\n  url: string,\r\n  options: {\r\n    width?: number;\r\n    height?: number;\r\n    quality?: number | 'auto';\r\n    format?: string;\r\n    blur?: number;\r\n  } = {}\r\n): string => {\r\n  // Handle mock URLs (data URLs and picsum)\r\n  if (url.includes('data:image')) {\r\n    return url; // Data URLs can't be transformed via URL manipulation\r\n  }\r\n  \r\n  if (url.includes('picsum.photos')) {\r\n    const { width = 400, height = 600, blur } = options;\r\n    let mockUrl = url.replace(/\\/\\d+\\/\\d+/, `/${width}/${height}`);\r\n    if (blur) {\r\n      mockUrl += `${mockUrl.includes('?') ? '&' : '?'}blur=${Math.min(10, blur / 100)}`;\r\n    }\r\n    return mockUrl;\r\n  }\r\n  \r\n  const { width, height, quality = 'auto', format = 'auto', blur } = options;\r\n  \r\n  let transformations = [`q_${quality}`, `f_${format}`];\r\n  \r\n  if (width) transformations.push(`w_${width}`);\r\n  if (height) transformations.push(`h_${height}`);\r\n  if (blur) transformations.push(`e_blur:${blur}`);\r\n  \r\n  const transformString = transformations.join(',');\r\n  return url.replace('/upload/', `/upload/${transformString}/`);\r\n};\r\n\r\n/**\r\n * Generate a blurred preview URL (useful for premium content)\r\n * @param url - The original Cloudinary URL\r\n * @param blurLevel - Blur intensity (100-2000, higher = more blur)\r\n * @returns Blurred URL\r\n */\r\nexport const generateBlurredUrl = (url: string, blurLevel: number = 1000): string => {\r\n  return generateOptimizedUrl(url, { blur: blurLevel, quality: 70 });\r\n};\r\n\r\n/**\r\n * Validate if a file is an acceptable image type\r\n * @param file - The file to validate\r\n * @returns Boolean indicating if file is valid\r\n */\r\nexport const isValidImageFile = (file: File): boolean => {\r\n  const acceptedTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];\r\n  const maxSize = 10 * 1024 * 1024; // 10MB\r\n  \r\n  if (!acceptedTypes.includes(file.type)) {\r\n    console.warn(`Invalid file type: ${file.type} for file: ${file.name}`);\r\n    return false;\r\n  }\r\n  \r\n  if (file.size > maxSize) {\r\n    console.warn(`File too large: ${file.size} bytes for file: ${file.name}`);\r\n    return false;\r\n  }\r\n  \r\n  return true;\r\n};\r\n\r\n/**\r\n * Get human-readable file size\r\n * @param bytes - File size in bytes\r\n * @returns Formatted string\r\n */\r\nexport const formatFileSize = (bytes: number): string => {\r\n  if (bytes === 0) return '0 Bytes';\r\n  \r\n  const k = 1024;\r\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  \r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n};\r\n\r\n/**\r\n * Convert a base64 string to a File object for Cloudinary upload\r\n * @param base64 - The base64 string\r\n * @param filename - The filename to use\r\n * @returns File object\r\n */\r\nexport const base64ToFile = (base64: string, filename: string): File => {\r\n  // Handle data URL format\r\n  const arr = base64.split(',');\r\n  const mime = arr[0].match(/:(.*?);/)?.[1] || 'image/jpeg';\r\n  const bstr = atob(arr[1]);\r\n  let n = bstr.length;\r\n  const u8arr = new Uint8Array(n);\r\n  \r\n  while (n--) {\r\n    u8arr[n] = bstr.charCodeAt(n);\r\n  }\r\n  \r\n  return new File([u8arr], filename, { type: mime });\r\n};\r\n\r\n/**\r\n * Extract Cloudinary public ID from URL\r\n * @param url - Cloudinary URL\r\n * @returns Public ID or null if not a valid Cloudinary URL\r\n */\r\nexport const extractPublicId = (url: string): string | null => {\r\n  try {\r\n    const regex = /\\/v\\d+\\/(.+)\\.[a-zA-Z]+$/;\r\n    const match = url.match(regex);\r\n    return match ? match[1] : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Check if a URL is a Cloudinary URL\r\n * @param url - URL to check\r\n * @returns Boolean\r\n */\r\nexport const isCloudinaryUrl = (url: string): boolean => {\r\n  return url.includes('cloudinary.com') && url.includes(CLOUD_NAME);\r\n};\r\n\r\n/**\r\n * Check if Cloudinary is configured and show appropriate message\r\n */\r\nexport const checkCloudinaryConfig = (): { configured: boolean; message?: string } => {\r\n  if (!isCloudinaryConfigured()) {\r\n    return {\r\n      configured: false,\r\n      message: 'Cloudinary is not configured. Using mock images for development. To enable real image uploads, please update your .env.local file with valid Cloudinary credentials.'\r\n    };\r\n  }\r\n  return { configured: true };\r\n};"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 483, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/hooks/useSellerMessages.ts"],"sourcesContent":["// src/hooks/useSellerMessages.ts - OPTIMISTIC VERSION\r\nimport { useState, useEffect, useCallback, useMemo, useRef } from 'react';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useListings } from '@/context/ListingContext';\r\nimport { useMessages } from '@/context/MessageContext';\r\nimport { useRequests } from '@/context/RequestContext';\r\nimport { useWallet } from '@/context/WalletContext';\r\nimport { storageService } from '@/services';\r\nimport { uploadToCloudinary } from '@/utils/cloudinary';\r\nimport { securityService } from '@/services/security.service';\r\nimport { sanitizeStrict, sanitizeHtml, sanitizeCurrency } from '@/utils/security/sanitization';\r\nimport { useRateLimit } from '@/utils/security/rate-limiter';\r\nimport { reportsService } from '@/services/reports.service';\r\nimport { messageSchemas, financialSchemas } from '@/utils/validation/schemas';\r\nimport { z } from 'zod';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { useSearchParams } from 'next/navigation';\r\n\r\n// Helper function\r\nconst getConversationKey = (userA: string, userB: string): string => {\r\n  // Sanitize usernames before creating key\r\n  const sanitizedA = sanitizeStrict(userA);\r\n  const sanitizedB = sanitizeStrict(userB);\r\n  return [sanitizedA, sanitizedB].sort().join('-');\r\n};\r\n\r\n// Define message schema for validation\r\nconst MessageSchema = z.object({\r\n  sender: z.string().min(1).max(100),\r\n  receiver: z.string().min(1).max(100),\r\n  content: z.string().min(0).max(5000),\r\n  date: z.string(),\r\n  read: z.boolean().optional(),\r\n  isRead: z.boolean().optional(),\r\n  type: z.enum(['normal', 'customRequest', 'image', 'tip']).optional(),\r\n  meta: z.object({\r\n    id: z.string().optional(),\r\n    title: z.string().max(200).optional(),\r\n    price: z.number().min(0).max(10000).optional(),\r\n    tags: z.array(z.string().max(50)).max(20).optional(),\r\n    message: z.string().max(1000).optional(),\r\n    imageUrl: z.string().url().optional(),\r\n    tipAmount: z.number().min(1).max(500).optional(),\r\n  }).optional(),\r\n}).passthrough(); // Allow additional fields like id\r\n\r\ntype Message = z.infer<typeof MessageSchema>;\r\n\r\n// Optimistic message type - includes a temporary flag\r\ninterface OptimisticMessage extends Message {\r\n  _optimistic?: boolean;\r\n  _tempId?: string;\r\n}\r\n\r\nexport function useSellerMessages() {\r\n  const { user } = useAuth();\r\n  const { addSellerNotification, users } = useListings();\r\n  const { \r\n    messages, \r\n    sendMessage, \r\n    markMessagesAsRead, \r\n    blockUser, \r\n    unblockUser, \r\n    reportUser, \r\n    isBlocked, \r\n    hasReported,\r\n    clearMessageNotifications,\r\n    getMessagesForUsers,\r\n    refreshMessages\r\n  } = useMessages();\r\n  const { requests, addRequest, getRequestsForUser, respondToRequest, markRequestAsPaid, getRequestById } = useRequests();\r\n  const { getBuyerBalance, purchaseCustomRequest } = useWallet();\r\n  const searchParams = useSearchParams();\r\n  \r\n  // Add state to track message updates\r\n  const [messageUpdateCounter, setMessageUpdateCounter] = useState(0);\r\n  \r\n  // Track optimistic messages locally\r\n  const [optimisticMessages, setOptimisticMessages] = useState<{ [threadId: string]: OptimisticMessage[] }>({});\r\n  const optimisticMessageIds = useRef<Map<string, string>>(new Map()); // tempId -> realId mapping\r\n  \r\n  // Rate limiting\r\n  const { checkLimit: checkMessageLimit } = useRateLimit('MESSAGE_SEND', {\r\n    maxAttempts: 30,\r\n    windowMs: 60 * 1000 // 1 minute\r\n  });\r\n  \r\n  const { checkLimit: checkImageLimit } = useRateLimit('IMAGE_UPLOAD', {\r\n    maxAttempts: 10,\r\n    windowMs: 60 * 60 * 1000 // 1 hour\r\n  });\r\n  \r\n  const { checkLimit: checkRequestLimit } = useRateLimit('CUSTOM_REQUEST', {\r\n    maxAttempts: 5,\r\n    windowMs: 60 * 60 * 1000 // 1 hour\r\n  });\r\n  \r\n  // State for UI\r\n  const [previewImage, setPreviewImage] = useState<string | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [filterBy, setFilterBy] = useState<'all' | 'unread'>('all');\r\n  const [activeThread, setActiveThread] = useState<string | null>(null);\r\n  const [observerReadMessages, setObserverReadMessages] = useState<Set<string>>(new Set());\r\n  \r\n  // State for message input\r\n  const [replyMessage, setReplyMessage] = useState('');\r\n  const [selectedImage, setSelectedImage] = useState<string | null>(null);\r\n  const [isImageLoading, setIsImageLoading] = useState(false);\r\n  const [imageError, setImageError] = useState<string | null>(null);\r\n  const [showEmojiPicker, setShowEmojiPicker] = useState(false);\r\n  const [recentEmojis, setRecentEmojis] = useState<string[]>([]);\r\n  \r\n  // State for custom request editing\r\n  const [editRequestId, setEditRequestId] = useState<string | null>(null);\r\n  const [editPrice, setEditPrice] = useState<number | ''>('');\r\n  const [editTitle, setEditTitle] = useState('');\r\n  const [editMessage, setEditMessage] = useState('');\r\n  \r\n  // Validation errors\r\n  const [validationErrors, setValidationErrors] = useState<Record<string, string>>({});\r\n  \r\n  const readThreadsRef = useRef<Set<string>>(new Set());\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const hasLoadedEmojis = useRef(false);\r\n  const lastActiveThread = useRef<string | null>(null);\r\n  \r\n  const isAdmin = user?.role === 'admin';\r\n  \r\n  // CRITICAL: Listen for new messages and handle optimistic updates\r\n  useEffect(() => {\r\n    const handleNewMessage = (event: Event) => {\r\n      const customEvent = event as CustomEvent;\r\n      const newMessage = customEvent.detail;\r\n      \r\n      console.log('[useSellerMessages] New message event received:', newMessage);\r\n      \r\n      // Check if this is a confirmation of an optimistic message\r\n      if (newMessage.sender === user?.username && newMessage.receiver === activeThread) {\r\n        // This is our message coming back from the server\r\n        const threadId = getConversationKey(newMessage.sender, newMessage.receiver);\r\n        \r\n        // Find matching optimistic message by content and approximate time\r\n        setOptimisticMessages(prev => {\r\n          const threadOptimistic = prev[threadId] || [];\r\n          const matchingOptimistic = threadOptimistic.find(msg => \r\n            msg._optimistic && \r\n            msg.content === newMessage.content &&\r\n            Math.abs(new Date(msg.date).getTime() - new Date(newMessage.date || newMessage.createdAt).getTime()) < 5000 // Within 5 seconds\r\n          );\r\n          \r\n          if (matchingOptimistic && matchingOptimistic._tempId) {\r\n            // Store the mapping\r\n            optimisticMessageIds.current.set(matchingOptimistic._tempId, newMessage.id);\r\n            \r\n            // Remove the optimistic message (real one will be in main messages now)\r\n            return {\r\n              ...prev,\r\n              [threadId]: threadOptimistic.filter(msg => msg._tempId !== matchingOptimistic._tempId)\r\n            };\r\n          }\r\n          \r\n          return prev;\r\n        });\r\n      }\r\n      \r\n      // Force a re-render to show the new message\r\n      setMessageUpdateCounter(prev => prev + 1);\r\n      \r\n      // If the message is for the active thread, scroll to bottom\r\n      if (activeThread && \r\n          (newMessage.sender === activeThread || newMessage.receiver === activeThread)) {\r\n        setTimeout(() => {\r\n          messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n        }, 100);\r\n      }\r\n    };\r\n    \r\n    // Also listen for read events to update UI\r\n    const handleMessageRead = (event: Event) => {\r\n      const customEvent = event as CustomEvent;\r\n      console.log('[useSellerMessages] Message read event received:', customEvent.detail);\r\n      \r\n      // Update optimistic messages' read status\r\n      if (customEvent.detail.messageIds) {\r\n        setOptimisticMessages(prev => {\r\n          const updated = { ...prev };\r\n          \r\n          Object.keys(updated).forEach(threadId => {\r\n            updated[threadId] = updated[threadId].map(msg => {\r\n              // Check if this message's real ID is in the read list\r\n              const realId = msg._tempId ? optimisticMessageIds.current.get(msg._tempId) : msg.id;\r\n              if (realId && customEvent.detail.messageIds.includes(realId)) {\r\n                return { ...msg, isRead: true, read: true };\r\n              }\r\n              return msg;\r\n            });\r\n          });\r\n          \r\n          return updated;\r\n        });\r\n      }\r\n      \r\n      // Force a re-render to update read receipts\r\n      setMessageUpdateCounter(prev => prev + 1);\r\n    };\r\n    \r\n    window.addEventListener('message:new', handleNewMessage);\r\n    window.addEventListener('message:read', handleMessageRead);\r\n    \r\n    return () => {\r\n      window.removeEventListener('message:new', handleNewMessage);\r\n      window.removeEventListener('message:read', handleMessageRead);\r\n    };\r\n  }, [activeThread, user?.username]);\r\n  \r\n  // Clean up old optimistic messages periodically\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      setOptimisticMessages(prev => {\r\n        const updated = { ...prev };\r\n        const now = Date.now();\r\n        \r\n        Object.keys(updated).forEach(threadId => {\r\n          // Remove optimistic messages older than 10 seconds (they should have been confirmed by now)\r\n          updated[threadId] = updated[threadId].filter(msg => {\r\n            if (msg._optimistic) {\r\n              const messageTime = new Date(msg.date).getTime();\r\n              return now - messageTime < 10000; // Keep if less than 10 seconds old\r\n            }\r\n            return true;\r\n          });\r\n        });\r\n        \r\n        return updated;\r\n      });\r\n      \r\n      // Clean up ID mappings\r\n      if (optimisticMessageIds.current.size > 100) {\r\n        optimisticMessageIds.current.clear();\r\n      }\r\n    }, 10000); // Every 10 seconds\r\n    \r\n    return () => clearInterval(interval);\r\n  }, []);\r\n  \r\n  // Load recent emojis once on mount\r\n  useEffect(() => {\r\n    const loadRecentEmojis = async () => {\r\n      if (!hasLoadedEmojis.current) {\r\n        hasLoadedEmojis.current = true;\r\n        try {\r\n          const stored = await storageService.getItem<string[]>('panty_recent_emojis', []);\r\n          if (Array.isArray(stored) && stored.every(item => typeof item === 'string')) {\r\n            // Sanitize stored emojis\r\n            const sanitized = stored.map(emoji => sanitizeStrict(emoji).slice(0, 10));\r\n            setRecentEmojis(sanitized.slice(0, 30));\r\n          }\r\n        } catch (error) {\r\n          console.error('Failed to load recent emojis:', error);\r\n        }\r\n      }\r\n    };\r\n    loadRecentEmojis();\r\n  }, []);\r\n  \r\n  // Save recent emojis with debounce\r\n  useEffect(() => {\r\n    const timeoutId = setTimeout(async () => {\r\n      try {\r\n        await storageService.setItem('panty_recent_emojis', recentEmojis.slice(0, 30));\r\n      } catch (error) {\r\n        console.error('Failed to save recent emojis:', error);\r\n      }\r\n    }, 500);\r\n    \r\n    return () => clearTimeout(timeoutId);\r\n  }, [recentEmojis]);\r\n  \r\n  // Handle URL thread parameter with validation\r\n  useEffect(() => {\r\n    const threadParam = searchParams.get('thread');\r\n    if (threadParam && !activeThread && user) {\r\n      // Sanitize and validate thread parameter\r\n      const sanitizedThread = sanitizeStrict(threadParam);\r\n      if (sanitizedThread && sanitizedThread.length <= 100) {\r\n        setActiveThread(sanitizedThread);\r\n      }\r\n    }\r\n  }, [searchParams, user, activeThread]);\r\n  \r\n  // ENHANCED: Merge real messages with optimistic messages\r\n  const { threads, unreadCounts, lastMessages, buyerProfiles, totalUnreadCount } = useMemo(() => {\r\n    const threads: { [buyer: string]: Message[] } = {};\r\n    const unreadCounts: { [buyer: string]: number } = {};\r\n    const lastMessages: { [buyer: string]: Message } = {};\r\n    const buyerProfiles: { [buyer: string]: { pic: string | null, verified: boolean } } = {};\r\n    let totalUnreadCount = 0;\r\n    \r\n    if (!user) {\r\n      return { threads, unreadCounts, lastMessages, buyerProfiles, totalUnreadCount };\r\n    }\r\n    \r\n    console.log('[SellerMessages] Processing messages for seller:', user.username);\r\n    \r\n    // Process all conversations to find ones involving the seller\r\n    Object.entries(messages).forEach(([conversationKey, msgs]) => {\r\n      if (!Array.isArray(msgs) || msgs.length === 0) return;\r\n      \r\n      // Check if this conversation involves the current seller\r\n      const participants = conversationKey.split('-');\r\n      const involvesCurrentSeller = participants.includes(user.username);\r\n      \r\n      if (!involvesCurrentSeller) return;\r\n      \r\n      // Determine the other party\r\n      const otherParty = participants.find(p => p !== user.username);\r\n      if (!otherParty) return;\r\n      \r\n      // Check if other party is a buyer (skip seller-to-seller conversations)\r\n      const otherUser = users?.[otherParty];\r\n      if (otherUser?.role === 'seller' || otherUser?.role === 'admin') {\r\n        return;\r\n      }\r\n      \r\n      // Validate messages\r\n      const validMessages = msgs.filter(msg => {\r\n        try {\r\n          return msg && msg.sender && msg.receiver && msg.content !== undefined && msg.date;\r\n        } catch (error) {\r\n          console.warn('Invalid message skipped:', error);\r\n          return false;\r\n        }\r\n      });\r\n      \r\n      if (validMessages.length === 0 && !optimisticMessages[conversationKey]) return;\r\n      \r\n      // Combine real messages with optimistic ones for this thread\r\n      let combinedMessages = [...validMessages];\r\n      \r\n      // Add optimistic messages for this thread\r\n      const threadOptimistic = optimisticMessages[conversationKey] || [];\r\n      if (threadOptimistic.length > 0) {\r\n        combinedMessages = [...combinedMessages, ...threadOptimistic];\r\n      }\r\n      \r\n      // Sort messages by date\r\n      combinedMessages.sort((a, b) => \r\n        new Date(a.date).getTime() - new Date(b.date).getTime()\r\n      );\r\n      \r\n      // Add to threads\r\n      threads[otherParty] = combinedMessages;\r\n      \r\n      // Get last message\r\n      if (combinedMessages.length > 0) {\r\n        lastMessages[otherParty] = combinedMessages[combinedMessages.length - 1];\r\n      }\r\n      \r\n      // Count unread messages (only real messages, not optimistic)\r\n      const threadUnreadCount = validMessages.filter(\r\n        (msg) => msg.receiver === user.username && msg.sender === otherParty && !msg.read && !msg.isRead\r\n      ).length;\r\n      \r\n      unreadCounts[otherParty] = threadUnreadCount;\r\n      \r\n      // Add to total if not already marked as read\r\n      if (!readThreadsRef.current.has(otherParty) && threadUnreadCount > 0) {\r\n        totalUnreadCount += threadUnreadCount;\r\n      }\r\n      \r\n      // Get buyer profile\r\n      const buyerInfo = users?.[otherParty];\r\n      const isVerified = buyerInfo?.verified || buyerInfo?.verificationStatus === 'verified';\r\n      \r\n      buyerProfiles[otherParty] = { \r\n        pic: null,\r\n        verified: isVerified || false\r\n      };\r\n    });\r\n    \r\n    return { threads, unreadCounts, lastMessages, buyerProfiles, totalUnreadCount };\r\n  }, [user?.username, messages, users, optimisticMessages, messageUpdateCounter]);\r\n  \r\n  // Get seller's requests with validation\r\n  const sellerRequests = useMemo(() => {\r\n    if (!user) return [];\r\n    \r\n    const rawRequests = getRequestsForUser(user.username, 'seller');\r\n    \r\n    // Validate requests\r\n    return rawRequests.filter(request => {\r\n      try {\r\n        // Basic validation\r\n        return request.id && \r\n               request.buyer && \r\n               request.seller === user.username &&\r\n               typeof request.price === 'number' &&\r\n               request.price > 0 &&\r\n               request.price <= 10000;\r\n      } catch {\r\n        return false;\r\n      }\r\n    });\r\n  }, [user?.username, getRequestsForUser, messageUpdateCounter]);\r\n  \r\n  // Compute UI unread counts\r\n  const uiUnreadCounts = useMemo(() => {\r\n    const counts: { [buyer: string]: number } = {};\r\n    if (threads) {\r\n      Object.keys(threads).forEach(buyer => {\r\n        counts[buyer] = readThreadsRef.current.has(buyer) ? 0 : unreadCounts[buyer];\r\n      });\r\n    }\r\n    return counts;\r\n  }, [threads, unreadCounts, messageUpdateCounter]);\r\n  \r\n  // Mark messages as read when thread is selected AND clear notifications\r\n  useEffect(() => {\r\n    if (!activeThread || !user || activeThread === lastActiveThread.current) {\r\n      return;\r\n    }\r\n    \r\n    // Update the last active thread\r\n    lastActiveThread.current = activeThread;\r\n    \r\n    // Clear message notifications for this buyer\r\n    clearMessageNotifications(user.username, activeThread);\r\n    \r\n    // Check if there are unread messages\r\n    const threadMessages = threads[activeThread] || [];\r\n    \r\n    const hasUnread = threadMessages.some(\r\n      msg => msg.receiver === user.username && msg.sender === activeThread && !msg.read && !msg.isRead && !msg._optimistic\r\n    );\r\n    \r\n    if (hasUnread) {\r\n      // Use a small delay to prevent render loops\r\n      const timer = setTimeout(() => {\r\n        markMessagesAsRead(user.username, activeThread);\r\n        \r\n        // Update read threads ref\r\n        if (!readThreadsRef.current.has(activeThread)) {\r\n          readThreadsRef.current.add(activeThread);\r\n        }\r\n        \r\n        // Force update\r\n        setMessageUpdateCounter(prev => prev + 1);\r\n      }, 100);\r\n      \r\n      return () => clearTimeout(timer);\r\n    }\r\n    \r\n    return;\r\n  }, [activeThread, user?.username, markMessagesAsRead, threads, clearMessageNotifications]);\r\n  \r\n  // Handle message visibility for marking as read\r\n  const handleMessageVisible = useCallback((msg: any) => {\r\n    if (!user || msg.sender === user.username || msg.read || msg.isRead || msg._optimistic) return;\r\n    \r\n    const messageId = `${msg.sender}-${msg.receiver}-${msg.date}`;\r\n    \r\n    if (observerReadMessages.has(messageId)) return;\r\n    \r\n    // Use requestAnimationFrame to batch updates\r\n    requestAnimationFrame(() => {\r\n      markMessagesAsRead(user.username, msg.sender);\r\n      \r\n      setObserverReadMessages(prev => {\r\n        const newSet = new Set(prev);\r\n        newSet.add(messageId);\r\n        return newSet;\r\n      });\r\n      \r\n      // Update read threads if all messages are read\r\n      const threadMessages = threads[msg.sender] || [];\r\n      \r\n      const remainingUnread = threadMessages.filter(\r\n        m => !m.read && !m.isRead && !m._optimistic && m.sender === msg.sender && m.receiver === user.username && \r\n        `${m.sender}-${m.receiver}-${m.date}` !== messageId\r\n      ).length;\r\n      \r\n      if (remainingUnread === 0 && !readThreadsRef.current.has(msg.sender)) {\r\n        readThreadsRef.current.add(msg.sender);\r\n      }\r\n      \r\n      // Force update\r\n      setMessageUpdateCounter(prev => prev + 1);\r\n    });\r\n  }, [user, markMessagesAsRead, threads]);\r\n  \r\n  // OPTIMISTIC: Handle sending reply with instant UI update\r\n  const handleReply = useCallback(async () => {\r\n    if (!activeThread || !user || (!replyMessage.trim() && !selectedImage)) return;\r\n\r\n    // Check rate limit\r\n    const rateLimitResult = checkMessageLimit();\r\n    if (!rateLimitResult.allowed) {\r\n      setValidationErrors({ message: `Too many messages. Wait ${rateLimitResult.waitTime} seconds.` });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Validate and sanitize message content\r\n      const validationResult = messageSchemas.messageContent.safeParse(replyMessage);\r\n      \r\n      if (!validationResult.success && replyMessage.trim()) {\r\n        setValidationErrors({ message: validationResult.error.errors[0].message });\r\n        return;\r\n      }\r\n\r\n      const sanitizedContent = replyMessage ? sanitizeHtml(validationResult.data || replyMessage) : '';\r\n\r\n      // For image messages, validate URL\r\n      if (selectedImage) {\r\n        const urlValidation = z.string().url().safeParse(selectedImage);\r\n        if (!urlValidation.success) {\r\n          setValidationErrors({ image: 'Invalid image URL' });\r\n          return;\r\n        }\r\n      }\r\n\r\n      console.log('[SellerMessages] Sending message:', {\r\n        text: sanitizedContent,\r\n        imageUrl: selectedImage,\r\n        receiver: activeThread\r\n      });\r\n\r\n      // For image messages, allow empty text\r\n      const messageContent = sanitizedContent || (selectedImage ? 'Image shared' : '');\r\n\r\n      // Create optimistic message\r\n      const tempId = uuidv4();\r\n      const threadId = getConversationKey(user.username, activeThread);\r\n      const optimisticMsg: OptimisticMessage = {\r\n        id: tempId,\r\n        _tempId: tempId,\r\n        _optimistic: true,\r\n        sender: user.username,\r\n        receiver: activeThread,\r\n        content: messageContent,\r\n        date: new Date().toISOString(),\r\n        isRead: false,\r\n        read: false,\r\n        type: selectedImage ? 'image' : 'normal',\r\n        meta: selectedImage ? { imageUrl: selectedImage } : undefined,\r\n      };\r\n      \r\n      // Add optimistic message to UI immediately\r\n      setOptimisticMessages(prev => ({\r\n        ...prev,\r\n        [threadId]: [...(prev[threadId] || []), optimisticMsg]\r\n      }));\r\n      \r\n      // Clear input immediately for better UX\r\n      setReplyMessage('');\r\n      setSelectedImage(null);\r\n      setImageError(null);\r\n      setShowEmojiPicker(false);\r\n      setValidationErrors({});\r\n      \r\n      // Scroll to bottom immediately\r\n      setTimeout(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n      }, 0);\r\n      \r\n      // Send the actual message in the background\r\n      sendMessage(user.username, activeThread, messageContent, {\r\n        type: selectedImage ? 'image' : 'normal',\r\n        meta: selectedImage ? { imageUrl: selectedImage } : undefined,\r\n      }).catch(error => {\r\n        console.error('Failed to send message:', error);\r\n        \r\n        // Remove optimistic message on error\r\n        setOptimisticMessages(prev => ({\r\n          ...prev,\r\n          [threadId]: prev[threadId]?.filter(msg => msg._tempId !== tempId) || []\r\n        }));\r\n        \r\n        // Restore input on error\r\n        setReplyMessage(messageContent);\r\n        setSelectedImage(selectedImage);\r\n        setValidationErrors({ message: 'Failed to send message. Please try again.' });\r\n      });\r\n      \r\n    } catch (error) {\r\n      console.error('Failed to send message:', error);\r\n      setValidationErrors({ message: 'Failed to send message' });\r\n    }\r\n  }, [activeThread, user, replyMessage, selectedImage, sendMessage, checkMessageLimit]);\r\n  \r\n  // Handle block toggle\r\n  const handleBlockToggle = useCallback(() => {\r\n    if (!activeThread || !user) return;\r\n    \r\n    if (isBlocked(user.username, activeThread)) {\r\n      unblockUser(user.username, activeThread);\r\n    } else {\r\n      blockUser(user.username, activeThread);\r\n    }\r\n    \r\n    // Force update\r\n    setMessageUpdateCounter(prev => prev + 1);\r\n  }, [activeThread, user, isBlocked, unblockUser, blockUser]);\r\n  \r\n  // Handle report\r\n  const handleReport = useCallback(async () => {\r\n    if (!activeThread || !user) return;\r\n    \r\n    if (!hasReported(user.username, activeThread)) {\r\n      // Use the reports service to send to MongoDB\r\n      const reportData = {\r\n       reportedUser: activeThread,\r\n       reportType: 'harassment' as const,\r\n       description: `Buyer reported from messages by seller ${user.username}`,\r\n       severity: 'medium' as const,\r\n       relatedMessageId: threads[activeThread]?.[threads[activeThread].length - 1]?.id as string | undefined\r\n     };\r\n      \r\n      try {\r\n        const response = await reportsService.submitReport(reportData);\r\n        if (response.success) {\r\n          // Also update local state for UI\r\n          reportUser(user.username, activeThread);\r\n        }\r\n      } catch (error) {\r\n        console.error('Failed to submit report:', error);\r\n        // Fallback to local report\r\n        reportUser(user.username, activeThread);\r\n      }\r\n    }\r\n    \r\n    // Force update\r\n    setMessageUpdateCounter(prev => prev + 1);\r\n  }, [activeThread, user, hasReported, reportUser, threads]);\r\n  \r\n  // Handle accepting custom request with validation\r\n  const handleAccept = useCallback(async (customRequestId: string) => {\r\n    if (!user) return;\r\n    \r\n    // Validate request ID\r\n    const isValidUuid = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(customRequestId) ||\r\n                       /^req_\\d+_[a-z0-9]+$/i.test(customRequestId);\r\n    \r\n    if (!isValidUuid) {\r\n      console.error('Invalid request ID format');\r\n      return;\r\n    }\r\n    \r\n    const request = requests.find(r => r.id === customRequestId);\r\n    if (!request) return;\r\n    \r\n    // Validate request data\r\n    if (!request.price || request.price <= 0 || request.price > 10000) {\r\n      console.error('Invalid request price');\r\n      return;\r\n    }\r\n    \r\n    // Check rate limit\r\n    const rateLimitResult = checkRequestLimit();\r\n    if (!rateLimitResult.allowed) {\r\n      addSellerNotification(user.username, `⚠️ Too many requests. Wait ${rateLimitResult.waitTime} seconds.`);\r\n      return;\r\n    }\r\n    \r\n    // Check if buyer has sufficient balance\r\n    const markupPrice = request.price * 1.1;\r\n    const buyerBalance = getBuyerBalance(request.buyer);\r\n    \r\n    if (buyerBalance >= markupPrice) {\r\n      // Auto-process payment\r\n      const customRequest = {\r\n        requestId: request.id,\r\n        buyer: request.buyer,\r\n        seller: user.username,\r\n        amount: request.price,\r\n        description: sanitizeStrict(request.title),\r\n        metadata: request\r\n      };\r\n      \r\n      const success = await purchaseCustomRequest(customRequest);\r\n      \r\n      if (success) {\r\n        // Mark as paid\r\n        markRequestAsPaid(request.id);\r\n        \r\n        // Notify seller (self)\r\n        addSellerNotification(user.username, `💰 Custom request \"${sanitizeStrict(request.title)}\" has been paid! Check your orders to fulfill.`);\r\n        \r\n        // Send confirmation message to buyer\r\n        await sendMessage(user.username, request.buyer, `✅ Your custom request \"${sanitizeStrict(request.title)}\" has been accepted and automatically paid!`, {\r\n          type: 'normal'\r\n        });\r\n      } else {\r\n        // Payment failed\r\n        await sendMessage(user.username, request.buyer, `⚠️ Custom request \"${sanitizeStrict(request.title)}\" accepted but payment failed. Please try paying manually.`, {\r\n          type: 'normal'\r\n        });\r\n        respondToRequest(customRequestId, 'accepted', undefined, undefined, user.username);\r\n      }\r\n    } else {\r\n      // Insufficient balance - just accept without payment\r\n      respondToRequest(customRequestId, 'accepted', undefined, undefined, user.username);\r\n      \r\n      await sendMessage(user.username, request.buyer, `✅ Your custom request \"${sanitizeStrict(request.title)}\" has been accepted! Payment required - you have insufficient balance (need $${markupPrice.toFixed(2)}).`, {\r\n        type: 'normal'\r\n      });\r\n    }\r\n    \r\n    // Force update\r\n    setMessageUpdateCounter(prev => prev + 1);\r\n  }, [user, requests, getBuyerBalance, purchaseCustomRequest, markRequestAsPaid, addSellerNotification, sendMessage, respondToRequest, checkRequestLimit]);\r\n  \r\n  // Handle declining custom request\r\n  const handleDecline = useCallback((customRequestId: string) => {\r\n    if (!user) return;\r\n    \r\n    // Validate request ID\r\n    const isValidUuid = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(customRequestId) ||\r\n                       /^req_\\d+_[a-z0-9]+$/i.test(customRequestId);\r\n    \r\n    if (!isValidUuid) {\r\n      console.error('Invalid request ID format');\r\n      return;\r\n    }\r\n    \r\n    respondToRequest(customRequestId, 'rejected', undefined, undefined, user.username);\r\n    \r\n    const request = requests.find(r => r.id === customRequestId);\r\n    if (request) {\r\n      sendMessage(user.username, request.buyer, `Your custom request \"${sanitizeStrict(request.title)}\" has been declined.`, {\r\n        type: 'normal'\r\n      });\r\n    }\r\n    \r\n    // Force update\r\n    setMessageUpdateCounter(prev => prev + 1);\r\n  }, [user, respondToRequest, requests, sendMessage]);\r\n  \r\n  // Handle custom request editing with validation\r\n  const handleEditRequest = useCallback((requestId: string, title: string, price: number, message: string) => {\r\n    // Validate inputs\r\n    const isValidUuid = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(requestId) ||\r\n                       /^req_\\d+_[a-z0-9]+$/i.test(requestId);\r\n    \r\n    if (!isValidUuid) {\r\n      console.error('Invalid request ID format');\r\n      return;\r\n    }\r\n    \r\n    setEditRequestId(requestId);\r\n    setEditTitle(sanitizeStrict(title).slice(0, 200));\r\n    setEditPrice(sanitizeCurrency(price));\r\n    setEditMessage(sanitizeHtml(message).slice(0, 1000));\r\n  }, []);\r\n  \r\n  // Handle submitting edited request with validation\r\n  const handleEditSubmit = useCallback(() => {\r\n    if (!editRequestId || !user || editTitle.trim() === '' || editPrice === '' || editPrice <= 0) return;\r\n    \r\n    // Validate all inputs\r\n    try {\r\n      const validatedData = messageSchemas.customRequest.parse({\r\n        title: editTitle,\r\n        description: editMessage,\r\n        price: Number(editPrice)\r\n      });\r\n      \r\n      const request = requests.find(r => r.id === editRequestId);\r\n      if (!request) return;\r\n      \r\n      // Check rate limit\r\n      const rateLimitResult = checkRequestLimit();\r\n      if (!rateLimitResult.allowed) {\r\n        setValidationErrors({ edit: `Too many edits. Wait ${rateLimitResult.waitTime} seconds.` });\r\n        return;\r\n      }\r\n      \r\n      // Update the request with seller as editor\r\n      respondToRequest(\r\n        editRequestId, \r\n        'edited',\r\n        validatedData.description,\r\n        {\r\n          title: validatedData.title,\r\n          price: validatedData.price,\r\n          description: validatedData.description\r\n        },\r\n        user.username\r\n      );\r\n      \r\n      // Send message about the edit\r\n      sendMessage(\r\n        user.username,\r\n        request.buyer,\r\n        `📝 I've modified your custom request \"${validatedData.title}\"`,\r\n        {\r\n          type: 'customRequest',\r\n          meta: {\r\n            id: editRequestId,\r\n            title: validatedData.title,\r\n            price: validatedData.price,\r\n            message: validatedData.description,\r\n          }\r\n        }\r\n      );\r\n      \r\n      // Reset edit state\r\n      setEditRequestId(null);\r\n      setEditTitle('');\r\n      setEditPrice('');\r\n      setEditMessage('');\r\n      setValidationErrors({});\r\n      \r\n      // Force update\r\n      setMessageUpdateCounter(prev => prev + 1);\r\n      \r\n      addSellerNotification(user.username, `Custom request modified and sent to buyer!`);\r\n    } catch (error) {\r\n      if (error instanceof z.ZodError) {\r\n        setValidationErrors({ edit: error.errors[0].message });\r\n      } else {\r\n        setValidationErrors({ edit: 'Failed to update request' });\r\n      }\r\n    }\r\n  }, [editRequestId, editTitle, editPrice, editMessage, user, requests, respondToRequest, sendMessage, addSellerNotification, checkRequestLimit]);\r\n  \r\n  // Handle emoji click with sanitization\r\n  const handleEmojiClick = useCallback((emoji: string) => {\r\n    // Sanitize emoji\r\n    const sanitizedEmoji = sanitizeStrict(emoji).slice(0, 10);\r\n    \r\n    setReplyMessage(prev => prev + sanitizedEmoji);\r\n    \r\n    setRecentEmojis(prev => {\r\n      const filtered = prev.filter(e => e !== sanitizedEmoji);\r\n      return [sanitizedEmoji, ...filtered].slice(0, 30);\r\n    });\r\n    \r\n    setShowEmojiPicker(false);\r\n  }, []);\r\n  \r\n  // Handle image selection with enhanced validation\r\n  const handleImageSelect = useCallback(async (file: File) => {\r\n    if (!file) return;\r\n    \r\n    // Check rate limit\r\n    const rateLimitResult = checkImageLimit();\r\n    if (!rateLimitResult.allowed) {\r\n      setImageError(`Too many uploads. Wait ${rateLimitResult.waitTime} seconds.`);\r\n      return;\r\n    }\r\n    \r\n    setIsImageLoading(true);\r\n    setImageError(null);\r\n    \r\n    try {\r\n      // Validate file with security service\r\n      const validation = securityService.validateFileUpload(file, {\r\n        maxSize: 5 * 1024 * 1024, // 5MB\r\n        allowedTypes: ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'],\r\n        allowedExtensions: ['jpg', 'jpeg', 'png', 'gif', 'webp']\r\n      });\r\n\r\n      if (!validation.valid) {\r\n        throw new Error(validation.error || 'Invalid file');\r\n      }\r\n      \r\n      // Upload to Cloudinary\r\n      console.log('Uploading image to Cloudinary...');\r\n      const uploadResult = await uploadToCloudinary(file);\r\n      \r\n      // Validate returned URL\r\n      const urlValidation = z.string().url().safeParse(uploadResult.url);\r\n      if (!urlValidation.success) {\r\n        throw new Error('Invalid upload URL received');\r\n      }\r\n      \r\n      // Set the Cloudinary URL\r\n      setSelectedImage(uploadResult.url);\r\n      console.log('Image uploaded successfully:', uploadResult.url);\r\n    } catch (error) {\r\n      console.error('Image upload error:', error);\r\n      const errorMessage = error instanceof Error ? error.message : 'Failed to upload image';\r\n      setImageError(errorMessage);\r\n      setSelectedImage(null);\r\n    } finally {\r\n      setIsImageLoading(false);\r\n    }\r\n  }, [checkImageLimit]);\r\n  \r\n  const isUserBlocked = !!(user && activeThread && isBlocked(user.username, activeThread));\r\n  const isUserReported = !!(user && activeThread && hasReported(user.username, activeThread));\r\n  \r\n  return {\r\n    // Auth\r\n    user,\r\n    isAdmin,\r\n    \r\n    // Messages & threads\r\n    threads,\r\n    unreadCounts,\r\n    uiUnreadCounts,\r\n    lastMessages,\r\n    buyerProfiles,\r\n    totalUnreadCount,\r\n    activeThread,\r\n    setActiveThread,\r\n    \r\n    // UI State\r\n    previewImage,\r\n    setPreviewImage,\r\n    searchQuery,\r\n    setSearchQuery: (query: string) => setSearchQuery(sanitizeStrict(query).slice(0, 100)),\r\n    filterBy,\r\n    setFilterBy,\r\n    observerReadMessages,\r\n    setObserverReadMessages,\r\n    messagesEndRef,\r\n    \r\n    // Message input\r\n    replyMessage,\r\n    setReplyMessage: (msg: string) => setReplyMessage(msg.slice(0, 5000)),\r\n    selectedImage,\r\n    setSelectedImage,\r\n    isImageLoading,\r\n    setIsImageLoading,\r\n    imageError,\r\n    setImageError,\r\n    showEmojiPicker,\r\n    setShowEmojiPicker,\r\n    recentEmojis,\r\n    \r\n    // Custom requests\r\n    sellerRequests,\r\n    editRequestId,\r\n    setEditRequestId,\r\n    editPrice,\r\n    setEditPrice: (price: number | '') => setEditPrice(price === '' ? '' : sanitizeCurrency(price)),\r\n    editTitle,\r\n    setEditTitle: (title: string) => setEditTitle(sanitizeStrict(title).slice(0, 200)),\r\n    editMessage,\r\n    setEditMessage: (msg: string) => setEditMessage(sanitizeHtml(msg).slice(0, 1000)),\r\n    \r\n    // Validation\r\n    validationErrors,\r\n    \r\n    // Actions\r\n    handleReply,\r\n    handleBlockToggle,\r\n    handleReport,\r\n    handleAccept,\r\n    handleDecline,\r\n    handleEditRequest,\r\n    handleEditSubmit,\r\n    handleImageSelect,\r\n    handleMessageVisible,\r\n    handleEmojiClick,\r\n    \r\n    // Status\r\n    isUserBlocked,\r\n    isUserReported,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1585, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/utils/messageUtils.ts"],"sourcesContent":["// src/utils/messageUtils.ts\r\nimport { storageService } from '@/services';\r\n\r\nexport interface Message {\r\n  id?: string;\r\n  sender: string;\r\n  receiver: string;\r\n  content: string;\r\n  date: string;\r\n  isRead?: boolean;\r\n  read?: boolean;\r\n  type?: 'normal' | 'customRequest' | 'image' | 'tip';\r\n  imageUrl?: string;\r\n  isTip?: boolean;\r\n  tipAmount?: number;\r\n  isCustomRequest?: boolean;\r\n  requestData?: any;\r\n  messageKey?: string;\r\n  meta?: {\r\n    id?: string;\r\n    title?: string;\r\n    price?: number;\r\n    tags?: string[];\r\n    message?: string;\r\n    imageUrl?: string;\r\n    tipAmount?: number;\r\n  };\r\n}\r\n\r\nexport interface CustomRequest {\r\n  id: string;\r\n  buyer: string;\r\n  seller: string;\r\n  title: string;\r\n  description: string;\r\n  price: number;\r\n  tags: string[];\r\n  status: 'pending' | 'accepted' | 'rejected' | 'edited' | 'paid';\r\n  date: string;\r\n  messageThreadId?: string; // Optional to match RequestContext\r\n  lastModifiedBy?: string; // Optional to match RequestContext\r\n  originalMessageId?: string; // Make optional to match RequestContext\r\n  paid?: boolean;\r\n}\r\n\r\n// Process messages to handle custom requests correctly\r\nexport function getLatestCustomRequestMessages(messages: Message[], requests: CustomRequest[]): Message[] {\r\n  const seen = new Set<string>();\r\n  const result: Message[] = [];\r\n\r\n  for (let i = messages.length - 1; i >= 0; i--) {\r\n    const msg = messages[i];\r\n    if (msg.type === 'customRequest' && msg.meta && msg.meta.id) {\r\n      if (!seen.has(msg.meta.id)) {\r\n        seen.add(msg.meta.id);\r\n        result.unshift(msg);\r\n      }\r\n    } else {\r\n      result.unshift(msg);\r\n    }\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n// Get the initial for avatar placeholder\r\nexport function getInitial(username: string): string {\r\n  return username.charAt(0).toUpperCase();\r\n}\r\n\r\n// Helper function to check if content is a single emoji\r\nexport function isSingleEmoji(content: string): boolean {\r\n  const emojiRegex = /^(\\p{Emoji_Presentation}|\\p{Extended_Pictographic})(\\u200d(\\p{Emoji_Presentation}|\\p{Extended_Pictographic}))*$/u;\r\n  return emojiRegex.test(content);\r\n}\r\n\r\n// Format time function\r\nexport function formatTimeAgo(date: string): string {\r\n  const now = new Date();\r\n  const messageDate = new Date(date);\r\n  const diffMs = now.getTime() - messageDate.getTime();\r\n  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n\r\n  if (diffDays > 0) {\r\n    return diffDays === 1 ? '1d ago' : `${diffDays}d ago`;\r\n  }\r\n\r\n  const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\r\n  if (diffHours > 0) {\r\n    return diffHours === 1 ? '1h ago' : `${diffHours}h ago`;\r\n  }\r\n\r\n  const diffMinutes = Math.floor(diffMs / (1000 * 60));\r\n  if (diffMinutes > 0) {\r\n    return diffMinutes === 1 ? '1m ago' : `${diffMinutes}m ago`;\r\n  }\r\n\r\n  return 'Just now';\r\n}\r\n\r\n// Additional utility functions for messages\r\nexport async function saveRecentEmojis(emojis: string[]): Promise<void> {\r\n  await storageService.setItem('recentEmojis', emojis);\r\n}\r\n\r\nexport async function getRecentEmojis(): Promise<string[]> {\r\n  return await storageService.getItem<string[]>('recentEmojis', []);\r\n}\r\n\r\nexport function validateImageSize(file: File): string | null {\r\n  const MAX_SIZE = 5 * 1024 * 1024; // 5MB\r\n  if (file.size > MAX_SIZE) {\r\n    return 'Image must be less than 5MB';\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function checkImageExists(base64String: string): boolean {\r\n  return !!base64String && base64String.startsWith('data:image/');\r\n}\r\n\r\nexport function getMessageKey(sender: string, receiver: string): string {\r\n  return [sender, receiver].sort().join('-');\r\n}\r\n\r\nexport function formatMessage(content: string): string {\r\n  // Simple formatting for now\r\n  return content.trim();\r\n}\r\n"],"names":[],"mappings":"AAAA,4BAA4B;;;;;;;;;;;;;AAC5B;AAAA;;AA6CO,SAAS,+BAA+B,QAAmB,EAAE,QAAyB;IAC3F,MAAM,OAAO,IAAI;IACjB,MAAM,SAAoB,EAAE;IAE5B,IAAK,IAAI,IAAI,SAAS,MAAM,GAAG,GAAG,KAAK,GAAG,IAAK;QAC7C,MAAM,MAAM,QAAQ,CAAC,EAAE;QACvB,IAAI,IAAI,IAAI,KAAK,mBAAmB,IAAI,IAAI,IAAI,IAAI,IAAI,CAAC,EAAE,EAAE;YAC3D,IAAI,CAAC,KAAK,GAAG,CAAC,IAAI,IAAI,CAAC,EAAE,GAAG;gBAC1B,KAAK,GAAG,CAAC,IAAI,IAAI,CAAC,EAAE;gBACpB,OAAO,OAAO,CAAC;YACjB;QACF,OAAO;YACL,OAAO,OAAO,CAAC;QACjB;IACF;IAEA,OAAO;AACT;AAGO,SAAS,WAAW,QAAgB;IACzC,OAAO,SAAS,MAAM,CAAC,GAAG,WAAW;AACvC;AAGO,SAAS,cAAc,OAAe;IAC3C,MAAM,aAAa;IACnB,OAAO,WAAW,IAAI,CAAC;AACzB;AAGO,SAAS,cAAc,IAAY;IACxC,MAAM,MAAM,IAAI;IAChB,MAAM,cAAc,IAAI,KAAK;IAC7B,MAAM,SAAS,IAAI,OAAO,KAAK,YAAY,OAAO;IAClD,MAAM,WAAW,KAAK,KAAK,CAAC,SAAS,CAAC,OAAO,KAAK,KAAK,EAAE;IAEzD,IAAI,WAAW,GAAG;QAChB,OAAO,aAAa,IAAI,WAAW,AAAC,GAAW,OAAT,UAAS;IACjD;IAEA,MAAM,YAAY,KAAK,KAAK,CAAC,SAAS,CAAC,OAAO,KAAK,EAAE;IACrD,IAAI,YAAY,GAAG;QACjB,OAAO,cAAc,IAAI,WAAW,AAAC,GAAY,OAAV,WAAU;IACnD;IAEA,MAAM,cAAc,KAAK,KAAK,CAAC,SAAS,CAAC,OAAO,EAAE;IAClD,IAAI,cAAc,GAAG;QACnB,OAAO,gBAAgB,IAAI,WAAW,AAAC,GAAc,OAAZ,aAAY;IACvD;IAEA,OAAO;AACT;AAGO,eAAe,iBAAiB,MAAgB;IACrD,MAAM,wIAAA,CAAA,iBAAc,CAAC,OAAO,CAAC,gBAAgB;AAC/C;AAEO,eAAe;IACpB,OAAO,MAAM,wIAAA,CAAA,iBAAc,CAAC,OAAO,CAAW,gBAAgB,EAAE;AAClE;AAEO,SAAS,kBAAkB,IAAU;IAC1C,MAAM,WAAW,IAAI,OAAO,MAAM,MAAM;IACxC,IAAI,KAAK,IAAI,GAAG,UAAU;QACxB,OAAO;IACT;IACA,OAAO;AACT;AAEO,SAAS,iBAAiB,YAAoB;IACnD,OAAO,CAAC,CAAC,gBAAgB,aAAa,UAAU,CAAC;AACnD;AAEO,SAAS,cAAc,MAAc,EAAE,QAAgB;IAC5D,OAAO;QAAC;QAAQ;KAAS,CAAC,IAAI,GAAG,IAAI,CAAC;AACxC;AAEO,SAAS,cAAc,OAAe;IAC3C,4BAA4B;IAC5B,OAAO,QAAQ,IAAI;AACrB","debugId":null}},
    {"offset": {"line": 1677, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/seller/messages/ThreadListItem.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport { Clock, BadgeCheck } from 'lucide-react';\r\nimport { formatTimeAgo, getInitial } from '@/utils/messageUtils';\r\nimport { sanitizeStrict } from '@/utils/security/sanitization';\r\nimport { SecureImage } from '@/components/ui/SecureMessageDisplay';\r\n\r\ninterface ThreadListItemProps {\r\n  buyer: string;\r\n  lastMessage: any;\r\n  isActive: boolean;\r\n  buyerProfile: {\r\n    pic: string | null;\r\n    verified: boolean;\r\n  };\r\n  unreadCount: number;\r\n  onClick: () => void;\r\n}\r\n\r\nexport default function ThreadListItem({\r\n  buyer,\r\n  lastMessage,\r\n  isActive,\r\n  buyerProfile,\r\n  unreadCount,\r\n  onClick,\r\n}: ThreadListItemProps) {\r\n  const sanitizedBuyer = sanitizeStrict(buyer);\r\n\r\n  // Debug click handler\r\n  const handleClick = () => {\r\n    console.log('=== ThreadListItem Click Debug ===');\r\n    console.log('Buyer:', buyer);\r\n    console.log('onClick function exists:', !!onClick);\r\n    console.log('Calling onClick...');\r\n\r\n    if (onClick) {\r\n      onClick();\r\n      console.log('onClick called successfully');\r\n    } else {\r\n      console.error('onClick is not defined!');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      onClick={handleClick}\r\n      className={`flex items-center p-3 cursor-pointer relative border-b border-gray-800 ${\r\n        isActive ? 'bg-[#2a2a2a]' : 'hover:bg-[#1a1a1a]'\r\n      } transition-colors duration-150 ease-in-out`}\r\n      style={{ userSelect: 'none' }}\r\n    >\r\n      {/* Active indicator */}\r\n      {isActive && <div className=\"absolute left-0 top-0 bottom-0 w-1 bg-[#ff950e]\"></div>}\r\n\r\n      {/* Avatar with unread indicator */}\r\n      <div className=\"relative mr-3 pointer-events-none\">\r\n        <div className=\"relative w-12 h-12 rounded-full bg-[#333] flex items-center justify-center text-white font-bold overflow-hidden shadow-md\">\r\n          {buyerProfile?.pic ? (\r\n            <SecureImage src={buyerProfile.pic} alt={sanitizedBuyer} className=\"w-full h-full object-cover\" />\r\n          ) : (\r\n            getInitial(sanitizedBuyer)\r\n          )}\r\n\r\n          {/* Verified badge if applicable */}\r\n          {buyerProfile?.verified && (\r\n            <div className=\"absolute bottom-0 right-0 bg-[#1a1a1a] p-0.5 rounded-full border border-[#ff950e] shadow-sm\">\r\n              <BadgeCheck size={12} className=\"text-[#ff950e]\" />\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Unread indicator */}\r\n        {unreadCount > 0 && (\r\n          <div className=\"absolute -top-1 -right-1 w-6 h-6 bg-[#ff950e] text-black text-xs rounded-full flex items-center justify-center font-bold border-2 border-[#121212] shadow-lg\">\r\n            {unreadCount}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Message preview */}\r\n      <div className=\"flex-1 min-w-0 pointer-events-none\">\r\n        <div className=\"flex justify-between\">\r\n          <h3 className=\"font-bold text-white truncate\">{sanitizedBuyer}</h3>\r\n          <span className=\"text-xs text-gray-400 whitespace-nowrap ml-1 flex items-center\">\r\n            <Clock size={12} className=\"mr-1\" />\r\n            {lastMessage ? formatTimeAgo(lastMessage.date) : ''}\r\n          </span>\r\n        </div>\r\n        <p className=\"text-sm text-gray-400 truncate\">\r\n          {lastMessage\r\n            ? lastMessage.type === 'customRequest'\r\n              ? '🛒 Custom Request'\r\n              : lastMessage.type === 'image'\r\n              ? '📷 Image'\r\n              : sanitizeStrict(lastMessage.content || '')\r\n            : ''}\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAGA;AAAA;AACA;AACA;AACA;AANA;;;;;;AAoBe,SAAS,eAAe,KAOjB;QAPiB,EACrC,KAAK,EACL,WAAW,EACX,QAAQ,EACR,YAAY,EACZ,WAAW,EACX,OAAO,EACa,GAPiB;IAQrC,MAAM,iBAAiB,CAAA,GAAA,2IAAA,CAAA,iBAAc,AAAD,EAAE;IAEtC,sBAAsB;IACtB,MAAM,cAAc;QAClB,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,UAAU;QACtB,QAAQ,GAAG,CAAC,4BAA4B,CAAC,CAAC;QAC1C,QAAQ,GAAG,CAAC;QAEZ,IAAI,SAAS;YACX;YACA,QAAQ,GAAG,CAAC;QACd,OAAO;YACL,QAAQ,KAAK,CAAC;QAChB;IACF;IAEA,qBACE,6LAAC;QACC,SAAS;QACT,WAAW,AAAC,0EAEX,OADC,WAAW,iBAAiB,sBAC7B;QACD,OAAO;YAAE,YAAY;QAAO;;YAG3B,0BAAY,6LAAC;gBAAI,WAAU;;;;;;0BAG5B,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;4BACZ,CAAA,yBAAA,mCAAA,aAAc,GAAG,kBAChB,6LAAC,mJAAA,CAAA,cAAW;gCAAC,KAAK,aAAa,GAAG;gCAAE,KAAK;gCAAgB,WAAU;;;;;uCAEnE,CAAA,GAAA,+HAAA,CAAA,aAAU,AAAD,EAAE;4BAIZ,CAAA,yBAAA,mCAAA,aAAc,QAAQ,mBACrB,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC,qNAAA,CAAA,aAAU;oCAAC,MAAM;oCAAI,WAAU;;;;;;;;;;;;;;;;;oBAMrC,cAAc,mBACb,6LAAC;wBAAI,WAAU;kCACZ;;;;;;;;;;;;0BAMP,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAG,WAAU;0CAAiC;;;;;;0CAC/C,6LAAC;gCAAK,WAAU;;kDACd,6LAAC,uMAAA,CAAA,QAAK;wCAAC,MAAM;wCAAI,WAAU;;;;;;oCAC1B,cAAc,CAAA,GAAA,+HAAA,CAAA,gBAAa,AAAD,EAAE,YAAY,IAAI,IAAI;;;;;;;;;;;;;kCAGrD,6LAAC;wBAAE,WAAU;kCACV,cACG,YAAY,IAAI,KAAK,kBACnB,sBACA,YAAY,IAAI,KAAK,UACrB,aACA,CAAA,GAAA,2IAAA,CAAA,iBAAc,AAAD,EAAE,YAAY,OAAO,IAAI,MACxC;;;;;;;;;;;;;;;;;;AAKd;KAlFwB","debugId":null}},
    {"offset": {"line": 1843, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/seller/messages/ThreadsSidebar.tsx"],"sourcesContent":["// src/components/sellers/messages/ThreadsSidebar.tsx\r\n'use client';\r\n\r\nimport React, { useMemo } from 'react';\r\nimport { MessageCircle, Filter, BellRing, Search } from 'lucide-react';\r\nimport ThreadListItem from './ThreadListItem';\r\nimport { SecureInput } from '@/components/ui/SecureInput';\r\n\r\ninterface ThreadsSidebarProps {\r\n  isAdmin: boolean;\r\n  threads: any;\r\n  lastMessages: any;\r\n  buyerProfiles: any;\r\n  totalUnreadCount: number;\r\n  uiUnreadCounts: any;\r\n  activeThread: string | null;\r\n  setActiveThread: (thread: string) => void;\r\n  searchQuery: string;\r\n  setSearchQuery: (query: string) => void;\r\n  filterBy: 'all' | 'unread';\r\n  setFilterBy: (filter: 'all' | 'unread') => void;\r\n  setObserverReadMessages: (messages: Set<string>) => void;\r\n}\r\n\r\nexport default function ThreadsSidebar({ \r\n  isAdmin,\r\n  threads,\r\n  lastMessages,\r\n  buyerProfiles,\r\n  totalUnreadCount,\r\n  uiUnreadCounts,\r\n  activeThread,\r\n  setActiveThread,\r\n  searchQuery,\r\n  setSearchQuery,\r\n  filterBy,\r\n  setFilterBy,\r\n  setObserverReadMessages\r\n}: ThreadsSidebarProps) {\r\n\r\n  // Filter and sort threads\r\n  const filteredAndSortedThreads = useMemo(() => {\r\n    const filteredThreads = Object.keys(threads).filter(buyer => {\r\n      const matchesSearch = searchQuery ? buyer.toLowerCase().includes(searchQuery.toLowerCase()) : true;\r\n      \r\n      if (!matchesSearch) return false;\r\n      \r\n      if (filterBy === 'unread') {\r\n        const hasUnread = uiUnreadCounts[buyer] > 0;\r\n        if (!hasUnread) return false;\r\n      }\r\n      \r\n      return true;\r\n    });\r\n    \r\n    return filteredThreads.sort((a, b) => {\r\n      const dateA = new Date(lastMessages[a]?.date || 0).getTime();\r\n      const dateB = new Date(lastMessages[b]?.date || 0).getTime();\r\n      return dateB - dateA;\r\n    });\r\n  }, [threads, lastMessages, uiUnreadCounts, searchQuery, filterBy]);\r\n\r\n  // Handle thread selection\r\n  const handleThreadSelect = (buyerId: string) => {\r\n    console.log('=== ThreadsSidebar handleThreadSelect ===');\r\n    console.log('Trying to select buyer:', buyerId);\r\n    console.log('Current activeThread:', activeThread);\r\n    console.log('setActiveThread function exists:', !!setActiveThread);\r\n    console.log('Threads available:', Object.keys(threads));\r\n    \r\n    if (activeThread === buyerId) {\r\n      console.log('Same thread already active, returning');\r\n      return;\r\n    }\r\n    \r\n    console.log('Calling setActiveThread with:', buyerId);\r\n    setActiveThread(buyerId);\r\n    setObserverReadMessages(new Set());\r\n    console.log('setActiveThread called');\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-full md:w-1/3 border-r border-gray-800 flex flex-col bg-[#121212]\">\r\n      {/* Header */}\r\n      <div className=\"px-4 pt-4 pb-2\">\r\n        <h2 className=\"text-2xl font-bold text-[#ff950e] mb-2 flex items-center\">\r\n          <MessageCircle size={24} className=\"mr-2 text-[#ff950e]\" />\r\n          {isAdmin ? 'Admin Messages' : 'My Messages'}\r\n        </h2>\r\n        \r\n        {/* Filter buttons */}\r\n        <div className=\"flex space-x-2 mb-3\">\r\n          <button \r\n            onClick={() => setFilterBy('all')}\r\n            className={`px-4 py-2 rounded-full text-sm font-medium transition flex items-center ${\r\n              filterBy === 'all' \r\n                ? 'bg-[#ff950e] text-black' \r\n                : 'bg-[#1a1a1a] text-white hover:bg-[#222]'\r\n            }`}\r\n          >\r\n            <Filter size={14} className=\"mr-1\" />\r\n            All Messages\r\n          </button>\r\n          <button \r\n            onClick={() => setFilterBy('unread')}\r\n            className={`px-4 py-2 rounded-full text-sm font-medium transition flex items-center ${\r\n              filterBy === 'unread' \r\n                ? 'bg-[#ff950e] text-black' \r\n                : 'bg-[#1a1a1a] text-white hover:bg-[#222]'\r\n            }`}\r\n          >\r\n            <BellRing size={14} className=\"mr-1\" />\r\n            Unread\r\n            {totalUnreadCount > 0 && (\r\n              <span className=\"ml-1 bg-[#ff950e] text-black rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold border border-black\">\r\n                {totalUnreadCount}\r\n              </span>\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Search Bar */}\r\n      <div className=\"px-4 pb-3\">\r\n        <div className=\"relative\">\r\n          <SecureInput\r\n            type=\"text\"\r\n            placeholder=\"Search Buyers...\"\r\n            value={searchQuery}\r\n            onChange={setSearchQuery}\r\n            className=\"w-full py-2 px-4 pr-10 rounded-full bg-[#222] border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-[#ff950e] focus:border-transparent\"\r\n            maxLength={100}\r\n          />\r\n          <div className=\"absolute right-3 top-2.5 text-gray-400 pointer-events-none\">\r\n            <Search size={18} />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Thread list */}\r\n      <div className=\"flex-1 overflow-y-auto bg-[#121212]\">\r\n        {filteredAndSortedThreads.length === 0 ? (\r\n          <div className=\"p-4 text-center text-gray-400\">\r\n            No conversations found\r\n          </div>\r\n        ) : (\r\n          filteredAndSortedThreads.map((buyer) => (\r\n            <ThreadListItem\r\n              key={buyer}\r\n              buyer={buyer}\r\n              lastMessage={lastMessages[buyer]}\r\n              isActive={activeThread === buyer}\r\n              buyerProfile={buyerProfiles[buyer]}\r\n              unreadCount={uiUnreadCounts[buyer]}\r\n              onClick={() => handleThreadSelect(buyer)}\r\n            />\r\n          ))\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2084, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/utils/format.ts"],"sourcesContent":["// src/utils/format.ts\r\n\r\nimport { Money, ISOTimestamp } from '@/types/common';\r\nimport { Transaction } from '@/services/wallet.service';\r\n\r\n// Define types locally from the Transaction interface\r\ntype TransactionType = Transaction['type'];\r\ntype TransactionStatus = Transaction['status'];\r\n\r\n/**\r\n * Enhanced formatting utilities with proper Money type support\r\n */\r\n\r\n/**\r\n * Format user activity status\r\n * @param isOnline Whether user is currently online\r\n * @param lastActive The last active timestamp\r\n * @returns Formatted activity string\r\n */\r\nexport function formatActivityStatus(isOnline: boolean, lastActive: Date | null): string {\r\n  if (isOnline) {\r\n    return 'Active now';\r\n  }\r\n  \r\n  if (!lastActive) {\r\n    return 'Offline';\r\n  }\r\n  \r\n  const now = new Date();\r\n  const diffMs = now.getTime() - lastActive.getTime();\r\n  const diffSeconds = Math.floor(diffMs / 1000);\r\n  const diffMinutes = Math.floor(diffSeconds / 60);\r\n  const diffHours = Math.floor(diffMinutes / 60);\r\n  const diffDays = Math.floor(diffHours / 24);\r\n  \r\n  if (diffMinutes < 1) {\r\n    return 'Active just now';\r\n  } else if (diffMinutes < 60) {\r\n    return `Active ${diffMinutes}m ago`;\r\n  } else if (diffHours < 24) {\r\n    return `Active ${diffHours}h ago`;\r\n  } else if (diffDays === 1) {\r\n    return 'Active yesterday';\r\n  } else if (diffDays < 7) {\r\n    return `Active ${diffDays}d ago`;\r\n  } else {\r\n    return 'Offline';\r\n  }\r\n}\r\n\r\n/**\r\n * Format Money type to currency string\r\n * @param amount The Money amount (in cents)\r\n * @param locale The locale to use (default: 'en-US')\r\n * @param currency The currency code to use (default: 'USD')\r\n * @returns A formatted currency string\r\n */\r\nexport function formatMoney(\r\n  amount: Money,\r\n  locale: string = 'en-US',\r\n  currency: string = 'USD'\r\n): string {\r\n  // Convert from cents to dollars\r\n  const dollars = Money.toDollars(amount);\r\n  \r\n  return new Intl.NumberFormat(locale, {\r\n    style: 'currency',\r\n    currency,\r\n    minimumFractionDigits: 2,\r\n    maximumFractionDigits: 2\r\n  }).format(dollars);\r\n}\r\n\r\n/**\r\n * Format Money with sign (+ or -)\r\n * @param amount The Money amount\r\n * @param isCredit Whether this is a credit (positive) or debit (negative)\r\n * @returns Formatted string with sign\r\n */\r\nexport function formatMoneyWithSign(\r\n  amount: Money,\r\n  isCredit: boolean,\r\n  locale: string = 'en-US',\r\n  currency: string = 'USD'\r\n): string {\r\n  const formatted = formatMoney(amount, locale, currency);\r\n  return isCredit ? `+${formatted}` : `-${formatted}`;\r\n}\r\n\r\n/**\r\n * Format Money range\r\n * @param min Minimum amount\r\n * @param max Maximum amount\r\n * @returns Formatted range string\r\n */\r\nexport function formatMoneyRange(\r\n  min: Money,\r\n  max: Money,\r\n  locale: string = 'en-US',\r\n  currency: string = 'USD'\r\n): string {\r\n  return `${formatMoney(min, locale, currency)} - ${formatMoney(max, locale, currency)}`;\r\n}\r\n\r\n/**\r\n * Format transaction for display\r\n * @param transaction The transaction to format\r\n * @param currentUserId The current user's ID to determine credit/debit\r\n * @returns Formatted transaction display data\r\n */\r\nexport function formatTransaction(\r\n  transaction: Transaction,\r\n  currentUserId?: string\r\n): {\r\n  amount: string;\r\n  type: string;\r\n  status: string;\r\n  date: string;\r\n  time: string;\r\n  description: string;\r\n  isCredit: boolean;\r\n  icon: string;\r\n  color: string;\r\n} {\r\n  // Determine if credit or debit\r\n  const isCredit = transaction.to === currentUserId || \r\n                   transaction.type === 'deposit' || \r\n                   transaction.type === 'admin_credit' ||\r\n                   transaction.type === 'tier_credit';\r\n\r\n  // Format amount with sign\r\n  const amount = formatMoneyWithSign(transaction.amount, isCredit);\r\n\r\n  // Format type\r\n  const typeLabels: Record<TransactionType, string> = {\r\n    deposit: 'Deposit',\r\n    withdrawal: 'Withdrawal',\r\n    purchase: 'Purchase',\r\n    sale: 'Sale',\r\n    tip: 'Tip',\r\n    subscription: 'Subscription',\r\n    admin_credit: 'Credit',\r\n    admin_debit: 'Debit',\r\n    refund: 'Refund',\r\n    fee: 'Fee',\r\n    tier_credit: 'Bonus',\r\n  };\r\n\r\n  // Format status\r\n  const statusLabels: Record<TransactionStatus, string> = {\r\n    pending: 'Pending',\r\n    completed: 'Completed',\r\n    failed: 'Failed',\r\n    cancelled: 'Cancelled',\r\n  };\r\n\r\n  // Get icon and color based on type\r\n  const typeConfig = getTransactionTypeConfig(transaction.type);\r\n\r\n  return {\r\n    amount,\r\n    type: typeLabels[transaction.type],\r\n    status: statusLabels[transaction.status],\r\n    date: formatShortDate(transaction.createdAt),\r\n    time: formatTime(transaction.createdAt),\r\n    description: transaction.description,\r\n    isCredit,\r\n    icon: typeConfig.icon,\r\n    color: typeConfig.color,\r\n  };\r\n}\r\n\r\n/**\r\n * Get transaction type configuration\r\n */\r\nfunction getTransactionTypeConfig(type: TransactionType): {\r\n  icon: string;\r\n  color: string;\r\n} {\r\n  const config: Record<TransactionType, { icon: string; color: string }> = {\r\n    deposit: { icon: 'download', color: 'text-green-500' },\r\n    withdrawal: { icon: 'upload', color: 'text-red-500' },\r\n    purchase: { icon: 'shopping-bag', color: 'text-blue-500' },\r\n    sale: { icon: 'tag', color: 'text-green-500' },\r\n    tip: { icon: 'gift', color: 'text-purple-500' },\r\n    subscription: { icon: 'repeat', color: 'text-indigo-500' },\r\n    admin_credit: { icon: 'plus-circle', color: 'text-green-500' },\r\n    admin_debit: { icon: 'minus-circle', color: 'text-red-500' },\r\n    refund: { icon: 'rotate-ccw', color: 'text-orange-500' },\r\n    fee: { icon: 'percent', color: 'text-gray-500' },\r\n    tier_credit: { icon: 'star', color: 'text-yellow-500' },\r\n  };\r\n\r\n  return config[type] || { icon: 'circle', color: 'text-gray-500' };\r\n}\r\n\r\n/**\r\n * Format percentage with proper decimal places\r\n * @param value The percentage value (0-100)\r\n * @param decimals Number of decimal places\r\n * @returns Formatted percentage string\r\n */\r\nexport function formatPercentage(value: number, decimals: number = 1): string {\r\n  return `${value.toFixed(decimals)}%`;\r\n}\r\n\r\n/**\r\n * Format transaction fee breakdown\r\n * @param amount The total amount\r\n * @param feePercent The fee percentage (0-1)\r\n * @returns Object with formatted amounts\r\n */\r\nexport function formatFeeBreakdown(\r\n  amount: Money,\r\n  feePercent: number\r\n): {\r\n  total: string;\r\n  fee: string;\r\n  net: string;\r\n  feePercentage: string;\r\n} {\r\n  const fee = Math.floor(amount * feePercent) as Money;\r\n  const net = (amount - fee) as Money;\r\n\r\n  return {\r\n    total: formatMoney(amount),\r\n    fee: formatMoney(fee),\r\n    net: formatMoney(net),\r\n    feePercentage: formatPercentage(feePercent * 100),\r\n  };\r\n}\r\n\r\n/**\r\n * Format wallet balance with status\r\n * @param balance Current balance\r\n * @param available Available balance\r\n * @param pending Pending balance\r\n * @returns Formatted balance display\r\n */\r\nexport function formatWalletBalance(\r\n  balance: Money,\r\n  available: Money,\r\n  pending: Money\r\n): {\r\n  balance: string;\r\n  available: string;\r\n  pending: string;\r\n  hasRestriction: boolean;\r\n  restrictionAmount: string;\r\n} {\r\n  const restriction = balance - available - pending;\r\n  \r\n  return {\r\n    balance: formatMoney(balance),\r\n    available: formatMoney(available),\r\n    pending: formatMoney(pending),\r\n    hasRestriction: restriction > 0,\r\n    restrictionAmount: formatMoney(restriction as Money),\r\n  };\r\n}\r\n\r\n/**\r\n * Format daily/monthly limits\r\n * @param used Amount used\r\n * @param limit Total limit\r\n * @returns Formatted limit display\r\n */\r\nexport function formatLimit(\r\n  used: Money,\r\n  limit: Money\r\n): {\r\n  used: string;\r\n  limit: string;\r\n  remaining: string;\r\n  percentage: number;\r\n  percentageFormatted: string;\r\n  isExceeded: boolean;\r\n} {\r\n  const remaining = Math.max(0, limit - used) as Money;\r\n  const percentage = limit > 0 ? (Money.toDollars(used) / Money.toDollars(limit)) * 100 : 0;\r\n  \r\n  return {\r\n    used: formatMoney(used),\r\n    limit: formatMoney(limit),\r\n    remaining: formatMoney(remaining),\r\n    percentage,\r\n    percentageFormatted: formatPercentage(percentage),\r\n    isExceeded: used > limit,\r\n  };\r\n}\r\n\r\n/**\r\n * Format risk score\r\n * @param score Risk score (0-100)\r\n * @returns Formatted risk display\r\n */\r\nexport function formatRiskScore(score: number): {\r\n  score: number;\r\n  level: 'low' | 'medium' | 'high' | 'critical';\r\n  color: string;\r\n  label: string;\r\n} {\r\n  let level: 'low' | 'medium' | 'high' | 'critical';\r\n  let color: string;\r\n  let label: string;\r\n\r\n  if (score < 25) {\r\n    level = 'low';\r\n    color = 'text-green-500';\r\n    label = 'Low Risk';\r\n  } else if (score < 50) {\r\n    level = 'medium';\r\n    color = 'text-yellow-500';\r\n    label = 'Medium Risk';\r\n  } else if (score < 75) {\r\n    level = 'high';\r\n    color = 'text-orange-500';\r\n    label = 'High Risk';\r\n  } else {\r\n    level = 'critical';\r\n    color = 'text-red-500';\r\n    label = 'Critical Risk';\r\n  }\r\n\r\n  return { score, level, color, label };\r\n}\r\n\r\n/**\r\n * Format reconciliation result\r\n * @param current Current balance\r\n * @param calculated Calculated balance\r\n * @returns Formatted reconciliation display\r\n */\r\nexport function formatReconciliation(\r\n  current: Money,\r\n  calculated: Money\r\n): {\r\n  current: string;\r\n  calculated: string;\r\n  discrepancy: string;\r\n  isReconciled: boolean;\r\n  discrepancyType: 'over' | 'under' | 'none';\r\n} {\r\n  const discrepancy = (current - calculated) as Money;\r\n  \r\n  return {\r\n    current: formatMoney(current),\r\n    calculated: formatMoney(calculated),\r\n    discrepancy: formatMoney(Math.abs(discrepancy) as Money),\r\n    isReconciled: discrepancy === 0,\r\n    discrepancyType: discrepancy > 0 ? 'over' : discrepancy < 0 ? 'under' : 'none',\r\n  };\r\n}\r\n\r\n/**\r\n * Format date helpers (enhanced versions)\r\n */\r\nexport function formatShortDate(date: string | Date | ISOTimestamp): string {\r\n  const dateObj = typeof date === 'string' ? new Date(date) : date;\r\n  \r\n  if (isNaN(dateObj.getTime())) {\r\n    return 'Invalid date';\r\n  }\r\n  \r\n  const now = new Date();\r\n  const diffDays = Math.floor((now.getTime() - dateObj.getTime()) / (1000 * 60 * 60 * 24));\r\n  \r\n  if (diffDays === 0) {\r\n    return 'Today';\r\n  } else if (diffDays === 1) {\r\n    return 'Yesterday';\r\n  } else if (diffDays < 7) {\r\n    return dateObj.toLocaleDateString(undefined, { weekday: 'long' });\r\n  }\r\n  \r\n  return dateObj.toLocaleDateString(undefined, {\r\n    month: 'short',\r\n    day: 'numeric',\r\n    year: dateObj.getFullYear() !== now.getFullYear() ? 'numeric' : undefined,\r\n  });\r\n}\r\n\r\nexport function formatTime(date: string | Date | ISOTimestamp): string {\r\n  const dateObj = typeof date === 'string' ? new Date(date) : date;\r\n  \r\n  if (isNaN(dateObj.getTime())) {\r\n    return 'Invalid time';\r\n  }\r\n  \r\n  return dateObj.toLocaleTimeString(undefined, {\r\n    hour: 'numeric',\r\n    minute: '2-digit',\r\n    hour12: true,\r\n  });\r\n}\r\n\r\n/**\r\n * Format transaction summary\r\n * @param transactions Array of transactions\r\n * @returns Summary statistics\r\n */\r\nexport function formatTransactionSummary(\r\n  transactions: Transaction[]\r\n): {\r\n  totalIn: string;\r\n  totalOut: string;\r\n  netFlow: string;\r\n  count: number;\r\n  averageSize: string;\r\n} {\r\n  let totalIn = 0;\r\n  let totalOut = 0;\r\n  \r\n  transactions.forEach(t => {\r\n    if (t.status === 'completed') {\r\n      if (t.type === 'deposit' || t.type === 'admin_credit' || t.type === 'tier_credit') {\r\n        totalIn += t.amount;\r\n      } else if (t.type === 'withdrawal' || t.type === 'admin_debit') {\r\n        totalOut += t.amount;\r\n      }\r\n    }\r\n  });\r\n  \r\n  const netFlow = (totalIn - totalOut) as Money;\r\n  const averageSize = transactions.length > 0 \r\n    ? Math.floor(transactions.reduce((sum, t) => sum + t.amount, 0) / transactions.length) as Money\r\n    : 0 as Money;\r\n  \r\n  return {\r\n    totalIn: formatMoney(totalIn as Money),\r\n    totalOut: formatMoney(totalOut as Money),\r\n    netFlow: formatMoneyWithSign(netFlow, netFlow >= 0),\r\n    count: transactions.length,\r\n    averageSize: formatMoney(averageSize),\r\n  };\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2382, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/hooks/useUserActivityStatus.ts"],"sourcesContent":["// src/hooks/useUserActivityStatus.ts\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { useWebSocket } from '@/context/WebSocketContext';\r\nimport { useAuth } from '@/context/AuthContext';\r\n\r\ninterface ActivityStatus {\r\n  isOnline: boolean;\r\n  lastActive: Date | null;\r\n}\r\n\r\nexport function useUserActivityStatus(username: string | null) {\r\n  const [activityStatus, setActivityStatus] = useState<ActivityStatus>({\r\n    isOnline: false,\r\n    lastActive: null\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  const wsContext = useWebSocket();\r\n  const { apiClient } = useAuth();\r\n  \r\n  // Handler functions wrapped in useCallback to prevent recreation\r\n  const handleStatusUpdate = useCallback((data: any) => {\r\n    if (!username) return;\r\n    \r\n    console.log(`[useUserActivityStatus] Processing user:status event for ${username}:`, data);\r\n    \r\n    if (data.username === username) {\r\n      console.log(`[useUserActivityStatus] ✅ Status update matches ${username}: online=${data.isOnline}`);\r\n      setActivityStatus({\r\n        isOnline: Boolean(data.isOnline),\r\n        lastActive: data.lastActive ? new Date(data.lastActive) : new Date()\r\n      });\r\n    }\r\n  }, [username]);\r\n  \r\n  const handleOnlineEvent = useCallback((data: any) => {\r\n    if (!username) return;\r\n    \r\n    console.log(`[useUserActivityStatus] Processing user:online event for ${username}:`, data);\r\n    \r\n    if (data.username === username) {\r\n      console.log(`[useUserActivityStatus] ✅ ${username} is now ONLINE`);\r\n      setActivityStatus({\r\n        isOnline: true,\r\n        lastActive: new Date()\r\n      });\r\n    }\r\n  }, [username]);\r\n  \r\n  const handleOfflineEvent = useCallback((data: any) => {\r\n    if (!username) return;\r\n    \r\n    console.log(`[useUserActivityStatus] Processing user:offline event for ${username}:`, data);\r\n    \r\n    if (data.username === username) {\r\n      console.log(`[useUserActivityStatus] ✅ ${username} is now OFFLINE`);\r\n      setActivityStatus({\r\n        isOnline: false,\r\n        lastActive: data.lastActive ? new Date(data.lastActive) : new Date()\r\n      });\r\n    }\r\n  }, [username]);\r\n  \r\n  // Main effect for fetching and subscribing\r\n  useEffect(() => {\r\n    if (!username) {\r\n      setActivityStatus({ isOnline: false, lastActive: null });\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    \r\n    let mounted = true;\r\n    const unsubscribers: (() => void)[] = [];\r\n    \r\n    // First, set up WebSocket subscriptions if available\r\n    if (wsContext) {\r\n      console.log(`[useUserActivityStatus] Subscribing to WebSocket events for ${username}`);\r\n      \r\n      try {\r\n        // Subscribe to all status events\r\n        const unsub1 = wsContext.subscribe('user:status', handleStatusUpdate);\r\n        const unsub2 = wsContext.subscribe('user:online', handleOnlineEvent);\r\n        const unsub3 = wsContext.subscribe('user:offline', handleOfflineEvent);\r\n        \r\n        unsubscribers.push(unsub1, unsub2, unsub3);\r\n        \r\n        console.log(`[useUserActivityStatus] ✅ Successfully subscribed to events for ${username}`);\r\n      } catch (error) {\r\n        console.error(`[useUserActivityStatus] Error subscribing to events:`, error);\r\n      }\r\n    } else {\r\n      console.warn(`[useUserActivityStatus] No WebSocket context available for ${username}`);\r\n    }\r\n    \r\n    // Then fetch initial status from API\r\n    const fetchInitialStatus = async () => {\r\n      try {\r\n        console.log(`[useUserActivityStatus] Fetching initial status for ${username}...`);\r\n        const response = await apiClient.get(`/messages/user-status/${username}`);\r\n        \r\n        if (mounted && response.success && response.data) {\r\n          console.log(`[useUserActivityStatus] Initial status for ${username}:`, response.data);\r\n          setActivityStatus({\r\n            isOnline: response.data.isOnline || false,\r\n            lastActive: response.data.lastActive ? new Date(response.data.lastActive) : null\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error(`[useUserActivityStatus] Error fetching status for ${username}:`, error);\r\n      } finally {\r\n        if (mounted) {\r\n          setLoading(false);\r\n        }\r\n      }\r\n    };\r\n    \r\n    fetchInitialStatus();\r\n    \r\n    // Cleanup function\r\n    return () => {\r\n      mounted = false;\r\n      console.log(`[useUserActivityStatus] Unsubscribing from events for ${username}`);\r\n      unsubscribers.forEach(unsub => {\r\n        try {\r\n          unsub();\r\n        } catch (error) {\r\n          console.error(`[useUserActivityStatus] Error unsubscribing:`, error);\r\n        }\r\n      });\r\n    };\r\n  }, [username, wsContext, apiClient, handleStatusUpdate, handleOnlineEvent, handleOfflineEvent]);\r\n  \r\n  // Update relative times periodically\r\n  useEffect(() => {\r\n    if (!activityStatus.isOnline && activityStatus.lastActive) {\r\n      const interval = setInterval(() => {\r\n        // Force a re-render to update the relative time display\r\n        setActivityStatus(prev => ({ ...prev }));\r\n      }, 60000); // Update every minute\r\n      \r\n      return () => clearInterval(interval);\r\n    }\r\n    return undefined;\r\n  }, [activityStatus.isOnline, activityStatus.lastActive]);\r\n  \r\n  return { activityStatus, loading };\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2569, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/seller/messages/ChatHeader.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport { BadgeCheck, Sparkles, AlertTriangle, ShieldAlert } from 'lucide-react';\r\nimport { getInitial } from '@/utils/messageUtils';\r\nimport { sanitizeStrict } from '@/utils/security/sanitization';\r\nimport { formatActivityStatus } from '@/utils/format';\r\nimport { useUserActivityStatus } from '@/hooks/useUserActivityStatus';\r\nimport { SecureImage } from '@/components/ui/SecureMessageDisplay';\r\n\r\ninterface ChatHeaderProps {\r\n  activeThread: string;\r\n  buyerProfile: {\r\n    pic: string | null;\r\n    verified: boolean;\r\n  } | undefined; // allow undefined and handle safely\r\n  isUserReported: boolean;\r\n  isUserBlocked: boolean;\r\n  onReport: () => void;\r\n  onBlockToggle: () => void;\r\n}\r\n\r\nexport default function ChatHeader({\r\n  activeThread,\r\n  buyerProfile,\r\n  isUserReported,\r\n  isUserBlocked,\r\n  onReport,\r\n  onBlockToggle,\r\n}: ChatHeaderProps) {\r\n  const sanitizedActiveThread = sanitizeStrict(activeThread);\r\n\r\n  // Guard against undefined shape while loading\r\n  const { activityStatus = { isOnline: false, lastActive: null }, loading } =\r\n    useUserActivityStatus(activeThread);\r\n\r\n  const getActivityDisplay = () => {\r\n    if (isUserBlocked) return 'Blocked';\r\n    if (loading) return '...';\r\n    return formatActivityStatus(activityStatus.isOnline, activityStatus.lastActive);\r\n  };\r\n\r\n  const verified = !!buyerProfile?.verified;\r\n  const pic = buyerProfile?.pic || null;\r\n\r\n  return (\r\n    <div className=\"px-4 py-3 flex items-center justify-between border-b border-gray-800 bg-[#1a1a1a]\">\r\n      <div className=\"flex items-center\">\r\n        <div className=\"relative w-10 h-10 rounded-full bg-[#333] flex items-center justify-center text-white font-bold mr-3 overflow-hidden shadow-md\">\r\n          {pic ? (\r\n            <SecureImage src={pic} alt={sanitizedActiveThread} className=\"w-full h-full object-cover\" />\r\n          ) : (\r\n            getInitial(sanitizedActiveThread)\r\n          )}\r\n\r\n          {verified && (\r\n            <div className=\"absolute bottom-0 right-0 bg-[#1a1a1a] p-0.5 rounded-full border border-[#ff950e] shadow-sm\">\r\n              <BadgeCheck size={12} className=\"text-[#ff950e]\" aria-label=\"Verified\" />\r\n            </div>\r\n          )}\r\n\r\n          {activityStatus?.isOnline && !isUserBlocked && (\r\n            <div\r\n              className=\"absolute bottom-0 left-0 w-3 h-3 bg-green-500 rounded-full border-2 border-[#1a1a1a]\"\r\n              aria-label=\"Online\"\r\n            />\r\n          )}\r\n        </div>\r\n        <div>\r\n          <h2 className=\"font-bold text-lg text-white\">{sanitizedActiveThread}</h2>\r\n          <p\r\n            className={`text-xs flex items-center ${\r\n              activityStatus?.isOnline && !isUserBlocked ? 'text-green-400' : 'text-gray-400'\r\n            }`}\r\n          >\r\n            {activityStatus?.isOnline && !isUserBlocked && (\r\n              <Sparkles size={12} className=\"mr-1 text-green-400\" />\r\n            )}\r\n            {getActivityDisplay()}\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex space-x-2 text-white\">\r\n        <button\r\n          onClick={onReport}\r\n          disabled={isUserReported}\r\n          className={`px-3 py-1 text-xs border rounded flex items-center ${\r\n            isUserReported ? 'text-gray-400 border-gray-500' : 'text-red-500 border-red-500 hover:bg-red-500/10'\r\n          } transition-colors duration-150`}\r\n          title={isUserReported ? 'Already reported' : 'Report user'}\r\n          aria-disabled={isUserReported}\r\n        >\r\n          <AlertTriangle size={12} className=\"mr-1\" />\r\n          {isUserReported ? 'Reported' : 'Report'}\r\n        </button>\r\n        <button\r\n          onClick={onBlockToggle}\r\n          className={`px-3 py-1 text-xs border rounded flex items-center ${\r\n            isUserBlocked\r\n              ? 'text-green-500 border-green-500 hover:bg-green-500/10'\r\n              : 'text-red-500 border-red-500 hover:bg-red-500/10'\r\n          } transition-colors duration-150`}\r\n          title={isUserBlocked ? 'Unblock user' : 'Block user'}\r\n        >\r\n          <ShieldAlert size={12} className=\"mr-1\" />\r\n          {isUserBlocked ? 'Unblock' : 'Block'}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAGA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;AARA;;;;;;;AAsBe,SAAS,WAAW,KAOjB;QAPiB,EACjC,YAAY,EACZ,YAAY,EACZ,cAAc,EACd,aAAa,EACb,QAAQ,EACR,aAAa,EACG,GAPiB;;IAQjC,MAAM,wBAAwB,CAAA,GAAA,2IAAA,CAAA,iBAAc,AAAD,EAAE;IAE7C,8CAA8C;IAC9C,MAAM,EAAE,iBAAiB;QAAE,UAAU;QAAO,YAAY;IAAK,CAAC,EAAE,OAAO,EAAE,GACvE,CAAA,GAAA,wIAAA,CAAA,wBAAqB,AAAD,EAAE;IAExB,MAAM,qBAAqB;QACzB,IAAI,eAAe,OAAO;QAC1B,IAAI,SAAS,OAAO;QACpB,OAAO,CAAA,GAAA,yHAAA,CAAA,uBAAoB,AAAD,EAAE,eAAe,QAAQ,EAAE,eAAe,UAAU;IAChF;IAEA,MAAM,WAAW,CAAC,EAAC,yBAAA,mCAAA,aAAc,QAAQ;IACzC,MAAM,MAAM,CAAA,yBAAA,mCAAA,aAAc,GAAG,KAAI;IAEjC,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;4BACZ,oBACC,6LAAC,mJAAA,CAAA,cAAW;gCAAC,KAAK;gCAAK,KAAK;gCAAuB,WAAU;;;;;uCAE7D,CAAA,GAAA,+HAAA,CAAA,aAAU,AAAD,EAAE;4BAGZ,0BACC,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC,qNAAA,CAAA,aAAU;oCAAC,MAAM;oCAAI,WAAU;oCAAiB,cAAW;;;;;;;;;;;4BAI/D,CAAA,2BAAA,qCAAA,eAAgB,QAAQ,KAAI,CAAC,+BAC5B,6LAAC;gCACC,WAAU;gCACV,cAAW;;;;;;;;;;;;kCAIjB,6LAAC;;0CACC,6LAAC;gCAAG,WAAU;0CAAgC;;;;;;0CAC9C,6LAAC;gCACC,WAAW,AAAC,6BAEX,OADC,CAAA,2BAAA,qCAAA,eAAgB,QAAQ,KAAI,CAAC,gBAAgB,mBAAmB;;oCAGjE,CAAA,2BAAA,qCAAA,eAAgB,QAAQ,KAAI,CAAC,+BAC5B,6LAAC,6MAAA,CAAA,WAAQ;wCAAC,MAAM;wCAAI,WAAU;;;;;;oCAE/B;;;;;;;;;;;;;;;;;;;0BAKP,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBACC,SAAS;wBACT,UAAU;wBACV,WAAW,AAAC,sDAEX,OADC,iBAAiB,kCAAkC,mDACpD;wBACD,OAAO,iBAAiB,qBAAqB;wBAC7C,iBAAe;;0CAEf,6LAAC,2NAAA,CAAA,gBAAa;gCAAC,MAAM;gCAAI,WAAU;;;;;;4BAClC,iBAAiB,aAAa;;;;;;;kCAEjC,6LAAC;wBACC,SAAS;wBACT,WAAW,AAAC,sDAIX,OAHC,gBACI,0DACA,mDACL;wBACD,OAAO,gBAAgB,iBAAiB;;0CAExC,6LAAC,uNAAA,CAAA,cAAW;gCAAC,MAAM;gCAAI,WAAU;;;;;;4BAChC,gBAAgB,YAAY;;;;;;;;;;;;;;;;;;;AAKvC;GAzFwB;;QAYpB,wIAAA,CAAA,wBAAqB;;;KAZD","debugId":null}},
    {"offset": {"line": 2770, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/hooks/useIntersectionObserver.ts"],"sourcesContent":["// src/hooks/useIntersectionObserver.ts\r\nimport { useEffect, useCallback, useRef, useState } from 'react';\r\n\r\ninterface IntersectionObserverOptions extends IntersectionObserverInit {\r\n  onIntersect: () => void;\r\n  enabled?: boolean; // Added to allow disabling the observer\r\n}\r\n\r\nexport function useIntersectionObserver(\r\n  targetRef: React.RefObject<HTMLElement | null>,\r\n  options: IntersectionObserverOptions\r\n) {\r\n  // Use refs to maintain stable references\r\n  const savedCallback = useRef(options.onIntersect);\r\n  const observerRef = useRef<IntersectionObserver | null>(null);\r\n\r\n  // Update callback ref when it changes\r\n  useEffect(() => {\r\n    savedCallback.current = options.onIntersect;\r\n  }, [options.onIntersect]);\r\n\r\n  // Validate and normalize threshold\r\n  const normalizedThreshold = useCallback(() => {\r\n    const threshold = options.threshold;\r\n    \r\n    if (threshold === undefined || threshold === null) {\r\n      return 0.5;\r\n    }\r\n    \r\n    // Handle array of thresholds\r\n    if (Array.isArray(threshold)) {\r\n      return threshold.map(t => {\r\n        const num = Number(t);\r\n        return isNaN(num) ? 0.5 : Math.max(0, Math.min(1, num));\r\n      });\r\n    }\r\n    \r\n    // Handle single threshold\r\n    const num = Number(threshold);\r\n    return isNaN(num) ? 0.5 : Math.max(0, Math.min(1, num));\r\n  }, [options.threshold]);\r\n\r\n  useEffect(() => {\r\n    // Check if observation is enabled (default to true)\r\n    if (options.enabled === false) {\r\n      return;\r\n    }\r\n\r\n    // Check for IntersectionObserver support\r\n    if (typeof window === 'undefined' || !window.IntersectionObserver) {\r\n      console.warn('IntersectionObserver is not supported in this browser');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Create stable callback\r\n      const callback: IntersectionObserverCallback = (entries) => {\r\n        entries.forEach((entry) => {\r\n          if (entry.isIntersecting && savedCallback.current) {\r\n            try {\r\n              savedCallback.current();\r\n            } catch (error) {\r\n              console.error('Error in intersection observer callback:', error);\r\n            }\r\n          }\r\n        });\r\n      };\r\n\r\n      // Create observer with validated options\r\n      observerRef.current = new IntersectionObserver(\r\n        callback,\r\n        {\r\n          root: options.root || null,\r\n          rootMargin: options.rootMargin || '0px',\r\n          threshold: normalizedThreshold()\r\n        }\r\n      );\r\n\r\n      // Start observing\r\n      const target = targetRef.current;\r\n      if (target && observerRef.current) {\r\n        observerRef.current.observe(target);\r\n      }\r\n\r\n      // Cleanup function\r\n      return () => {\r\n        if (observerRef.current) {\r\n          observerRef.current.disconnect();\r\n          observerRef.current = null;\r\n        }\r\n      };\r\n    } catch (error) {\r\n      console.error('Error creating IntersectionObserver:', error);\r\n      return undefined;\r\n    }\r\n  }, [\r\n    targetRef,\r\n    options.root,\r\n    options.rootMargin,\r\n    options.enabled,\r\n    normalizedThreshold\r\n  ]);\r\n\r\n  // Return observer instance for advanced use cases\r\n  return observerRef.current;\r\n}\r\n\r\n// Additional hook for observing multiple elements\r\nexport function useIntersectionObserverMultiple(\r\n  targetsRef: React.RefObject<HTMLElement[]>,\r\n  options: IntersectionObserverOptions & {\r\n    onIntersect: (element: Element, entry: IntersectionObserverEntry) => void;\r\n  }\r\n) {\r\n  const savedCallback = useRef(options.onIntersect);\r\n  const observerRef = useRef<IntersectionObserver | null>(null);\r\n\r\n  useEffect(() => {\r\n    savedCallback.current = options.onIntersect;\r\n  }, [options.onIntersect]);\r\n\r\n  useEffect(() => {\r\n    if (options.enabled === false) {\r\n      return;\r\n    }\r\n\r\n    if (typeof window === 'undefined' || !window.IntersectionObserver) {\r\n      console.warn('IntersectionObserver is not supported in this browser');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const callback: IntersectionObserverCallback = (entries) => {\r\n        entries.forEach((entry) => {\r\n          if (entry.isIntersecting && savedCallback.current) {\r\n            try {\r\n              savedCallback.current(entry.target, entry);\r\n            } catch (error) {\r\n              console.error('Error in intersection observer callback:', error);\r\n            }\r\n          }\r\n        });\r\n      };\r\n\r\n      observerRef.current = new IntersectionObserver(\r\n        callback,\r\n        {\r\n          root: options.root || null,\r\n          rootMargin: options.rootMargin || '0px',\r\n          threshold: options.threshold || 0.5\r\n        }\r\n      );\r\n\r\n      const targets = targetsRef.current;\r\n      if (targets && observerRef.current) {\r\n        targets.forEach(target => {\r\n          if (target) {\r\n            observerRef.current!.observe(target);\r\n          }\r\n        });\r\n      }\r\n\r\n      return () => {\r\n        if (observerRef.current) {\r\n          observerRef.current.disconnect();\r\n          observerRef.current = null;\r\n        }\r\n      };\r\n    } catch (error) {\r\n      console.error('Error creating IntersectionObserver:', error);\r\n      return undefined;\r\n    }\r\n  }, [\r\n    targetsRef,\r\n    options.root,\r\n    options.rootMargin,\r\n    options.threshold,\r\n    options.enabled\r\n  ]);\r\n\r\n  return observerRef.current;\r\n}\r\n\r\n// Utility hook for lazy loading images\r\nexport function useLazyImageObserver(\r\n  imageRef: React.RefObject<HTMLImageElement>,\r\n  src: string,\r\n  placeholder?: string\r\n) {\r\n  const [imageSrc, setImageSrc] = useState(placeholder || '');\r\n  const [isLoaded, setIsLoaded] = useState(false);\r\n\r\n  useIntersectionObserver(imageRef, {\r\n    onIntersect: () => {\r\n      if (src && !isLoaded) {\r\n        // Validate image URL before setting\r\n        try {\r\n          const url = new URL(src, window.location.origin);\r\n          if (url.protocol === 'http:' || url.protocol === 'https:' || url.protocol === 'data:') {\r\n            setImageSrc(src);\r\n            setIsLoaded(true);\r\n          } else {\r\n            console.warn('Invalid image URL protocol:', url.protocol);\r\n          }\r\n        } catch (error) {\r\n          console.error('Invalid image URL:', src);\r\n        }\r\n      }\r\n    },\r\n    threshold: 0.1,\r\n    enabled: !!src && !isLoaded\r\n  });\r\n\r\n  return { imageSrc, isLoaded };\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3006, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/seller/messages/MessageItem.tsx"],"sourcesContent":["// src/components/seller/messages/MessageItem.tsx\r\n'use client';\r\n\r\nimport React, { useRef, useState } from 'react';\r\nimport {\r\n  CheckCheck,\r\n  Check,\r\n  Clock,\r\n  CheckCircle2,\r\n  XCircle,\r\n  Edit3,\r\n  ShoppingBag,\r\n  X\r\n} from 'lucide-react';\r\nimport { useIntersectionObserver } from '@/hooks/useIntersectionObserver';\r\nimport { isSingleEmoji } from '@/utils/messageUtils';\r\nimport { SecureMessageDisplay, SecureImage } from '@/components/ui/SecureMessageDisplay';\r\nimport { SecureInput, SecureTextarea } from '@/components/ui/SecureInput';\r\nimport { securityService, validationSchemas } from '@/services';\r\nimport { \r\n  sanitizeStrict, \r\n  sanitizeCurrency, \r\n  sanitizeNumber \r\n} from '@/utils/security/sanitization';\r\n\r\ninterface MessageItemProps {\r\n  msg: any;\r\n  index: number;\r\n  isFromMe: boolean;\r\n  user: any;\r\n  activeThread: string;\r\n  onMessageVisible: (msg: any) => void;\r\n  customReq?: any;\r\n  isLatestCustom: boolean;\r\n  isPaid: boolean;\r\n  showActionButtons: boolean;\r\n  handleAccept: () => void;\r\n  handleDecline: () => void;\r\n  handleEditRequest: () => void;\r\n  editRequestId: string | null;\r\n  editTitle: string;\r\n  setEditTitle: (title: string) => void;\r\n  editPrice: number | '';\r\n  setEditPrice: (price: number | '') => void;\r\n  editMessage: string;\r\n  setEditMessage: (message: string) => void;\r\n  handleEditSubmit: () => void;\r\n  setEditRequestId: (id: string | null) => void;\r\n  statusBadge: (status: string) => React.ReactElement;\r\n  setPreviewImage: (url: string | null) => void;\r\n}\r\n\r\nexport default function MessageItem({\r\n  msg,\r\n  index,\r\n  isFromMe,\r\n  user,\r\n  activeThread,\r\n  onMessageVisible,\r\n  customReq,\r\n  isLatestCustom,\r\n  isPaid,\r\n  showActionButtons,\r\n  handleAccept,\r\n  handleDecline,\r\n  handleEditRequest,\r\n  editRequestId,\r\n  editTitle,\r\n  setEditTitle,\r\n  editPrice,\r\n  setEditPrice,\r\n  editMessage,\r\n  setEditMessage,\r\n  handleEditSubmit,\r\n  setEditRequestId,\r\n  statusBadge,\r\n  setPreviewImage\r\n}: MessageItemProps) {\r\n  const messageRef = useRef<HTMLDivElement>(null);\r\n  const [hasBeenVisible, setHasBeenVisible] = useState(false);\r\n  const [editErrors, setEditErrors] = useState<{\r\n    title?: string;\r\n    price?: string;\r\n    description?: string;\r\n  }>({});\r\n\r\n  // Use Intersection Observer to track when message becomes visible\r\n  useIntersectionObserver(messageRef, {\r\n    threshold: 0.8,\r\n    onIntersect: () => {\r\n      if (!hasBeenVisible && !isFromMe && !msg.read) {\r\n        setHasBeenVisible(true);\r\n        onMessageVisible(msg);\r\n      }\r\n    }\r\n  });\r\n\r\n  const time = new Date(msg.date).toLocaleTimeString([], {\r\n    hour: '2-digit',\r\n    minute: '2-digit'\r\n  });\r\n\r\n  const isSingleEmojiMsg = msg.content && isSingleEmoji(msg.content);\r\n\r\n  // Validate edit form before submission\r\n  const handleSecureEditSubmit = () => {\r\n    // Validate the custom request data\r\n    const validationResult = securityService.validateAndSanitize(\r\n      {\r\n        title: editTitle,\r\n        description: editMessage,\r\n        price: typeof editPrice === 'string' ? parseFloat(editPrice) || 0 : editPrice\r\n      },\r\n      validationSchemas.messageSchemas.customRequest\r\n    );\r\n\r\n    if (!validationResult.success) {\r\n      setEditErrors(validationResult.errors || {});\r\n      return;\r\n    }\r\n\r\n    // Clear errors and submit\r\n    setEditErrors({});\r\n    handleEditSubmit();\r\n  };\r\n\r\n  // Sanitize display names\r\n  const sanitizedSender = sanitizeStrict(msg.sender || '');\r\n  const sanitizedActiveThread = sanitizeStrict(activeThread || '');\r\n  const sanitizedUsername = sanitizeStrict(user?.username || '');\r\n\r\n  return (\r\n    <div ref={messageRef} className={`flex ${isFromMe ? 'justify-end' : 'justify-start'}`}>\r\n      <div className={`rounded-lg p-3 max-w-[75%] ${\r\n        isFromMe \r\n          ? 'bg-[#ff950e] text-black shadow-lg' \r\n          : 'bg-[#303030] text-[#fefefe] shadow-md'\r\n      }`}>\r\n        {/* Message header */}\r\n        <div className=\"flex items-center text-xs mb-1\">\r\n          <span className={isFromMe ? 'text-black opacity-75' : 'text-[#fefefe] opacity-75'}>\r\n            {isFromMe ? 'You' : sanitizedSender} • {time}\r\n          </span>\r\n          {isFromMe && (\r\n            <span className=\"ml-2 text-[10px]\">\r\n              {msg.read ? (\r\n                <span className={`flex items-center ${isFromMe ? 'text-black opacity-60' : 'text-[#fefefe] opacity-60'}`}>\r\n                  <CheckCheck size={12} className=\"mr-1\" /> Read\r\n                </span>\r\n              ) : (\r\n                <span className={isFromMe ? 'text-black opacity-50' : 'text-[#fefefe] opacity-50'}>Sent</span>\r\n              )}\r\n            </span>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Image message with secure display */}\r\n        {msg.type === 'image' && msg.meta?.imageUrl && (\r\n          <div className=\"mt-1 mb-2\">\r\n            <SecureImage\r\n              src={msg.meta.imageUrl}\r\n              alt=\"Shared image\"\r\n              className=\"max-w-full rounded cursor-pointer hover:opacity-90 transition-opacity shadow-sm\"\r\n              onError={() => console.error('Failed to load image')}\r\n              onClick={(e: React.MouseEvent<HTMLImageElement>) => {\r\n                e.stopPropagation();\r\n                setPreviewImage(msg.meta?.imageUrl || null);\r\n              }}\r\n            />\r\n            {msg.content && (\r\n              <div className={`mt-2 ${isSingleEmojiMsg ? 'text-3xl' : ''}`}>\r\n                <SecureMessageDisplay \r\n                  content={msg.content}\r\n                  allowBasicFormatting={false}\r\n                  className={isFromMe ? 'text-black' : 'text-[#fefefe]'}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n        \r\n        {/* Text content with XSS protection */}\r\n        {msg.type !== 'image' && msg.type !== 'customRequest' && (\r\n          <div className={isSingleEmojiMsg ? 'text-3xl' : ''}>\r\n            <SecureMessageDisplay \r\n              content={msg.content || ''}\r\n              allowBasicFormatting={false}\r\n              className={isFromMe ? 'text-black' : 'text-[#fefefe]'}\r\n            />\r\n          </div>\r\n        )}\r\n        \r\n        {/* Custom request content with sanitized display */}\r\n        {msg.type === 'customRequest' && msg.meta && (\r\n          <div className={`mt-2 text-sm space-y-1 border-t ${isFromMe ? 'border-black/20' : 'border-white/20'} pt-2`}>\r\n            <div className={`font-semibold flex items-center ${isFromMe ? 'text-black' : 'text-[#fefefe]'}`}>\r\n              <div className=\"relative mr-2 flex items-center justify-center\">\r\n                <div className=\"bg-white w-6 h-6 rounded-full absolute\"></div>\r\n                <SecureImage \r\n                  src=\"/Custom_Request_Icon.png\" \r\n                  alt=\"Custom Request\" \r\n                  className=\"w-8 h-8 relative z-10\"\r\n                />\r\n              </div>\r\n              Custom Request\r\n            </div>\r\n            \r\n            {/* Sanitize all displayed custom request data */}\r\n            <p className={isFromMe ? 'text-black' : 'text-[#fefefe]'}>\r\n              <b>Title:</b> {sanitizeStrict(customReq ? customReq.title : msg.meta.title || '')}\r\n            </p>\r\n            <p className={isFromMe ? 'text-black' : 'text-[#fefefe]'}>\r\n              <b>Price:</b> ${sanitizeCurrency(customReq ? customReq.price : msg.meta.price || 0).toFixed(2)}\r\n            </p>\r\n            {(customReq ? customReq.description : msg.meta.message) && (\r\n              <div className={isFromMe ? 'text-black' : 'text-[#fefefe]'}>\r\n                <b>Message:</b> \r\n                <SecureMessageDisplay \r\n                  content={customReq ? customReq.description : msg.meta.message || ''}\r\n                  allowBasicFormatting={false}\r\n                  className=\"inline\"\r\n                />\r\n              </div>\r\n            )}\r\n            {customReq && (\r\n              <p className={`flex items-center ${isFromMe ? 'text-black' : 'text-[#fefefe]'}`}>\r\n                <b>Status:</b>\r\n                {statusBadge(customReq.status)}\r\n              </p>\r\n            )}\r\n            \r\n            {/* Show who needs to take action with sanitized names */}\r\n            {customReq && isLatestCustom && (customReq.status === 'pending' || customReq.status === 'edited') && !isPaid && (\r\n              <p className={`text-xs italic ${isFromMe ? 'text-black/70' : 'text-[#fefefe]/70'}`}>\r\n                {customReq.pendingWith === sanitizedUsername ? (\r\n                  <span className=\"flex items-center\">\r\n                    <Clock size={12} className=\"mr-1\" />\r\n                    Action required from you\r\n                  </span>\r\n                ) : (\r\n                  <span className=\"flex items-center\">\r\n                    <Clock size={12} className=\"mr-1\" />\r\n                    Waiting for {sanitizeStrict(customReq.pendingWith || sanitizedActiveThread)} to respond...\r\n                  </span>\r\n                )}\r\n              </p>\r\n            )}\r\n            \r\n            {/* Action buttons */}\r\n            {showActionButtons && !isPaid && (\r\n              <div className=\"flex flex-wrap gap-2 pt-2\">\r\n                <button\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    handleAccept();\r\n                  }}\r\n                  className=\"bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700 flex items-center transition-colors duration-150 font-medium shadow-sm\"\r\n                >\r\n                  <CheckCircle2 size={12} className=\"mr-1\" />\r\n                  Accept\r\n                </button>\r\n                <button\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    handleDecline();\r\n                  }}\r\n                  className=\"bg-red-600 text-white px-3 py-1 rounded text-xs hover:bg-red-700 flex items-center transition-colors duration-150 font-medium shadow-sm\"\r\n                >\r\n                  <XCircle size={12} className=\"mr-1\" />\r\n                  Decline\r\n                </button>\r\n                <button\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    handleEditRequest();\r\n                  }}\r\n                  className=\"bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 flex items-center transition-colors duration-150 font-medium shadow-sm\"\r\n                >\r\n                  <Edit3 size={12} className=\"mr-1\" />\r\n                  Edit\r\n                </button>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Edit form with secure inputs */}\r\n            {editRequestId === customReq?.id && customReq && (\r\n              <div className=\"mt-3 space-y-2 bg-white/90 p-3 rounded border border-black/20 shadow-sm\">\r\n                <SecureInput\r\n                  type=\"text\"\r\n                  placeholder=\"Title\"\r\n                  value={editTitle}\r\n                  onChange={setEditTitle}\r\n                  error={editErrors.title}\r\n                  touched={true}\r\n                  className=\"w-full p-2 border rounded bg-white border-gray-300 text-black placeholder-gray-500\"\r\n                  onClick={(e: React.MouseEvent) => e.stopPropagation()}\r\n                  maxLength={100}\r\n                />\r\n                <SecureInput\r\n                  type=\"number\"\r\n                  placeholder=\"Price (USD)\"\r\n                  value={editPrice.toString()}\r\n                  onChange={(val: string) => {\r\n                    const sanitized = sanitizeNumber(val, 0.01, 1000);\r\n                    setEditPrice(val === '' ? '' : sanitized);\r\n                  }}\r\n                  error={editErrors.price}\r\n                  touched={true}\r\n                  min=\"0.01\"\r\n                  max=\"1000\"\r\n                  step=\"0.01\"\r\n                  className=\"w-full p-2 border rounded bg-white border-gray-300 text-black placeholder-gray-500\"\r\n                  onClick={(e: React.MouseEvent) => e.stopPropagation()}\r\n                />\r\n                <SecureTextarea\r\n                  placeholder=\"Message\"\r\n                  value={editMessage}\r\n                  onChange={setEditMessage}\r\n                  error={editErrors.description}\r\n                  touched={true}\r\n                  maxLength={500}\r\n                  characterCount={true}\r\n                  className=\"w-full p-2 border rounded bg-white border-gray-300 text-black placeholder-gray-500 min-h-[80px]\"\r\n                  onClick={(e: React.MouseEvent) => e.stopPropagation()}\r\n                />\r\n                <div className=\"flex gap-2\">\r\n                  <button\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      handleSecureEditSubmit();\r\n                    }}\r\n                    className=\"bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 flex items-center transition-colors duration-150 font-medium shadow-sm\"\r\n                  >\r\n                    <Edit3 size={12} className=\"mr-1\" />\r\n                    Submit Edit\r\n                  </button>\r\n                  <button\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      setEditRequestId(null);\r\n                      setEditErrors({});\r\n                    }}\r\n                    className=\"bg-gray-600 text-white px-3 py-1 rounded text-xs hover:bg-gray-700 flex items-center transition-colors duration-150 font-medium shadow-sm\"\r\n                  >\r\n                    <X size={12} className=\"mr-1\" />\r\n                    Cancel\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3579, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/VirtualList.tsx"],"sourcesContent":["// src/components/VirtualList.tsx\r\n'use client';\r\n\r\nimport { useVirtualizer } from '@tanstack/react-virtual';\r\nimport { useRef, useMemo } from 'react';\r\n\r\ninterface VirtualListProps<T> {\r\n  items: T[];\r\n  itemHeight: number;\r\n  renderItem: (item: T, index: number) => React.ReactNode;\r\n  className?: string;\r\n  overscan?: number;\r\n}\r\n\r\nexport function VirtualList<T>({\r\n  items,\r\n  itemHeight,\r\n  renderItem,\r\n  className,\r\n  overscan = 5,\r\n}: VirtualListProps<T>) {\r\n  const parentRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Guards to prevent pathological values\r\n  const safeItemHeight = useMemo(() => (itemHeight > 0 ? itemHeight : 56), [itemHeight]);\r\n  const safeOverscan = useMemo(() => (overscan >= 0 && Number.isFinite(overscan) ? overscan : 5), [overscan]);\r\n\r\n  const virtualizer = useVirtualizer({\r\n    count: items.length,\r\n    getScrollElement: () => parentRef.current,\r\n    estimateSize: () => safeItemHeight,\r\n    overscan: safeOverscan,\r\n  });\r\n\r\n  return (\r\n    <div ref={parentRef} className={className} style={{ overflow: 'auto', willChange: 'transform' }}>\r\n      <div\r\n        style={{\r\n          height: `${virtualizer.getTotalSize()}px`,\r\n          width: '100%',\r\n          position: 'relative',\r\n        }}\r\n      >\r\n        {virtualizer.getVirtualItems().map((virtualItem) => (\r\n          <div\r\n            key={virtualItem.key}\r\n            style={{\r\n              position: 'absolute',\r\n              top: 0,\r\n              left: 0,\r\n              width: '100%',\r\n              height: `${virtualItem.size}px`,\r\n              transform: `translateY(${virtualItem.start}px)`,\r\n            }}\r\n          >\r\n            {renderItem(items[virtualItem.index], virtualItem.index)}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;;AAGjC;AACA;;;AAHA;;;AAaO,SAAS,YAAe,KAMT;QANS,EAC7B,KAAK,EACL,UAAU,EACV,UAAU,EACV,SAAS,EACT,WAAW,CAAC,EACQ,GANS;;IAO7B,MAAM,YAAY,CAAA,GAAA,6JAAA,CAAA,SAAM,AAAD,EAAkB;IAEzC,wCAAwC;IACxC,MAAM,iBAAiB,CAAA,GAAA,6JAAA,CAAA,UAAO,AAAD;+CAAE,IAAO,aAAa,IAAI,aAAa;8CAAK;QAAC;KAAW;IACrF,MAAM,eAAe,CAAA,GAAA,6JAAA,CAAA,UAAO,AAAD;6CAAE,IAAO,YAAY,KAAK,OAAO,QAAQ,CAAC,YAAY,WAAW;4CAAI;QAAC;KAAS;IAE1G,MAAM,cAAc,CAAA,GAAA,yLAAA,CAAA,iBAAc,AAAD,EAAE;QACjC,OAAO,MAAM,MAAM;QACnB,gBAAgB;uDAAE,IAAM,UAAU,OAAO;;QACzC,YAAY;uDAAE,IAAM;;QACpB,UAAU;IACZ;IAEA,qBACE,6LAAC;QAAI,KAAK;QAAW,WAAW;QAAW,OAAO;YAAE,UAAU;YAAQ,YAAY;QAAY;kBAC5F,cAAA,6LAAC;YACC,OAAO;gBACL,QAAQ,AAAC,GAA6B,OAA3B,YAAY,YAAY,IAAG;gBACtC,OAAO;gBACP,UAAU;YACZ;sBAEC,YAAY,eAAe,GAAG,GAAG,CAAC,CAAC,4BAClC,6LAAC;oBAEC,OAAO;wBACL,UAAU;wBACV,KAAK;wBACL,MAAM;wBACN,OAAO;wBACP,QAAQ,AAAC,GAAmB,OAAjB,YAAY,IAAI,EAAC;wBAC5B,WAAW,AAAC,cAA+B,OAAlB,YAAY,KAAK,EAAC;oBAC7C;8BAEC,WAAW,KAAK,CAAC,YAAY,KAAK,CAAC,EAAE,YAAY,KAAK;mBAVlD,YAAY,GAAG;;;;;;;;;;;;;;;AAgBhC;GA/CgB;;QAaM,yLAAA,CAAA,iBAAc;;;KAbpB","debugId":null}},
    {"offset": {"line": 3672, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/seller/messages/MessagesList.tsx"],"sourcesContent":["// src/components/seller/messages/MessagesList.tsx\r\n'use client';\r\n\r\nimport React, { useState, useCallback, useRef, useMemo } from 'react';\r\nimport MessageItem from './MessageItem';\r\nimport { VirtualList } from '@/components/VirtualList';\r\n\r\ninterface MessagesListProps {\r\n  threadMessages: any[];\r\n  sellerRequests: any[];\r\n  user: any;\r\n  activeThread: string;\r\n  handleAccept: (requestId: string) => void;\r\n  handleDecline: (requestId: string) => void;\r\n  handleEditRequest: (requestId: string, title: string, price: number, message: string) => void;\r\n  handleEditSubmit: () => void;\r\n  handleMessageVisible: (msg: any) => void;\r\n  editRequestId: string | null;\r\n  setEditRequestId: (id: string | null) => void;\r\n  editPrice: number | '';\r\n  setEditPrice: (price: number | '') => void;\r\n  editTitle: string;\r\n  setEditTitle: (title: string) => void;\r\n  editMessage: string;\r\n  setEditMessage: (message: string) => void;\r\n  setPreviewImage: (url: string | null) => void;\r\n}\r\n\r\nexport default function MessagesList({\r\n  threadMessages,\r\n  sellerRequests,\r\n  user,\r\n  activeThread,\r\n  handleAccept,\r\n  handleDecline,\r\n  handleEditRequest,\r\n  handleEditSubmit,\r\n  handleMessageVisible,\r\n  editRequestId,\r\n  setEditRequestId,\r\n  editPrice,\r\n  setEditPrice,\r\n  editTitle,\r\n  setEditTitle,\r\n  editMessage,\r\n  setEditMessage,\r\n  setPreviewImage\r\n}: MessagesListProps) {\r\n  // Create status badge\r\n  const createStatusBadge = useCallback((status: string) => {\r\n    const badgeClasses: { [key: string]: string } = {\r\n      pending: \"bg-yellow-500 text-black\",\r\n      accepted: \"bg-green-500 text-white\",\r\n      rejected: \"bg-red-500 text-white\",\r\n      paid: \"bg-blue-500 text-white\",\r\n      edited: \"bg-purple-500 text-white\",\r\n      cancelled: \"bg-gray-500 text-white\"\r\n    };\r\n\r\n    return (\r\n      <span className={`ml-2 px-2 py-1 rounded text-xs font-medium ${badgeClasses[status] || 'bg-gray-500 text-white'}`}>\r\n        {status.charAt(0).toUpperCase() + status.slice(1)}\r\n      </span>\r\n    );\r\n  }, []);\r\n\r\n  // Find the latest custom request message\r\n  const latestCustomRequestIndex = useMemo(() => {\r\n    for (let i = threadMessages.length - 1; i >= 0; i--) {\r\n      if (threadMessages[i].type === 'customRequest' && threadMessages[i].meta?.id) {\r\n        return i;\r\n      }\r\n    }\r\n    return -1;\r\n  }, [threadMessages]);\r\n\r\n  // Prepare message data with all necessary props\r\n  const messageData = useMemo(() => {\r\n    return threadMessages.map((msg, index) => {\r\n      const isFromMe = msg.sender === user?.username;\r\n      \r\n      // Find the custom request if this is a custom request message\r\n      const customReq = msg.type === 'customRequest' && msg.meta && msg.meta.id\r\n        ? sellerRequests.find(req => req.id === msg.meta.id)\r\n        : null;\r\n\r\n      // Check if this is the latest custom request message\r\n      const isLatestCustom = index === latestCustomRequestIndex;\r\n\r\n      const isPaid = customReq && (customReq.paid || customReq.status === 'paid');\r\n\r\n      // Show action buttons if:\r\n      // 1. This is a custom request\r\n      // 2. This is the latest custom request message\r\n      // 3. The request is pending or edited\r\n      // 4. The request is pending with the current user (seller)\r\n      const showActionButtons = !!customReq &&\r\n        isLatestCustom &&\r\n        !isPaid &&\r\n        (customReq.status === 'pending' || customReq.status === 'edited') &&\r\n        customReq.pendingWith === user?.username;\r\n      \r\n      return {\r\n        msg,\r\n        index,\r\n        isFromMe,\r\n        customReq,\r\n        isLatestCustom,\r\n        isPaid,\r\n        showActionButtons,\r\n        key: `${msg.id || index}-${msg.date || index}`\r\n      };\r\n    });\r\n  }, [threadMessages, user, sellerRequests, latestCustomRequestIndex]);\r\n\r\n  // Render function for virtual list\r\n  const renderMessage = useCallback((item: typeof messageData[0]) => {\r\n    return (\r\n      <MessageItem\r\n        key={item.key}\r\n        msg={item.msg}\r\n        index={item.index}\r\n        isFromMe={item.isFromMe}\r\n        user={user}\r\n        activeThread={activeThread}\r\n        onMessageVisible={handleMessageVisible}\r\n        customReq={item.customReq}\r\n        isLatestCustom={item.isLatestCustom}\r\n        isPaid={item.isPaid}\r\n        showActionButtons={item.showActionButtons}\r\n        handleAccept={() => item.customReq && handleAccept(item.customReq.id)}\r\n        handleDecline={() => item.customReq && handleDecline(item.customReq.id)}\r\n        handleEditRequest={() => item.customReq && handleEditRequest(\r\n          item.customReq.id, \r\n          item.customReq.title, \r\n          item.customReq.price, \r\n          item.customReq.description || ''\r\n        )}\r\n        editRequestId={editRequestId}\r\n        editTitle={editTitle}\r\n        setEditTitle={setEditTitle}\r\n        editPrice={editPrice}\r\n        setEditPrice={setEditPrice}\r\n        editMessage={editMessage}\r\n        setEditMessage={setEditMessage}\r\n        handleEditSubmit={handleEditSubmit}\r\n        setEditRequestId={setEditRequestId}\r\n        statusBadge={createStatusBadge}\r\n        setPreviewImage={setPreviewImage}\r\n      />\r\n    );\r\n  }, [\r\n    user,\r\n    activeThread,\r\n    handleMessageVisible,\r\n    handleAccept,\r\n    handleDecline,\r\n    handleEditRequest,\r\n    editRequestId,\r\n    editTitle,\r\n    setEditTitle,\r\n    editPrice,\r\n    setEditPrice,\r\n    editMessage,\r\n    setEditMessage,\r\n    handleEditSubmit,\r\n    setEditRequestId,\r\n    createStatusBadge,\r\n    setPreviewImage\r\n  ]);\r\n\r\n  return (\r\n    <div className=\"flex-1 overflow-hidden\">\r\n      <VirtualList\r\n        items={messageData}\r\n        itemHeight={100} // Adjust based on average message height\r\n        renderItem={renderMessage}\r\n        className=\"p-4 h-full overflow-y-auto\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3852, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/seller/messages/MessageInput.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { forwardRef, useState, useCallback } from 'react';\r\nimport { AlertTriangle, X, Smile, ShieldAlert } from 'lucide-react';\r\nimport { SecureTextarea } from '@/components/ui/SecureInput';\r\nimport { securityService } from '@/services/security.service';\r\nimport { sanitizeStrict } from '@/utils/security/sanitization';\r\nimport { SecureImage } from '@/components/ui/SecureMessageDisplay';\r\n\r\ninterface MessageInputProps {\r\n  replyMessage: string;\r\n  setReplyMessage: (message: string) => void;\r\n  selectedImage: string | null;\r\n  setSelectedImage: (image: string | null) => void;\r\n  imageError: string | null;\r\n  isImageLoading: boolean;\r\n  showEmojiPicker: boolean;\r\n  setShowEmojiPicker: (show: boolean) => void;\r\n  isUserBlocked: boolean;\r\n  onReply: () => void;\r\n  onKeyDown: (e: React.KeyboardEvent) => void;\r\n  onImageClick: () => void;\r\n  onBlockToggle: () => void;\r\n  fileInputRef: React.MutableRefObject<HTMLInputElement | null>;\r\n  emojiPickerRef: React.MutableRefObject<HTMLDivElement | null>;\r\n  onImageSelect: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n}\r\n\r\nconst MessageInput = forwardRef<HTMLTextAreaElement, MessageInputProps>(\r\n  (\r\n    {\r\n      replyMessage,\r\n      setReplyMessage,\r\n      selectedImage,\r\n      setSelectedImage,\r\n      imageError,\r\n      isImageLoading,\r\n      showEmojiPicker,\r\n      setShowEmojiPicker,\r\n      isUserBlocked,\r\n      onReply,\r\n      onKeyDown,\r\n      onImageClick,\r\n      onBlockToggle,\r\n      fileInputRef,\r\n      emojiPickerRef,\r\n      onImageSelect,\r\n    },\r\n    ref\r\n  ) => {\r\n    const [validationError, setValidationError] = useState<string | null>(null);\r\n\r\n    // Secure image selection with validation\r\n    const handleSecureImageSelect = useCallback(\r\n      (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        // Validate file before processing\r\n        const validation = securityService.validateFileUpload(file, {\r\n          maxSize: 5 * 1024 * 1024, // 5MB\r\n          allowedTypes: ['image/jpeg', 'image/png', 'image/gif', 'image/webp'],\r\n          allowedExtensions: ['jpg', 'jpeg', 'png', 'gif', 'webp'],\r\n        });\r\n\r\n        if (!validation.valid) {\r\n          setValidationError(validation.error || 'Invalid file');\r\n          if (fileInputRef.current) {\r\n            fileInputRef.current.value = '';\r\n          }\r\n          return;\r\n        }\r\n\r\n        // Clear validation error and proceed\r\n        setValidationError(null);\r\n        onImageSelect(e);\r\n      },\r\n      [onImageSelect, fileInputRef]\r\n    );\r\n\r\n    if (isUserBlocked) {\r\n      return (\r\n        <div className=\"p-4 border-t border-gray-800 text-center text-sm text-red-400 bg-[#1a1a1a] flex items-center justify-center\">\r\n          <ShieldAlert size={16} className=\"mr-2\" />\r\n          You have blocked this buyer\r\n          <button\r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              onBlockToggle();\r\n            }}\r\n            className=\"ml-2 underline text-gray-400 hover:text-white transition-colors duration-150\"\r\n          >\r\n            Unblock\r\n          </button>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"relative border-t border-gray-800 bg-[#1a1a1a]\">\r\n        {/* Selected image preview */}\r\n        {selectedImage && (\r\n          <div className=\"px-4 pt-3 pb-2\">\r\n            <div className=\"relative inline-block\">\r\n              <SecureImage\r\n                src={selectedImage}\r\n                alt=\"Preview\"\r\n                className=\"max-h-20 rounded shadow-md\"\r\n                onError={() => {\r\n                  setValidationError('Failed to load image');\r\n                  setSelectedImage(null);\r\n                }}\r\n              />\r\n              <button\r\n                onClick={() => {\r\n                  setSelectedImage(null);\r\n                  setValidationError(null);\r\n                  if (fileInputRef.current) {\r\n                    fileInputRef.current.value = '';\r\n                  }\r\n                }}\r\n                className=\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 text-xs shadow-md transform transition-transform hover:scale-110\"\r\n                style={{ width: '20px', height: '20px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}\r\n                aria-label=\"Remove image\"\r\n                title=\"Remove image\"\r\n              >\r\n                <X size={14} />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Image loading state */}\r\n        {isImageLoading && (\r\n          <div className=\"px-4 pt-3 pb-0 text-sm text-gray-400\">Loading image...</div>\r\n        )}\r\n\r\n        {/* Error display */}\r\n        {(imageError || validationError) && (\r\n          <div className=\"px-4 pt-3 pb-0 text-sm text-red-400 flex items-center\">\r\n            <AlertTriangle size={14} className=\"mr-1\" />\r\n            {sanitizeStrict(imageError || validationError || '')}\r\n          </div>\r\n        )}\r\n\r\n        {/* Message input with security */}\r\n        <div className=\"px-4 py-3\">\r\n          <div className=\"relative mb-2\">\r\n            <SecureTextarea\r\n              ref={ref}\r\n              value={replyMessage}\r\n              onChange={setReplyMessage}\r\n              onKeyDown={onKeyDown}\r\n              placeholder={selectedImage ? 'Add a caption...' : 'Type a message'}\r\n              className=\"w-full p-3 pr-12 rounded-lg bg-[#222] border border-gray-700 text-white focus:outline-none focus:ring-1 focus:ring-[#ff950e] min-h-[40px] max-h-20 resize-none overflow-auto leading-tight\"\r\n              rows={1}\r\n              maxLength={250}\r\n              characterCount={false}\r\n              sanitize={true}\r\n            />\r\n\r\n            {/* Emoji button */}\r\n            <button\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n                setShowEmojiPicker(!showEmojiPicker);\r\n              }}\r\n              className={`absolute right-3 top-1/2 transform -translate-y-1/2 mt-[-4px] flex items-center justify-center h-8 w-8 rounded-full ${\r\n                showEmojiPicker ? 'bg-[#ff950e] text-black' : 'text-[#ff950e] hover:bg-[#333]'\r\n              } transition-colors duration-150`}\r\n              title=\"Emoji\"\r\n              type=\"button\"\r\n              aria-pressed={showEmojiPicker}\r\n            >\r\n              <Smile size={20} className=\"flex-shrink-0\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Character count */}\r\n          {replyMessage.length > 0 && (\r\n            <div className=\"text-xs text-gray-400 mb-2 text-right\">{replyMessage.length}/250</div>\r\n          )}\r\n\r\n          {/* Bottom row with attachment and send buttons */}\r\n          <div className=\"flex justify-between items-center\">\r\n            {/* Attachment button */}\r\n            <img\r\n              src=\"/Attach_Image_Icon.png\"\r\n              alt=\"Attach Image\"\r\n              className={`w-14 h-14 cursor-pointer hover:opacity-80 transition-opacity ${\r\n                isImageLoading ? 'opacity-50 cursor-not-allowed' : ''\r\n              }`}\r\n              onClick={(e) => {\r\n                if (isImageLoading) return;\r\n                e.stopPropagation();\r\n                onImageClick();\r\n              }}\r\n              title=\"Attach Image\"\r\n            />\r\n\r\n            {/* Hidden file input with secure constraints */}\r\n            <input\r\n              type=\"file\"\r\n              accept=\"image/jpeg,image/png,image/gif,image/webp\"\r\n              ref={fileInputRef}\r\n              style={{ display: 'none' }}\r\n              onChange={handleSecureImageSelect}\r\n            />\r\n\r\n            {/* Send Button */}\r\n            <img\r\n              src=\"/Send_Button.png\"\r\n              alt=\"Send\"\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n                onReply();\r\n              }}\r\n              className={`cursor-pointer hover:opacity-90 transition-opacity h-11 ${\r\n                (!replyMessage.trim() && !selectedImage) || isImageLoading ? 'opacity-50 cursor-not-allowed' : ''\r\n              }`}\r\n              style={{ pointerEvents: (!replyMessage.trim() && !selectedImage) || isImageLoading ? 'none' : 'auto' }}\r\n              title=\"Send message\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\nMessageInput.displayName = 'MessageInput';\r\n\r\nexport default MessageInput;\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4180, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/constants/emojis.ts"],"sourcesContent":["// src/constants/emojis.ts\r\nexport const ALL_EMOJIS = [\r\n  // ❤️ MOST LIKELY TO BE USED - Love, flirty, suggestive\r\n  '❤️', '💕', '💖', '💗', '💓', '💞', '💝', '😍', '🥰', '😘', '😗', '😙', '😚', '💋', '😋', '😛', '😜', '😝', '🤤', '🥵', '🔥', '💦', '🍑', '🍆', '🌶', '🍯', '🍒', '🍓', '🥥', '🍌', '🍭', '🍰', '🧁', '🍪', '🥛', '☕', '🍷', '🥂', '🍾', '💎', '🎁', '🌹', '🌺', '🌸', '💐', '🦋', '✨', '💫', '⭐', '🌟', '💯', \r\n  \r\n  // 😊 COMMON POSITIVE EMOTIONS\r\n  '😊', '🙂', '😁', '😄', '😃', '😀', '😆', '😅', '😂', '🤣', '🥳', '😇', '🤗', '🤭', '😉', '😌', '🥺', '🥹', '😏', '🤩', '😎', '🤓', '🧐', '🤔', '🤫', '🤐', '😌',\r\n  \r\n  // 💜 MORE HEARTS & LOVE\r\n  '🧡', '💛', '💚', '💙', '💜', '🖤', '🤍', '🤎', '💔', '❣️', '💘', '💟',\r\n  \r\n  // 😢 EMOTIONS & EXPRESSIONS  \r\n  '😢', '😭', '😤', '😠', '😡', '🤬', '🤯', '😳', '😱', '😨', '😰', '😥', '😓', '😞', '😔', '😟', '😕', '🙁', '☹️', '😣', '😖', '😫', '😩', '😪', '😴', '🤤', '😵', '🥴', '🤢', '🤮', '🤧', '😷', '🤒', '🤕', '🥶',\r\n  \r\n  // 🎉 CELEBRATION & FUN\r\n  '🎉', '🎊', '🎈', '🎂', '🎀', '🎁', '🏆', '🥇', '🥈', '🥉', '🏅', '🎖', '🎗', '🎫', '🎟', '🎪', '🎭', '🎨', '🎬', '🎤', '🎧', '🎵', '🎶', '🎸', '🎹', '🎺', '🎻', '🥁',\r\n  \r\n  // 💰 MONEY & SHOPPING\r\n  '💰', '💵', '💴', '💶', '💷', '🪙', '💳', '💸', '🛍', '🛒', '🛁', '👑', '💍', '👄', '💄', '👗', '👙', '👠', '🩱', '🧿',\r\n  \r\n  // 🍕 FOOD & DRINKS (selective favorites)\r\n  '🍕', '🍔', '🍟', '🌮', '🌯', '🥪', '🥗', '🍝', '🍜', '🍲', '🍛', '🍣', '🍱', '🍙', '🍚', '🥟', '🍤', '🦪', '🥘', '🫕', '🥫', '🍳', '🥚', '🧀', '🥓', '🥩', '🍗', '🍖', '🥞', '🧇', '🥐', '🥯', '🍞', '🥖', '🥨', '🧈',\r\n  \r\n  // 🍎 FRUITS (keeping sexy ones at front)\r\n  '🍎', '🍐', '🍊', '🍋', '🍉', '🍇', '🫐', '🍈', '🍑', '🥭', '🍍', '🥝', '🍅',\r\n  \r\n  // 🐱 CUTE ANIMALS\r\n  '🐱', '🐶', '🦊', '🐻', '🐼', '🐨', '🐰', '🐹', '🐭', '🐯', '🦁', '🐮', '🐷', '🐸', '🐵', '🙈', '🙉', '🙊', '🐔', '🐧', '🦆', '🦉', '🦇', '🐺', '🐴', '🦄', '🐝', '🦋', '🐌', '🐞', '🐜', '🕷', '🦂', '🐢', '🐍', '🦎', '🐙', '🦑', '🦐', '🦞', '🦀', '🐡', '🐠', '🐟', '🐬', '🐳', '🐋', '🦈', '🐊', '🐅', '🐆', '🦓', '🦍', '🦧', '🐘', '🦛', '🦏', '🐪', '🐫', '🦒', '🦘', '🐃',\r\n  \r\n  // ⚽ ACTIVITIES & SPORTS\r\n  '⚽', '🏀', '🏈', '⚾', '🥎', '🎾', '🏐', '🏉', '🥏', '🎱', '🏓', '🏸', '🏒', '🏑', '🥍', '🏏', '🥅', '⛳', '🏹', '🎣', '🤿', '🥊', '🥋', '🎽', '🛹', '🛼', '🛷', '⛸', '🥌', '🎿', '⛷', '🏂', '🏋️', '🤼', '🤸', '⛹️', '🤺', '🤾', '🏌️', '🏇', '🧘', '🏄', '🏊', '🤽', '🚣', '🧗', '🚵', '🚴', '🤹',\r\n  \r\n  // 🚗 TRAVEL & PLACES  \r\n  '🚗', '🚕', '🚙', '🚌', '🚎', '🏎', '🚓', '🚑', '🚒', '🚐', '🛻', '🚚', '🚛', '🚜', '🛴', '🚲', '🛵', '🏍', '🛺', '🚁', '✈️', '🛫', '🛬', '🛩', '🚀', '🛸', '⛵', '🚤', '🛥', '🛳', '⚴', '🚢', '🏖', '🏝', '🏕', '🗻', '🏔', '❄️', '☀️', '🌤', '⛅', '🌦', '🌧', '⛈', '🌩', '🌨', '☁️', '🌪', '🌈', '☂️', '☔',\r\n  \r\n  // 📱 OBJECTS & TECH\r\n  '📱', '💻', '⌨️', '🖥', '🖨', '🖱', '📷', '📸', '📹', '🎥', '📽', '🎞', '📞', '☎️', '📺', '📻', '🎙', '⌚', '⏰', '⏲', '⏱', '🕰', '⌛', '⏳', '🔋', '🔌', '💡', '🔦', '🕯', '🧯', '💽', '💾', '💿', '📀', '📼', '📡',\r\n  \r\n  // 🎯 SYMBOLS & MISC\r\n  '☮️', '✝️', '☪️', '🕉', '☸️', '✡️', '🔯', '🕎', '☯️', '☦️', '🛐', '⛎', '♈', '♉', '♊', '♋', '♌', '♍', '♎', '♏', '♐', '♑', '♒', '♓', '🆔', '⚛️', '🉑', '☢️', '☣️', '📴', '📳', '🈶', '🈚', '🈸', '🈺', '🈷️', '✴️', '🆚', '💮', '🉐', '㊙️', '㊗️', '🈴', '🈵', '🈹', '🈲', '🅰️', '🅱️', '🆎', '🆑',\r\n  \r\n  // 🏁 FLAGS (minimal selection)\r\n  '🏁', '🚩', '🎌', '🏴', '🏳️', '🏳️‍🌈', '🏳️‍⚧️', '🏴‍☠️'\r\n];\r\n\r\nexport const MAX_IMAGE_SIZE = 5 * 1024 * 1024; // 5MB limit for images\r\nexport const ALLOWED_IMAGE_TYPES = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\r\n\r\n// Export FREQUENT_EMOJIS as the first few from ALL_EMOJIS\r\nexport const FREQUENT_EMOJIS = [\r\n  '❤️', '💕', '😍', '🥰', '😘', '💋', '🔥', '💦',\r\n  '😊', '😁', '😂', '🥳', '😎', '🤩', '😏', '😉',\r\n  '🍑', '🍆', '🌶', '🍒', '💎', '🎁', '🌹', '✨',\r\n  '💯', '👍', '👌', '🙌', '💪', '🤝', '👏', '🎉'\r\n];\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4731, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/seller/messages/EmojiPicker.tsx"],"sourcesContent":["// src/components/sellers/messages/EmojiPicker.tsx\r\n'use client';\r\n\r\nimport React from 'react';\r\nimport { ALL_EMOJIS } from '@/constants/emojis';\r\n\r\ninterface EmojiPickerProps {\r\n  recentEmojis: string[];\r\n  onEmojiClick: (emoji: string) => void;\r\n}\r\n\r\nexport default function EmojiPicker({ recentEmojis, onEmojiClick }: EmojiPickerProps) {\r\n  return (\r\n    <div className=\"absolute left-0 right-0 mx-4 bottom-full mb-2 bg-black border border-gray-800 shadow-lg z-50 rounded-lg overflow-hidden\">\r\n      {/* Recent Emojis Section */}\r\n      {recentEmojis.length > 0 && (\r\n        <div className=\"px-3 pt-3\">\r\n          <div className=\"text-xs text-gray-400 mb-2\">Recent</div>\r\n          <div className=\"grid grid-cols-8 gap-1 mb-3\">\r\n            {recentEmojis.slice(0, 16).map((emoji, index) => (\r\n              <span\r\n                key={`recent-${index}`}\r\n                onClick={() => onEmojiClick(emoji)}\r\n                className=\"emoji-button flex items-center justify-center text-xl rounded-full w-10 h-10 cursor-pointer bg-black hover:bg-[#222] transition-colors duration-150\"\r\n              >\r\n                {emoji}\r\n              </span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n      {/* All Emojis */}\r\n      <div className=\"px-3 pt-2 pb-3\">\r\n        {recentEmojis.length > 0 && (\r\n          <div className=\"text-xs text-gray-400 mb-2\">All Emojis</div>\r\n        )}\r\n        <div className=\"grid grid-cols-8 gap-1 p-0 overflow-auto\" style={{ maxHeight: '200px' }}>\r\n          {ALL_EMOJIS.map((emoji, index) => (\r\n            <span\r\n              key={`emoji-${index}`}\r\n              onClick={() => onEmojiClick(emoji)}\r\n              className=\"emoji-button flex items-center justify-center text-xl rounded-full w-10 h-10 cursor-pointer bg-black hover:bg-[#222] transition-colors duration-150\"\r\n            >\r\n              {emoji}\r\n            </span>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"AAAA,kDAAkD;;;;;AAIlD;AAHA;;;AAUe,SAAS,YAAY,KAAgD;QAAhD,EAAE,YAAY,EAAE,YAAY,EAAoB,GAAhD;IAClC,qBACE,6LAAC;QAAI,WAAU;;YAEZ,aAAa,MAAM,GAAG,mBACrB,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;kCAA6B;;;;;;kCAC5C,6LAAC;wBAAI,WAAU;kCACZ,aAAa,KAAK,CAAC,GAAG,IAAI,GAAG,CAAC,CAAC,OAAO,sBACrC,6LAAC;gCAEC,SAAS,IAAM,aAAa;gCAC5B,WAAU;0CAET;+BAJI,AAAC,UAAe,OAAN;;;;;;;;;;;;;;;;0BAYzB,6LAAC;gBAAI,WAAU;;oBACZ,aAAa,MAAM,GAAG,mBACrB,6LAAC;wBAAI,WAAU;kCAA6B;;;;;;kCAE9C,6LAAC;wBAAI,WAAU;wBAA2C,OAAO;4BAAE,WAAW;wBAAQ;kCACnF,6HAAA,CAAA,aAAU,CAAC,GAAG,CAAC,CAAC,OAAO,sBACtB,6LAAC;gCAEC,SAAS,IAAM,aAAa;gCAC5B,WAAU;0CAET;+BAJI,AAAC,SAAc,OAAN;;;;;;;;;;;;;;;;;;;;;;AAW5B;KAxCwB","debugId":null}},
    {"offset": {"line": 4833, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/seller/messages/MessageInputContainer.tsx"],"sourcesContent":["// src/components/sellers/messages/MessageInputContainer.tsx\r\n'use client';\r\n\r\nimport React, { useRef, useEffect, useCallback } from 'react';\r\nimport MessageInput from './MessageInput';\r\nimport EmojiPicker from './EmojiPicker';\r\nimport { ALLOWED_IMAGE_TYPES, MAX_IMAGE_SIZE } from '@/constants/emojis';\r\n\r\ninterface MessageInputContainerProps {\r\n  isUserBlocked: boolean;\r\n  onBlockToggle: () => void;\r\n  activeThread: string;\r\n  replyMessage: string;\r\n  setReplyMessage: (message: string) => void;\r\n  selectedImage: string | null;\r\n  setSelectedImage: (image: string | null) => void;\r\n  isImageLoading: boolean;\r\n  setIsImageLoading: (loading: boolean) => void;\r\n  imageError: string | null;\r\n  setImageError: (error: string | null) => void;\r\n  showEmojiPicker: boolean;\r\n  setShowEmojiPicker: (show: boolean) => void;\r\n  recentEmojis: string[];\r\n  handleReply: () => void;\r\n  handleEmojiClick: (emoji: string) => void;\r\n  handleImageSelect: (file: File) => void;\r\n}\r\n\r\nexport default function MessageInputContainer({ \r\n  isUserBlocked, \r\n  onBlockToggle,\r\n  activeThread,\r\n  replyMessage,\r\n  setReplyMessage,\r\n  selectedImage,\r\n  setSelectedImage,\r\n  isImageLoading,\r\n  setIsImageLoading,\r\n  imageError,\r\n  setImageError,\r\n  showEmojiPicker,\r\n  setShowEmojiPicker,\r\n  recentEmojis,\r\n  handleReply,\r\n  handleEmojiClick,\r\n  handleImageSelect\r\n}: MessageInputContainerProps) {\r\n\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const emojiPickerRef = useRef<HTMLDivElement>(null);\r\n  const inputRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  // Handle clicks outside emoji picker\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (emojiPickerRef.current && !emojiPickerRef.current.contains(event.target as Node)) {\r\n        setShowEmojiPicker(false);\r\n      }\r\n    };\r\n    \r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, [setShowEmojiPicker]);\r\n\r\n  // Focus input after emoji selection\r\n  const handleEmojiClickWithFocus = useCallback((emoji: string) => {\r\n    handleEmojiClick(emoji);\r\n    setTimeout(() => {\r\n      if (inputRef.current) {\r\n        inputRef.current.focus();\r\n      }\r\n    }, 0);\r\n  }, [handleEmojiClick]);\r\n\r\n  // Handle reply with input focus\r\n  const handleReplyWithFocus = useCallback(() => {\r\n    console.log('handleReplyWithFocus called', { activeThread, replyMessage, hasImage: !!selectedImage });\r\n    \r\n    // Don't send if no active thread\r\n    if (!activeThread) {\r\n      console.error('No active thread selected');\r\n      return;\r\n    }\r\n\r\n    // Don't send if message is empty and no image\r\n    if (!replyMessage.trim() && !selectedImage) {\r\n      console.log('Cannot send empty message');\r\n      return;\r\n    }\r\n\r\n    console.log('Calling handleReply...');\r\n    \r\n    handleReply();\r\n    \r\n    if (fileInputRef.current) {\r\n      fileInputRef.current.value = '';\r\n    }\r\n    setTimeout(() => {\r\n      if (inputRef.current) {\r\n        inputRef.current.focus();\r\n      }\r\n    }, 0);\r\n  }, [activeThread, replyMessage, selectedImage, handleReply]);\r\n\r\n  // Handle image selection from file input\r\n  const handleImageSelectFromInput = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = event.target.files?.[0];\r\n    if (!file) return;\r\n    \r\n    setImageError(null);\r\n    \r\n    if (!ALLOWED_IMAGE_TYPES.includes(file.type)) {\r\n      setImageError(\"Please select a valid image file (JPEG, PNG, GIF, WEBP)\");\r\n      return;\r\n    }\r\n    \r\n    if (file.size > MAX_IMAGE_SIZE) {\r\n      setImageError(`Image too large. Maximum size is ${MAX_IMAGE_SIZE / (1024 * 1024)}MB`);\r\n      return;\r\n    }\r\n    \r\n    handleImageSelect(file);\r\n  }, [setImageError, handleImageSelect]);\r\n\r\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleReplyWithFocus();\r\n    }\r\n  }, [handleReplyWithFocus]);\r\n\r\n  const triggerFileInput = useCallback(() => {\r\n    fileInputRef.current?.click();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      {/* Emoji Picker */}\r\n      {showEmojiPicker && (\r\n        <div ref={emojiPickerRef}>\r\n          <EmojiPicker\r\n            recentEmojis={recentEmojis}\r\n            onEmojiClick={handleEmojiClickWithFocus}\r\n          />\r\n        </div>\r\n      )}\r\n      \r\n      <MessageInput\r\n        ref={inputRef}\r\n        replyMessage={replyMessage}\r\n        setReplyMessage={setReplyMessage}\r\n        selectedImage={selectedImage}\r\n        setSelectedImage={setSelectedImage}\r\n        imageError={imageError}\r\n        isImageLoading={isImageLoading}\r\n        showEmojiPicker={showEmojiPicker}\r\n        setShowEmojiPicker={setShowEmojiPicker}\r\n        isUserBlocked={isUserBlocked}\r\n        onReply={handleReplyWithFocus}\r\n        onKeyDown={handleKeyDown}\r\n        onImageClick={triggerFileInput}\r\n        onBlockToggle={onBlockToggle}\r\n        fileInputRef={fileInputRef}\r\n        emojiPickerRef={emojiPickerRef}\r\n        onImageSelect={handleImageSelectFromInput}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 5025, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/messaging/TypingIndicator.tsx"],"sourcesContent":["// src/components/messaging/TypingIndicator.tsx\r\n'use client';\r\n\r\nimport React from 'react';\r\n\r\ninterface TypingIndicatorProps {\r\n  username: string;\r\n  isTyping: boolean;\r\n  userPic?: string | null;\r\n}\r\n\r\nexport default function TypingIndicator({ username, isTyping, userPic }: TypingIndicatorProps) {\r\n  if (!isTyping) return null;\r\n\r\n  return (\r\n    <div\r\n      className=\"flex items-end gap-2 mb-3\"\r\n      style={{ animation: 'fadeIn 0.3s ease-out' }}\r\n      aria-live=\"polite\"\r\n      aria-atomic=\"true\"\r\n    >\r\n      {/* User Avatar */}\r\n      <div className=\"flex-shrink-0\">\r\n        {userPic ? (\r\n          <img\r\n            src={userPic}\r\n            alt={username}\r\n            className=\"w-8 h-8 rounded-full object-cover\"\r\n          />\r\n        ) : (\r\n          <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-xs font-bold\">\r\n            {username.charAt(0).toUpperCase()}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Typing Bubble Container */}\r\n      <div className=\"flex flex-col\">\r\n        <div className=\"text-xs text-gray-400 mb-1\" aria-label={`${username} is typing`}>\r\n          {username} is typing\r\n        </div>\r\n\r\n        {/* Clean bubble without tail */}\r\n        <div\r\n          className=\"inline-flex items-center justify-center gap-1 px-2.5 py-1.5 rounded shadow-sm\"\r\n          style={{\r\n            background: 'linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%)',\r\n            border: '1px solid rgba(255, 149, 14, 0.15)',\r\n            borderRadius: '6px',\r\n            width: 'fit-content',\r\n            minWidth: '48px',\r\n            maxWidth: '56px',\r\n          }}\r\n        >\r\n          {/* Typing dots */}\r\n          <span\r\n            className=\"typing-dot\"\r\n            style={{\r\n              width: '5px',\r\n              height: '5px',\r\n              background: '#ff950e',\r\n              borderRadius: '50%',\r\n              display: 'inline-block',\r\n              animation: 'typingBounce 1.4s infinite ease-in-out',\r\n              animationDelay: '0ms',\r\n            }}\r\n          />\r\n          <span\r\n            className=\"typing-dot\"\r\n            style={{\r\n              width: '5px',\r\n              height: '5px',\r\n              background: '#ff950e',\r\n              borderRadius: '50%',\r\n              display: 'inline-block',\r\n              animation: 'typingBounce 1.4s infinite ease-in-out',\r\n              animationDelay: '200ms',\r\n            }}\r\n          />\r\n          <span\r\n            className=\"typing-dot\"\r\n            style={{\r\n              width: '5px',\r\n              height: '5px',\r\n              background: '#ff950e',\r\n              borderRadius: '50%',\r\n              display: 'inline-block',\r\n              animation: 'typingBounce 1.4s infinite ease-in-out',\r\n              animationDelay: '400ms',\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Inline styles for animations - REDUCED BOUNCE HEIGHT */}\r\n      <style jsx>{`\r\n        @keyframes typingBounce {\r\n          0%, 60%, 100% {\r\n            transform: translateY(0);\r\n            opacity: 0.6;\r\n          }\r\n          30% {\r\n            transform: translateY(-4px);\r\n            opacity: 1;\r\n          }\r\n        }\r\n\r\n        @keyframes fadeIn {\r\n          from {\r\n            opacity: 0;\r\n            transform: translateY(10px);\r\n          }\r\n          to {\r\n            opacity: 1;\r\n            transform: translateY(0);\r\n          }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,+CAA+C;;;;;;AAC/C;;;AAUe,SAAS,gBAAgB,KAAqD;QAArD,EAAE,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAwB,GAArD;IACtC,IAAI,CAAC,UAAU,OAAO;IAEtB,qBACE,6LAAC;QAEC,OAAO;YAAE,WAAW;QAAuB;QAC3C,aAAU;QACV,eAAY;kDAHF;;0BAMV,6LAAC;0DAAc;0BACZ,wBACC,6LAAC;oBACC,KAAK;oBACL,KAAK;8DACK;;;;;yCAGZ,6LAAC;8DAAc;8BACZ,SAAS,MAAM,CAAC,GAAG,WAAW;;;;;;;;;;;0BAMrC,6LAAC;0DAAc;;kCACb,6LAAC;wBAA2C,cAAY,AAAC,GAAW,OAAT,UAAS;kEAArD;;4BACZ;4BAAS;;;;;;;kCAIZ,6LAAC;wBAEC,OAAO;4BACL,YAAY;4BACZ,QAAQ;4BACR,cAAc;4BACd,OAAO;4BACP,UAAU;4BACV,UAAU;wBACZ;kEARU;;0CAWV,6LAAC;gCAEC,OAAO;oCACL,OAAO;oCACP,QAAQ;oCACR,YAAY;oCACZ,cAAc;oCACd,SAAS;oCACT,WAAW;oCACX,gBAAgB;gCAClB;0EATU;;;;;;0CAWZ,6LAAC;gCAEC,OAAO;oCACL,OAAO;oCACP,QAAQ;oCACR,YAAY;oCACZ,cAAc;oCACd,SAAS;oCACT,WAAW;oCACX,gBAAgB;gCAClB;0EATU;;;;;;0CAWZ,6LAAC;gCAEC,OAAO;oCACL,OAAO;oCACP,QAAQ;oCACR,YAAY;oCACZ,cAAc;oCACd,SAAS;oCACT,WAAW;oCACX,gBAAgB;gCAClB;0EATU;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwCtB;KA7GwB","debugId":null}},
    {"offset": {"line": 5177, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/seller/messages/ConversationView.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useRef, useEffect, useMemo, useState, useCallback } from 'react';\r\nimport { useWebSocket } from '@/context/WebSocketContext';\r\nimport ChatHeader from './ChatHeader';\r\nimport MessagesList from './MessagesList';\r\nimport MessageInputContainer from './MessageInputContainer';\r\nimport TypingIndicator from '@/components/messaging/TypingIndicator';\r\n\r\n// Import existing types instead of redefining\r\nimport type { Message } from '@/utils/messageUtils';\r\nimport type { CustomRequest } from '@/context/RequestContext';\r\n\r\n// Match the actual shape of buyerProfiles from useSellerMessages\r\ninterface BuyerProfile {\r\n  pic: string | null;\r\n  verified: boolean;\r\n}\r\n\r\ninterface User {\r\n  id: string;\r\n  username: string;\r\n  role: 'buyer' | 'seller' | 'admin';\r\n}\r\n\r\ninterface Threads {\r\n  [key: string]: Message[];\r\n}\r\n\r\n// Helper to get conversation key\r\nconst getConversationKey = (userA: string, userB: string): string => {\r\n  return [userA, userB].sort().join('-');\r\n};\r\n\r\n// Group edit-related props\r\ninterface EditRequestControls {\r\n  editRequestId: string | null;\r\n  setEditRequestId: (id: string | null) => void;\r\n  editPrice: number | '';\r\n  setEditPrice: (price: number | '') => void;\r\n  editTitle: string;\r\n  setEditTitle: (title: string) => void;\r\n  editMessage: string;\r\n  setEditMessage: (message: string) => void;\r\n  handleEditSubmit: () => void;\r\n}\r\n\r\n// Group message input props\r\ninterface MessageInputControls {\r\n  replyMessage: string;\r\n  setReplyMessage: (message: string) => void;\r\n  selectedImage: string | null;\r\n  setSelectedImage: (image: string | null) => void;\r\n  isImageLoading: boolean;\r\n  setIsImageLoading: (loading: boolean) => void;\r\n  imageError: string | null;\r\n  setImageError: (error: string | null) => void;\r\n  showEmojiPicker: boolean;\r\n  setShowEmojiPicker: (show: boolean) => void;\r\n  recentEmojis: string[];\r\n  handleReply: () => void;\r\n  handleEmojiClick: (emoji: string) => void;\r\n  handleImageSelect: (file: File) => void;\r\n}\r\n\r\ninterface ConversationViewProps {\r\n  activeThread: string;\r\n  threads: Threads;\r\n  buyerProfiles: Record<string, BuyerProfile>;\r\n  sellerRequests: CustomRequest[];\r\n  isUserBlocked: boolean;\r\n  isUserReported: boolean;\r\n  handleReport: () => void;\r\n  handleBlockToggle: () => void;\r\n  user: User;\r\n  messageInputControls: MessageInputControls;\r\n  editRequestControls: EditRequestControls;\r\n  handleAccept: (requestId: string) => void;\r\n  handleDecline: (requestId: string) => void;\r\n  handleEditRequest: (requestId: string, title: string, price: number, message: string) => void;\r\n  handleMessageVisible: (msg: Message) => void;\r\n  setPreviewImage: (url: string | null) => void;\r\n}\r\n\r\n// Debug flag - set to false in production\r\nconst DEBUG = process.env.NODE_ENV === 'development';\r\n\r\nexport default function ConversationView({\r\n  activeThread,\r\n  threads,\r\n  buyerProfiles,\r\n  sellerRequests,\r\n  isUserBlocked,\r\n  isUserReported,\r\n  handleReport,\r\n  handleBlockToggle,\r\n  user,\r\n  messageInputControls,\r\n  editRequestControls,\r\n  handleAccept,\r\n  handleDecline,\r\n  handleEditRequest,\r\n  handleMessageVisible,\r\n  setPreviewImage,\r\n}: ConversationViewProps) {\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const messagesContainerRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Get WebSocket context for thread focus/blur and typing\r\n  const wsContext = useWebSocket();\r\n\r\n  // State for typing indicator\r\n  const [isBuyerTyping, setIsBuyerTyping] = useState(false);\r\n\r\n  // Refs for typing management\r\n  const typingTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\r\n  const isTypingRef = useRef(false);\r\n  const lastTypingEmitRef = useRef(0);\r\n  const autoHideTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\r\n  const hasScrolledForTypingRef = useRef(false); // Track if we've already scrolled for current typing session\r\n  const userHasScrolledRef = useRef(false); // Track if user has manually scrolled\r\n\r\n  // Track manual scrolling\r\n  useEffect(() => {\r\n    const container = messagesContainerRef.current;\r\n    if (!container) return;\r\n\r\n    const handleScroll = () => {\r\n      const { scrollHeight, scrollTop, clientHeight } = container;\r\n      const isAtBottom = scrollHeight - scrollTop - clientHeight < 50;\r\n\r\n      // If user scrolled up (not at bottom), mark as manually scrolled\r\n      if (!isAtBottom) {\r\n        userHasScrolledRef.current = true;\r\n      } else {\r\n        userHasScrolledRef.current = false;\r\n      }\r\n    };\r\n\r\n    container.addEventListener('scroll', handleScroll);\r\n    return () => container.removeEventListener('scroll', handleScroll);\r\n  }, [activeThread]); // Reset when thread changes\r\n\r\n  // Handle thread focus/blur for auto-read functionality\r\n  useEffect(() => {\r\n    if (!activeThread || !user || !wsContext?.sendMessage) {\r\n      return;\r\n    }\r\n\r\n    const threadId = getConversationKey(user.username, activeThread);\r\n\r\n    // Notify backend that seller is viewing this thread\r\n    wsContext.sendMessage('thread:focus', {\r\n      threadId,\r\n      otherUser: activeThread,\r\n    });\r\n\r\n    return () => {\r\n      // Notify backend when seller leaves the thread\r\n      wsContext.sendMessage?.('thread:blur', {\r\n        threadId,\r\n        otherUser: activeThread,\r\n      });\r\n    };\r\n  }, [activeThread, user, wsContext]);\r\n\r\n  // Listen for buyer typing events\r\n  useEffect(() => {\r\n    if (!wsContext || !activeThread || !user) return;\r\n\r\n    const conversationId = getConversationKey(user.username, activeThread);\r\n\r\n    const handleTypingEvent = (data: any) => {\r\n      if (data.conversationId === conversationId && data.username === activeThread) {\r\n        // Clear any existing auto-hide timeout\r\n        if (autoHideTimeoutRef.current) {\r\n          clearTimeout(autoHideTimeoutRef.current);\r\n          autoHideTimeoutRef.current = null;\r\n        }\r\n\r\n        setIsBuyerTyping(data.isTyping);\r\n\r\n        // Auto-hide after 5 seconds\r\n        if (data.isTyping) {\r\n          autoHideTimeoutRef.current = setTimeout(() => {\r\n            setIsBuyerTyping(false);\r\n            hasScrolledForTypingRef.current = false;\r\n            autoHideTimeoutRef.current = null;\r\n          }, 5000);\r\n        } else {\r\n          hasScrolledForTypingRef.current = false;\r\n        }\r\n      }\r\n    };\r\n\r\n    // Listen for new messages to clear typing indicator\r\n    const handleNewMessage = (data: any) => {\r\n      // If we receive a message from the buyer, clear their typing indicator immediately\r\n      if (data.sender === activeThread && data.receiver === user.username) {\r\n        setIsBuyerTyping(false);\r\n        hasScrolledForTypingRef.current = false;\r\n        if (autoHideTimeoutRef.current) {\r\n          clearTimeout(autoHideTimeoutRef.current);\r\n          autoHideTimeoutRef.current = null;\r\n        }\r\n      }\r\n    };\r\n\r\n    const unsubscribeTyping = wsContext?.subscribe('message:typing', handleTypingEvent);\r\n    const unsubscribeMessage = wsContext?.subscribe('message:new', handleNewMessage);\r\n\r\n    return () => {\r\n      if (autoHideTimeoutRef.current) {\r\n        clearTimeout(autoHideTimeoutRef.current);\r\n        autoHideTimeoutRef.current = null;\r\n      }\r\n      unsubscribeTyping?.();\r\n      unsubscribeMessage?.();\r\n    };\r\n  }, [activeThread, user, wsContext]);\r\n\r\n  // Track typing state changes for scroll management\r\n  useEffect(() => {\r\n    // If typing just started, reset the scroll flag and scroll to bottom once\r\n    if (isBuyerTyping && !isTypingRef.current) {\r\n      hasScrolledForTypingRef.current = false;\r\n      userHasScrolledRef.current = false; // Reset user scroll flag for new typing session\r\n\r\n      // Auto-scroll to bottom once when typing starts\r\n      setTimeout(() => {\r\n        if (messagesContainerRef.current && !hasScrolledForTypingRef.current) {\r\n          const container = messagesContainerRef.current;\r\n          container.scrollTop = container.scrollHeight - container.clientHeight;\r\n          hasScrolledForTypingRef.current = true;\r\n        }\r\n      }, 350); // Wait for typing indicator to render\r\n    }\r\n    isTypingRef.current = isBuyerTyping;\r\n  }, [isBuyerTyping]);\r\n\r\n  // Enhanced message input controls with typing events\r\n  const enhancedMessageInputControls = useMemo(() => {\r\n    const handleTypingChange = (value: string) => {\r\n      messageInputControls.setReplyMessage(value);\r\n\r\n      // Emit typing event\r\n      if (wsContext && activeThread && user) {\r\n        const conversationId = getConversationKey(user.username, activeThread);\r\n        const now = Date.now();\r\n\r\n        // Clear existing timeout\r\n        if (typingTimeoutRef.current) {\r\n          clearTimeout(typingTimeoutRef.current);\r\n        }\r\n\r\n        // Send typing indicator\r\n        if (value.trim()) {\r\n          // Only send typing event if we haven't sent one recently (debounce)\r\n          // OR if we weren't typing before\r\n          if (!isTypingRef.current || now - lastTypingEmitRef.current > 1000) {\r\n            wsContext.sendMessage('message:typing', {\r\n              conversationId,\r\n              isTyping: true,\r\n            });\r\n            lastTypingEmitRef.current = now;\r\n            isTypingRef.current = true;\r\n          }\r\n\r\n          // Stop typing after 3 seconds of inactivity\r\n          typingTimeoutRef.current = setTimeout(() => {\r\n            isTypingRef.current = false;\r\n            wsContext.sendMessage('message:typing', {\r\n              conversationId,\r\n              isTyping: false,\r\n            });\r\n          }, 3000);\r\n        } else {\r\n          // If input is empty, stop typing immediately\r\n          if (isTypingRef.current) {\r\n            isTypingRef.current = false;\r\n            wsContext.sendMessage('message:typing', {\r\n              conversationId,\r\n              isTyping: false,\r\n            });\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    // Stop typing when message is sent\r\n    const stopTyping = () => {\r\n      if (wsContext && activeThread && user && isTypingRef.current) {\r\n        const conversationId = getConversationKey(user.username, activeThread);\r\n\r\n        // Clear typing timeout\r\n        if (typingTimeoutRef.current) {\r\n          clearTimeout(typingTimeoutRef.current);\r\n          typingTimeoutRef.current = null;\r\n        }\r\n\r\n        // Send stop typing event\r\n        isTypingRef.current = false;\r\n        wsContext.sendMessage('message:typing', {\r\n          conversationId,\r\n          isTyping: false,\r\n        });\r\n      }\r\n    };\r\n\r\n    // Wrap the original handleReply to stop typing first\r\n    const handleReplyWithStopTyping = () => {\r\n      stopTyping();\r\n      messageInputControls.handleReply();\r\n    };\r\n\r\n    return {\r\n      ...messageInputControls,\r\n      setReplyMessage: handleTypingChange,\r\n      handleReply: handleReplyWithStopTyping,\r\n    };\r\n  }, [messageInputControls, activeThread, user, wsContext]);\r\n\r\n  // Get messages for the active thread (use raw key for data access)\r\n  const threadMessages = useMemo(() => {\r\n    if (DEBUG) {\r\n      console.log('=== ConversationView threadMessages calculation ===');\r\n      console.log('activeThread:', activeThread);\r\n      console.log('threads keys:', Object.keys(threads));\r\n    }\r\n\r\n    if (!activeThread || typeof activeThread !== 'string') {\r\n      if (DEBUG) console.log('Invalid activeThread');\r\n      return [];\r\n    }\r\n\r\n    if (!threads || !threads[activeThread]) {\r\n      if (DEBUG) console.log('No threads object or no messages for thread');\r\n      return [];\r\n    }\r\n\r\n    const messages = Array.isArray(threads[activeThread]) ? threads[activeThread] : [];\r\n    if (DEBUG) console.log('Thread messages for', activeThread, ':', messages);\r\n\r\n    // Process custom request messages with validation\r\n    const processed = getLatestCustomRequestMessages(messages, sellerRequests);\r\n    if (DEBUG) console.log('Processed messages:', processed);\r\n    return processed;\r\n  }, [activeThread, threads, sellerRequests]);\r\n\r\n  // Auto-scroll to bottom when messages change\r\n  useEffect(() => {\r\n    if (messagesEndRef.current) {\r\n      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\r\n    }\r\n  }, [activeThread, threadMessages.length]);\r\n\r\n  const safeBuyerProfile: BuyerProfile = buyerProfiles[activeThread] ?? { pic: null, verified: false };\r\n\r\n  return (\r\n    <>\r\n      {/* Conversation header */}\r\n      <ChatHeader\r\n        activeThread={activeThread}\r\n        buyerProfile={safeBuyerProfile}\r\n        isUserReported={isUserReported}\r\n        isUserBlocked={isUserBlocked}\r\n        onReport={handleReport}\r\n        onBlockToggle={handleBlockToggle}\r\n      />\r\n\r\n      {/* Messages */}\r\n      <div ref={messagesContainerRef} className=\"flex-1 overflow-y-auto p-4 bg-[#121212]\">\r\n        <div className=\"max-w-3xl mx-auto space-y-4\">\r\n          <MessagesList\r\n            threadMessages={threadMessages}\r\n            sellerRequests={sellerRequests}\r\n            user={user}\r\n            activeThread={activeThread}\r\n            handleAccept={handleAccept}\r\n            handleDecline={handleDecline}\r\n            handleEditRequest={handleEditRequest}\r\n            handleEditSubmit={editRequestControls.handleEditSubmit}\r\n            handleMessageVisible={handleMessageVisible}\r\n            editRequestId={editRequestControls.editRequestId}\r\n            setEditRequestId={editRequestControls.setEditRequestId}\r\n            editPrice={editRequestControls.editPrice}\r\n            setEditPrice={editRequestControls.setEditPrice}\r\n            editTitle={editRequestControls.editTitle}\r\n            setEditTitle={editRequestControls.setEditTitle}\r\n            editMessage={editRequestControls.editMessage}\r\n            setEditMessage={editRequestControls.setEditMessage}\r\n            setPreviewImage={setPreviewImage}\r\n          />\r\n\r\n          {/* Typing Indicator */}\r\n          <TypingIndicator\r\n            username={activeThread}\r\n            isTyping={isBuyerTyping}\r\n            userPic={buyerProfiles[activeThread]?.pic}\r\n          />\r\n\r\n          {/* Auto-scroll anchor */}\r\n          <div ref={messagesEndRef} />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Message input */}\r\n      <MessageInputContainer\r\n        isUserBlocked={isUserBlocked}\r\n        onBlockToggle={handleBlockToggle}\r\n        activeThread={activeThread}\r\n        {...enhancedMessageInputControls}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\n// Helper function to process custom request messages with validation\r\nfunction getLatestCustomRequestMessages(messages: Message[], requests: CustomRequest[]): Message[] {\r\n  if (!Array.isArray(messages)) {\r\n    if (DEBUG) console.warn('Invalid messages array provided to getLatestCustomRequestMessages');\r\n    return [];\r\n  }\r\n\r\n  const seen = new Set<string>();\r\n  const result: Message[] = [];\r\n\r\n  for (let i = messages.length - 1; i >= 0; i--) {\r\n    const msg = messages[i];\r\n    if (!msg || typeof msg !== 'object') continue;\r\n\r\n    if (msg.type === 'customRequest' && msg.meta && msg.meta.id) {\r\n      const requestId = String(msg.meta.id);\r\n      if (!seen.has(requestId)) {\r\n        seen.add(requestId);\r\n        result.unshift(msg);\r\n      }\r\n    } else {\r\n      result.unshift(msg);\r\n    }\r\n  }\r\n\r\n  return result;\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 5617, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/seller/messages/EmptyState.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React from 'react';\r\nimport { MessageSquare, DollarSign, Star, TrendingUp, Package, Shield, Camera, Clock } from 'lucide-react';\r\nimport Link from 'next/link';\r\n\r\nexport default function EmptyState() {\r\n  const [messageCount, setMessageCount] = React.useState(0);\r\n  const [showCounter, setShowCounter] = React.useState(false);\r\n\r\n  const countIntervalRef = React.useRef<ReturnType<typeof setInterval> | null>(null);\r\n\r\n  React.useEffect(() => {\r\n    const animateCounter = () => {\r\n      // Show counter\r\n      setShowCounter(true);\r\n      setMessageCount(0);\r\n\r\n      // Count up animation\r\n      let count = 0;\r\n      if (countIntervalRef.current) clearInterval(countIntervalRef.current);\r\n      countIntervalRef.current = setInterval(() => {\r\n        count++;\r\n        setMessageCount(count);\r\n\r\n        if (count >= 5) {\r\n          if (countIntervalRef.current) {\r\n            clearInterval(countIntervalRef.current);\r\n            countIntervalRef.current = null;\r\n          }\r\n\r\n          // Hide counter after a brief pause\r\n          setTimeout(() => {\r\n            setShowCounter(false);\r\n            setMessageCount(0);\r\n          }, 1000);\r\n        }\r\n      }, 1000); // 1 second per count\r\n    };\r\n\r\n    // Initial animation after a short delay\r\n    const initialTimeout = setTimeout(animateCounter, 500);\r\n\r\n    // Repeat animation every 8 seconds (5 seconds counting + 1 second pause + 2 seconds wait)\r\n    const repeatInterval = setInterval(animateCounter, 8000);\r\n\r\n    return () => {\r\n      clearTimeout(initialTimeout);\r\n      clearInterval(repeatInterval);\r\n      if (countIntervalRef.current) {\r\n        clearInterval(countIntervalRef.current);\r\n        countIntervalRef.current = null;\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const tips = [\r\n    {\r\n      icon: <Clock className=\"w-4 h-4 text-green-500\" />,\r\n      text: 'Respond to messages quickly to boost your rating',\r\n    },\r\n    {\r\n      icon: <Camera className=\"w-4 h-4 text-blue-500\" />,\r\n      text: 'Send clear photos when discussing custom orders',\r\n    },\r\n    {\r\n      icon: <DollarSign className=\"w-4 h-4 text-yellow-500\" />,\r\n      text: 'Set competitive prices for custom requests',\r\n    },\r\n    {\r\n      icon: <Shield className=\"w-4 h-4 text-purple-500\" />,\r\n      text: 'Get verified to attract more buyers',\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"flex-1 flex items-center justify-center bg-[#121212] p-8\">\r\n      <div className=\"text-center max-w-md\">\r\n        {/* Animated Icon Container */}\r\n        <div className=\"relative mb-6\">\r\n          <div className=\"w-24 h-24 bg-gradient-to-br from-[#ff950e]/20 to-[#ff950e]/5 rounded-full flex items-center justify-center mx-auto animate-pulse\">\r\n            <div className=\"w-20 h-20 bg-gradient-to-br from-[#ff950e]/30 to-[#ff950e]/10 rounded-full flex items-center justify-center relative\">\r\n              <MessageSquare className=\"w-12 h-12 text-[#ff950e]\" />\r\n\r\n              {/* Animated Message Counter - positioned on the icon */}\r\n              <div\r\n                className={`absolute top-2 right-2 bg-red-500 text-white rounded-full min-w-[20px] h-5 flex items-center justify-center px-1 font-bold text-xs shadow-lg transition-all duration-300 ${\r\n                  showCounter ? 'opacity-100 scale-100' : 'opacity-0 scale-0'\r\n                }`}\r\n              >\r\n                {messageCount}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <h2 className=\"text-3xl font-bold text-white mb-3 bg-gradient-to-r from-white to-gray-300 bg-clip-text text-transparent\">\r\n          Ready for Messages\r\n        </h2>\r\n\r\n        <p className=\"text-gray-400 mb-8 text-lg leading-relaxed\">\r\n          When buyers message you, they'll appear here. Keep your notifications on to never miss a sale!\r\n        </p>\r\n\r\n        {/* Quick Stats */}\r\n        <div className=\"grid grid-cols-3 gap-4 mb-8\">\r\n          <div className=\"bg-[#1a1a1a] rounded-lg p-3 border border-gray-800\">\r\n            <Package className=\"w-5 h-5 text-[#ff950e] mx-auto mb-1\" />\r\n            <p className=\"text-xs text-gray-400\">Active Listings</p>\r\n            <p className=\"text-lg font-bold text-white\">--</p>\r\n          </div>\r\n          <div className=\"bg-[#1a1a1a] rounded-lg p-3 border border-gray-800\">\r\n            <Star className=\"w-5 h-5 text-yellow-500 mx-auto mb-1\" />\r\n            <p className=\"text-xs text-gray-400\">Avg Rating</p>\r\n            <p className=\"text-lg font-bold text-white\">--</p>\r\n          </div>\r\n          <div className=\"bg-[#1a1a1a] rounded-lg p-3 border border-gray-800\">\r\n            <TrendingUp className=\"w-5 h-5 text-green-500 mx-auto mb-1\" />\r\n            <p className=\"text-xs text-gray-400\">Response Time</p>\r\n            <p className=\"text-lg font-bold text-white\">--</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Primary CTA */}\r\n        <Link\r\n          href=\"/sellers/my-listings\"\r\n          className=\"group inline-flex items-center gap-3 bg-gradient-to-r from-[#ff950e] to-[#e88800] text-white px-8 py-4 rounded-xl font-semibold hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 shadow-lg\"\r\n          style={{\r\n            color: '#ffffff !important',\r\n            textDecoration: 'none',\r\n          }}\r\n        >\r\n          <span style={{ color: '#ffffff' }} className=\"text-lg\">\r\n            Create a Listing\r\n          </span>\r\n          <Package size={20} style={{ color: '#ffffff' }} className=\"group-hover:rotate-12 transition-transform\" />\r\n        </Link>\r\n\r\n        {/* Enhanced Tips Section */}\r\n        <div className=\"mt-12 bg-[#1a1a1a] rounded-xl p-6 border border-gray-800\">\r\n          <p className=\"text-sm font-semibold text-white mb-4 flex items-center justify-center gap-2\">\r\n            <Star className=\"w-4 h-4 text-[#ff950e]\" />\r\n            Pro Seller Tips\r\n          </p>\r\n          <div className=\"space-y-3\">\r\n            {tips.map((tip, index) => (\r\n              <div\r\n                key={index}\r\n                className=\"flex items-start gap-3 text-left group hover:bg-[#222] p-2 rounded-lg transition-colors\"\r\n              >\r\n                <div className=\"flex-shrink-0 mt-0.5\">{tip.icon}</div>\r\n                <p className=\"text-sm text-gray-400 group-hover:text-gray-300 transition-colors\">{tip.text}</p>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Secondary Actions */}\r\n        <div className=\"mt-8 flex items-center justify-center gap-4 text-sm\">\r\n          <Link\r\n            href=\"/sellers/profile\"\r\n            className=\"text-[#ff950e] hover:text-[#e88800] font-medium transition-colors\"\r\n            style={{ color: '#ff950e !important' }}\r\n          >\r\n            Complete Your Profile\r\n          </Link>\r\n          <span className=\"text-gray-600\">•</span>\r\n          <Link\r\n            href=\"/sellers/verify\"\r\n            className=\"text-[#ff950e] hover:text-[#e88800] font-medium transition-colors\"\r\n            style={{ color: '#ff950e !important' }}\r\n          >\r\n            Get Verified\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 6055, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/components/messaging/ImagePreviewModal.tsx"],"sourcesContent":["// src/components/messaging/ImagePreviewModal.tsx\r\n'use client';\r\n\r\nimport React, { useEffect, useCallback } from 'react';\r\nimport { X } from 'lucide-react';\r\n\r\ninterface ImagePreviewModalProps {\r\n  imageUrl: string;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nconst ImagePreviewModal: React.FC<ImagePreviewModalProps> = ({\r\n  imageUrl,\r\n  isOpen,\r\n  onClose,\r\n}) => {\r\n  // Close on Escape\r\n  const handleKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') onClose();\r\n    },\r\n    [onClose]\r\n  );\r\n\r\n  // Prevent background scroll while open + add key listener\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    document.body.style.overflow = 'hidden';\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => {\r\n      document.body.style.overflow = '';\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n  }, [isOpen, handleKeyDown]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div\r\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/75\"\r\n      onClick={onClose}\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      aria-label=\"Image preview\"\r\n    >\r\n      <div\r\n        className=\"relative max-w-[90vw] max-h-[90vh] outline-none\"\r\n        onClick={(e) => e.stopPropagation()}\r\n        tabIndex={-1}\r\n      >\r\n        <button\r\n          onClick={onClose}\r\n          className=\"absolute -top-4 -right-4 bg-red-500 text-white rounded-full p-2 shadow-lg\"\r\n          aria-label=\"Close preview\"\r\n        >\r\n          <X size={20} />\r\n        </button>\r\n        {/* Guard against empty URL */}\r\n        {imageUrl ? (\r\n          <img\r\n            src={imageUrl}\r\n            alt=\"Full size preview\"\r\n            className=\"max-w-full max-h-[90vh] object-contain rounded-lg\"\r\n            draggable={false}\r\n          />\r\n        ) : (\r\n          <div className=\"max-w-full max-h-[90vh] p-8 bg-[#1a1a1a] text-gray-400 rounded-lg\">\r\n            Image unavailable\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ImagePreviewModal;\r\n"],"names":[],"mappings":"AAAA,iDAAiD;;;;;AAGjD;AACA;;;AAHA;;;AAWA,MAAM,oBAAsD;QAAC,EAC3D,QAAQ,EACR,MAAM,EACN,OAAO,EACR;;IACC,kBAAkB;IAClB,MAAM,gBAAgB,CAAA,GAAA,6JAAA,CAAA,cAAW,AAAD;wDAC9B,CAAC;YACC,IAAI,EAAE,GAAG,KAAK,UAAU;QAC1B;uDACA;QAAC;KAAQ;IAGX,0DAA0D;IAC1D,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;uCAAE;YACR,IAAI,CAAC,QAAQ;YACb,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;YAC/B,OAAO,gBAAgB,CAAC,WAAW;YACnC;+CAAO;oBACL,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;oBAC/B,OAAO,mBAAmB,CAAC,WAAW;gBACxC;;QACF;sCAAG;QAAC;QAAQ;KAAc;IAE1B,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,6LAAC;QACC,WAAU;QACV,SAAS;QACT,MAAK;QACL,cAAW;QACX,cAAW;kBAEX,cAAA,6LAAC;YACC,WAAU;YACV,SAAS,CAAC,IAAM,EAAE,eAAe;YACjC,UAAU,CAAC;;8BAEX,6LAAC;oBACC,SAAS;oBACT,WAAU;oBACV,cAAW;8BAEX,cAAA,6LAAC,+LAAA,CAAA,IAAC;wBAAC,MAAM;;;;;;;;;;;gBAGV,yBACC,6LAAC;oBACC,KAAK;oBACL,KAAI;oBACJ,WAAU;oBACV,WAAW;;;;;6EAGb,6LAAC;oBAAI,WAAU;8BAAoE;;;;;;;;;;;;;;;;;AAO7F;GA9DM;KAAA;uCAgES","debugId":null}},
    {"offset": {"line": 6166, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/osr99/OneDrive/Documents/GitHub/pantypost/src/app/sellers/messages/page.tsx"],"sourcesContent":["// src/app/sellers/messages/page.tsx\r\n'use client';\r\n\r\nimport React from 'react';\r\nimport RequireAuth from '@/components/RequireAuth';\r\nimport BanCheck from '@/components/BanCheck';\r\nimport { useSellerMessages } from '@/hooks/useSellerMessages';\r\nimport ThreadsSidebar from '@/components/seller/messages/ThreadsSidebar';\r\nimport ConversationView from '@/components/seller/messages/ConversationView';\r\nimport EmptyState from '@/components/seller/messages/EmptyState';\r\nimport ImagePreviewModal from '@/components/messaging/ImagePreviewModal';\r\n\r\nexport default function SellerMessagesPage() {\r\n  const {\r\n    // Auth\r\n    user,\r\n    isAdmin,\r\n\r\n    // Messages & threads\r\n    threads,\r\n    unreadCounts,\r\n    uiUnreadCounts,\r\n    lastMessages,\r\n    buyerProfiles,\r\n    totalUnreadCount,\r\n    activeThread,\r\n    setActiveThread,\r\n\r\n    // UI State\r\n    previewImage,\r\n    setPreviewImage,\r\n    searchQuery,\r\n    setSearchQuery,\r\n    filterBy,\r\n    setFilterBy,\r\n    observerReadMessages,\r\n    setObserverReadMessages,\r\n\r\n    // Message input\r\n    replyMessage,\r\n    setReplyMessage,\r\n    selectedImage,\r\n    setSelectedImage,\r\n    isImageLoading,\r\n    setIsImageLoading,\r\n    imageError,\r\n    setImageError,\r\n    showEmojiPicker,\r\n    setShowEmojiPicker,\r\n    recentEmojis,\r\n\r\n    // Custom requests\r\n    sellerRequests,\r\n    editRequestId,\r\n    setEditRequestId,\r\n    editPrice,\r\n    setEditPrice,\r\n    editTitle,\r\n    setEditTitle,\r\n    editMessage,\r\n    setEditMessage,\r\n\r\n    // Actions\r\n    handleReply,\r\n    handleBlockToggle,\r\n    handleReport,\r\n    handleAccept,\r\n    handleDecline,\r\n    handleEditRequest,\r\n    handleEditSubmit,\r\n    handleImageSelect,\r\n    handleMessageVisible,\r\n    handleEmojiClick,\r\n\r\n    // Status\r\n    isUserBlocked,\r\n    isUserReported,\r\n  } = useSellerMessages();\r\n\r\n  if (!user) {\r\n    return (\r\n      <BanCheck>\r\n        <RequireAuth role=\"seller\">\r\n          <div className=\"h-screen bg-black flex items-center justify-center\">\r\n            <div className=\"text-white\">Loading...</div>\r\n          </div>\r\n        </RequireAuth>\r\n      </BanCheck>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <BanCheck>\r\n      <RequireAuth role=\"seller\">\r\n        {/* Top Padding */}\r\n        <div className=\"py-3 bg-black\" />\r\n\r\n        <div className=\"h-screen bg-black flex flex-col overflow-hidden\">\r\n          <div className=\"flex-1 flex flex-col md:flex-row max-w-6xl mx-auto w-full bg-[#121212] rounded-lg shadow-lg overflow-hidden\">\r\n            {/* Left column - Message threads */}\r\n            <ThreadsSidebar\r\n              isAdmin={isAdmin}\r\n              threads={threads}\r\n              lastMessages={lastMessages}\r\n              buyerProfiles={buyerProfiles}\r\n              totalUnreadCount={totalUnreadCount}\r\n              uiUnreadCounts={uiUnreadCounts}\r\n              activeThread={activeThread}\r\n              setActiveThread={setActiveThread}\r\n              searchQuery={searchQuery}\r\n              setSearchQuery={setSearchQuery}\r\n              filterBy={filterBy}\r\n              setFilterBy={setFilterBy}\r\n              setObserverReadMessages={setObserverReadMessages}\r\n            />\r\n\r\n            {/* Right column - Active conversation */}\r\n            <div className=\"w-full md:w-2/3 flex flex-col bg-[#121212]\">\r\n              {activeThread ? (\r\n                <ConversationView\r\n                  activeThread={activeThread}\r\n                  threads={threads}\r\n                  buyerProfiles={buyerProfiles}\r\n                  sellerRequests={sellerRequests}\r\n                  isUserBlocked={isUserBlocked}\r\n                  isUserReported={isUserReported}\r\n                  handleReport={handleReport}\r\n                  handleBlockToggle={handleBlockToggle}\r\n                  user={user}\r\n                  messageInputControls={{\r\n                    replyMessage,\r\n                    setReplyMessage,\r\n                    selectedImage,\r\n                    setSelectedImage,\r\n                    isImageLoading,\r\n                    setIsImageLoading,\r\n                    imageError,\r\n                    setImageError,\r\n                    showEmojiPicker,\r\n                    setShowEmojiPicker,\r\n                    recentEmojis,\r\n                    handleReply,\r\n                    handleEmojiClick,\r\n                    handleImageSelect,\r\n                  }}\r\n                  editRequestControls={{\r\n                    editRequestId,\r\n                    setEditRequestId,\r\n                    editPrice,\r\n                    setEditPrice,\r\n                    editTitle,\r\n                    setEditTitle,\r\n                    editMessage,\r\n                    setEditMessage,\r\n                    handleEditSubmit,\r\n                  }}\r\n                  handleAccept={handleAccept}\r\n                  handleDecline={handleDecline}\r\n                  handleEditRequest={handleEditRequest}\r\n                  handleMessageVisible={handleMessageVisible}\r\n                  setPreviewImage={setPreviewImage}\r\n                />\r\n              ) : (\r\n                <EmptyState />\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Bottom Padding */}\r\n          <div className=\"py-6 bg-black\" />\r\n\r\n          {/* Image Preview Modal */}\r\n          {previewImage && (\r\n            <ImagePreviewModal\r\n              imageUrl={previewImage}\r\n              isOpen={true}\r\n              onClose={() => setPreviewImage(null)}\r\n            />\r\n          )}\r\n        </div>\r\n      </RequireAuth>\r\n    </BanCheck>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA,oCAAoC;;;;;AAIpC;AACA;AACA;AACA;AACA;AACA;AACA;;;AATA;;;;;;;;AAWe,SAAS;;IACtB,MAAM,EACJ,OAAO;IACP,IAAI,EACJ,OAAO,EAEP,qBAAqB;IACrB,OAAO,EACP,YAAY,EACZ,cAAc,EACd,YAAY,EACZ,aAAa,EACb,gBAAgB,EAChB,YAAY,EACZ,eAAe,EAEf,WAAW;IACX,YAAY,EACZ,eAAe,EACf,WAAW,EACX,cAAc,EACd,QAAQ,EACR,WAAW,EACX,oBAAoB,EACpB,uBAAuB,EAEvB,gBAAgB;IAChB,YAAY,EACZ,eAAe,EACf,aAAa,EACb,gBAAgB,EAChB,cAAc,EACd,iBAAiB,EACjB,UAAU,EACV,aAAa,EACb,eAAe,EACf,kBAAkB,EAClB,YAAY,EAEZ,kBAAkB;IAClB,cAAc,EACd,aAAa,EACb,gBAAgB,EAChB,SAAS,EACT,YAAY,EACZ,SAAS,EACT,YAAY,EACZ,WAAW,EACX,cAAc,EAEd,UAAU;IACV,WAAW,EACX,iBAAiB,EACjB,YAAY,EACZ,YAAY,EACZ,aAAa,EACb,iBAAiB,EACjB,gBAAgB,EAChB,iBAAiB,EACjB,oBAAoB,EACpB,gBAAgB,EAEhB,SAAS;IACT,aAAa,EACb,cAAc,EACf,GAAG,CAAA,GAAA,oIAAA,CAAA,oBAAiB,AAAD;IAEpB,IAAI,CAAC,MAAM;QACT,qBACE,6LAAC,iIAAA,CAAA,UAAQ;sBACP,cAAA,6LAAC,oIAAA,CAAA,UAAW;gBAAC,MAAK;0BAChB,cAAA,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAI,WAAU;kCAAa;;;;;;;;;;;;;;;;;;;;;IAKtC;IAEA,qBACE,6LAAC,iIAAA,CAAA,UAAQ;kBACP,cAAA,6LAAC,oIAAA,CAAA,UAAW;YAAC,MAAK;;8BAEhB,6LAAC;oBAAI,WAAU;;;;;;8BAEf,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;;8CAEb,6LAAC,6JAAA,CAAA,UAAc;oCACb,SAAS;oCACT,SAAS;oCACT,cAAc;oCACd,eAAe;oCACf,kBAAkB;oCAClB,gBAAgB;oCAChB,cAAc;oCACd,iBAAiB;oCACjB,aAAa;oCACb,gBAAgB;oCAChB,UAAU;oCACV,aAAa;oCACb,yBAAyB;;;;;;8CAI3B,6LAAC;oCAAI,WAAU;8CACZ,6BACC,6LAAC,+JAAA,CAAA,UAAgB;wCACf,cAAc;wCACd,SAAS;wCACT,eAAe;wCACf,gBAAgB;wCAChB,eAAe;wCACf,gBAAgB;wCAChB,cAAc;wCACd,mBAAmB;wCACnB,MAAM;wCACN,sBAAsB;4CACpB;4CACA;4CACA;4CACA;4CACA;4CACA;4CACA;4CACA;4CACA;4CACA;4CACA;4CACA;4CACA;4CACA;wCACF;wCACA,qBAAqB;4CACnB;4CACA;4CACA;4CACA;4CACA;4CACA;4CACA;4CACA;4CACA;wCACF;wCACA,cAAc;wCACd,eAAe;wCACf,mBAAmB;wCACnB,sBAAsB;wCACtB,iBAAiB;;;;;6DAGnB,6LAAC,yJAAA,CAAA,UAAU;;;;;;;;;;;;;;;;sCAMjB,6LAAC;4BAAI,WAAU;;;;;;wBAGd,8BACC,6LAAC,uJAAA,CAAA,UAAiB;4BAChB,UAAU;4BACV,QAAQ;4BACR,SAAS,IAAM,gBAAgB;;;;;;;;;;;;;;;;;;;;;;;AAO7C;GA3KwB;;QAiElB,oIAAA,CAAA,oBAAiB;;;KAjEC","debugId":null}}]
}