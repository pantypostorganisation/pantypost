{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gerom/OneDrive/Documents/pantypost/src/components/RequireAuth.tsx"],"sourcesContent":["// src/components/RequireAuth.tsx\r\n'use client';\r\n\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useEffect, useState } from 'react';\r\nimport { z } from 'zod';\r\n\r\nconst VALID_ROLES = ['buyer', 'seller', 'admin'] as const;\r\ntype ValidRole = (typeof VALID_ROLES)[number];\r\n\r\nconst RoleSchema = z.enum(VALID_ROLES);\r\n\r\nexport default function RequireAuth({\r\n  role,\r\n  children,\r\n}: {\r\n  role: ValidRole;\r\n  children: React.ReactNode;\r\n}) {\r\n  const { user, isAuthReady } = useAuth();\r\n  const router = useRouter();\r\n  const [authorized, setAuthorized] = useState(false);\r\n  const [hasChecked, setHasChecked] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!isAuthReady || hasChecked) return;\r\n\r\n    // Runtime validation of `role` prop (dev-only noise)\r\n    const parsed = RoleSchema.safeParse(role);\r\n    if (!parsed.success) {\r\n      if (process.env.NODE_ENV === 'development') {\r\n        console.warn('[RequireAuth] Invalid role prop supplied:', role);\r\n      }\r\n      router.push('/login');\r\n      setHasChecked(true);\r\n      return;\r\n    }\r\n\r\n    const userRole = user?.role as ValidRole | undefined;\r\n\r\n    // NEW: strict role matching ‚Äî no admin override for buyer/seller routes\r\n    let hasAccess = false;\r\n    if (parsed.data === 'admin') {\r\n      hasAccess = userRole === 'admin';\r\n    } else {\r\n      hasAccess = userRole === parsed.data; // admin can‚Äôt view buyer/seller pages\r\n    }\r\n\r\n    if (!user || !hasAccess) {\r\n      router.push('/login');\r\n    } else {\r\n      setAuthorized(true);\r\n    }\r\n\r\n    setHasChecked(true);\r\n  }, [isAuthReady, user, role, router, hasChecked]);\r\n\r\n  if (!isAuthReady || !hasChecked) {\r\n    return (\r\n      <div className=\"min-h-screen bg-black flex items-center justify-center\" role=\"status\" aria-label=\"Checking access\">\r\n        <div className=\"flex items-center space-x-2\">\r\n          <div className=\"w-4 h-4 bg-[#ff950e] rounded-full animate-pulse\" />\r\n          <div className=\"w-4 h-4 bg-[#ff950e] rounded-full animate-pulse\" style={{ animationDelay: '0.2s' }} />\r\n          <div className=\"w-4 h-4 bg-[#ff950e] rounded-full animate-pulse\" style={{ animationDelay: '0.4s' }} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!authorized) return null;\r\n\r\n  return <>{children}</>;\r\n}\r\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;;AAGjC;AACA;AACA;AACA;AALA;;;;;;AAOA,MAAM,cAAc;IAAC;IAAS;IAAU;CAAQ;AAGhD,MAAM,aAAa,kKAAA,CAAA,IAAC,CAAC,IAAI,CAAC;AAEX,SAAS,YAAY,EAClC,IAAI,EACJ,QAAQ,EAIT;IACC,MAAM,EAAE,IAAI,EAAE,WAAW,EAAE,GAAG,CAAA,GAAA,8HAAA,CAAA,UAAO,AAAD;IACpC,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC7C,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAE7C,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,CAAC,eAAe,YAAY;QAEhC,qDAAqD;QACrD,MAAM,SAAS,WAAW,SAAS,CAAC;QACpC,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,wCAA4C;gBAC1C,QAAQ,IAAI,CAAC,6CAA6C;YAC5D;YACA,OAAO,IAAI,CAAC;YACZ,cAAc;YACd;QACF;QAEA,MAAM,WAAW,MAAM;QAEvB,wEAAwE;QACxE,IAAI,YAAY;QAChB,IAAI,OAAO,IAAI,KAAK,SAAS;YAC3B,YAAY,aAAa;QAC3B,OAAO;YACL,YAAY,aAAa,OAAO,IAAI,EAAE,sCAAsC;QAC9E;QAEA,IAAI,CAAC,QAAQ,CAAC,WAAW;YACvB,OAAO,IAAI,CAAC;QACd,OAAO;YACL,cAAc;QAChB;QAEA,cAAc;IAChB,GAAG;QAAC;QAAa;QAAM;QAAM;QAAQ;KAAW;IAEhD,IAAI,CAAC,eAAe,CAAC,YAAY;QAC/B,qBACE,8OAAC;YAAI,WAAU;YAAyD,MAAK;YAAS,cAAW;sBAC/F,cAAA,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;;;;;kCACf,8OAAC;wBAAI,WAAU;wBAAkD,OAAO;4BAAE,gBAAgB;wBAAO;;;;;;kCACjG,8OAAC;wBAAI,WAAU;wBAAkD,OAAO;4BAAE,gBAAgB;wBAAO;;;;;;;;;;;;;;;;;IAIzG;IAEA,IAAI,CAAC,YAAY,OAAO;IAExB,qBAAO;kBAAG;;AACZ","debugId":null}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gerom/OneDrive/Documents/pantypost/src/hooks/useAdminMessages.ts"],"sourcesContent":["import { useState, useEffect, useMemo, useRef, useCallback } from 'react';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useListings } from '@/context/ListingContext';\r\nimport { useMessages } from '@/context/MessageContext';\r\nimport { storageService } from '@/services';\r\nimport { Message } from '@/types/message';\r\nimport { sanitize } from '@/services/security.service';\r\nimport { getRateLimiter, RATE_LIMITS } from '@/utils/security/rate-limiter';\r\n\r\nexport const useAdminMessages = () => {\r\n  const { user } = useAuth();\r\n  const { users } = useListings();\r\n  const { \r\n    messages, \r\n    sendMessage, \r\n    markMessagesAsRead, \r\n    blockUser, \r\n    unblockUser, \r\n    reportUser, \r\n    isBlocked, \r\n    hasReported,\r\n    getThreadsForUser,\r\n    getAllThreadsInfo\r\n  } = useMessages();\r\n  \r\n  const [selectedUser, setSelectedUser] = useState<string>('');\r\n  const [content, setContent] = useState<string>('');\r\n  const [activeThread, setActiveThread] = useState<string | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [selectedImage, setSelectedImage] = useState<string | null>(null);\r\n  const [filterBy, setFilterBy] = useState<'all' | 'buyers' | 'sellers'>('all');\r\n  const [viewsData, setViewsData] = useState<Record<string, number>>({});\r\n  const [messageUpdate, setMessageUpdate] = useState(0);\r\n  const [showUserDirectory, setShowUserDirectory] = useState(false);\r\n  const [directorySearchQuery, setDirectorySearchQuery] = useState('');\r\n  const [rateLimitError, setRateLimitError] = useState<string | null>(null);\r\n  \r\n  const readThreadsRef = useRef<Set<string>>(new Set());\r\n  const rateLimiter = getRateLimiter();\r\n  \r\n  const isAdmin = !!user && user.role === 'admin';\r\n  const username = user?.username || '';\r\n\r\n  // Load views data with error handling\r\n  const loadViews = useCallback(async () => {\r\n    try {\r\n      if (typeof window !== 'undefined') {\r\n        const data = await storageService.getItem<Record<string, number>>('listing_views', {});\r\n        setViewsData(data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load views data:', error);\r\n      setViewsData({});\r\n    }\r\n  }, []);\r\n\r\n  // Load views and handle localStorage events\r\n  useEffect(() => {\r\n    loadViews();\r\n    \r\n    const handleStorageChange = () => loadViews();\r\n    \r\n    window.addEventListener('storage', handleStorageChange);\r\n    window.addEventListener('focus', handleStorageChange);\r\n    \r\n    return () => {\r\n      window.removeEventListener('storage', handleStorageChange);\r\n      window.removeEventListener('focus', handleStorageChange);\r\n    };\r\n  }, [loadViews]);\r\n\r\n  // Load previously read threads\r\n  useEffect(() => {\r\n    const loadReadThreads = async () => {\r\n      try {\r\n        if (user) {\r\n          const readThreadsKey = `panty_read_threads_${user.username}`;\r\n          const readThreads = await storageService.getItem<string[]>(readThreadsKey, []);\r\n          if (Array.isArray(readThreads)) {\r\n            readThreadsRef.current = new Set(readThreads);\r\n            setMessageUpdate(prev => prev + 1);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Failed to load read threads:', error);\r\n      }\r\n    };\r\n    \r\n    loadReadThreads();\r\n  }, [user]);\r\n\r\n  // UPDATED: Use new helper functions from MessageContext\r\n  const { threads, unreadCounts, lastMessages, userProfiles, activeMessages, totalUnreadCount } = useMemo(() => {\r\n    if (!user) return { \r\n      threads: {}, \r\n      unreadCounts: {}, \r\n      lastMessages: {}, \r\n      userProfiles: {}, \r\n      activeMessages: [],\r\n      totalUnreadCount: 0 \r\n    };\r\n    \r\n    // Use the new helper functions (no role filter for admin - sees all)\r\n    const threads = getThreadsForUser(user.username);\r\n    const threadInfos = getAllThreadsInfo(user.username);\r\n    \r\n    const unreadCounts: { [userKey: string]: number } = {};\r\n    const lastMessages: { [userKey: string]: Message } = {};\r\n    const userProfiles: { [userKey: string]: { pic: string | null, verified: boolean, role: string } } = {};\r\n    let totalUnreadCount = 0;\r\n    \r\n    Object.entries(threadInfos).forEach(([userKey, info]) => {\r\n      unreadCounts[userKey] = info.unreadCount;\r\n      lastMessages[userKey] = info.lastMessage as Message;\r\n      \r\n      // Get user profile picture and verification status\r\n      try {\r\n        const userInfo = users?.[userKey];\r\n        const isVerified = userInfo?.verified || userInfo?.verificationStatus === 'verified';\r\n        const role = userInfo?.role || 'unknown';\r\n        \r\n        userProfiles[userKey] = { \r\n          pic: null,\r\n          verified: isVerified,\r\n          role: role\r\n        };\r\n      } catch (error) {\r\n        console.error(`Error processing user profile for ${userKey}:`, error);\r\n        userProfiles[userKey] = { pic: null, verified: false, role: 'unknown' };\r\n      }\r\n      \r\n      // Only add to total if not in readThreadsRef\r\n      if (!readThreadsRef.current.has(userKey) && info.unreadCount > 0) {\r\n        totalUnreadCount += 1;\r\n      }\r\n    });\r\n    \r\n    // Get active messages\r\n    let activeMessages: Message[] = [];\r\n    if (activeThread) {\r\n      activeMessages = threads[activeThread] || [];\r\n    }\r\n\r\n    return { threads, unreadCounts, lastMessages, userProfiles, activeMessages, totalUnreadCount };\r\n  }, [user, messages, activeThread, users, messageUpdate, getThreadsForUser, getAllThreadsInfo]);\r\n\r\n  // Get all users for directory (exclude the current admin and any admin accounts)\r\n  const allUsers = useMemo(() => {\r\n    const allUsersList = Object.entries(users || {})\r\n      .filter(([uname, userInfo]) => \r\n        uname !== user?.username && // Exclude current admin user\r\n        userInfo?.role !== 'admin'    // Exclude any admin accounts\r\n      )\r\n      .map(([uname, userInfo]) => {\r\n        const isVerified = userInfo?.verified || userInfo?.verificationStatus === 'verified';\r\n        \r\n        return {\r\n          username: uname,\r\n          role: userInfo?.role || 'unknown',\r\n          verified: isVerified,\r\n          pic: null // Profile pics should be loaded through proper channels\r\n        };\r\n      });\r\n    \r\n    return allUsersList;\r\n  }, [users, user]);\r\n\r\n  // Mark messages as read when thread is selected\r\n  useEffect(() => {\r\n    const markThreadAsRead = async () => {\r\n      if (activeThread && user) {\r\n        const hasUnreadMessages = threads[activeThread]?.some(\r\n          msg => !msg.read && msg.sender === activeThread && msg.receiver === user.username\r\n        );\r\n        \r\n        if (hasUnreadMessages) {\r\n          markMessagesAsRead(user.username, activeThread);\r\n          \r\n          if (!readThreadsRef.current.has(activeThread)) {\r\n            readThreadsRef.current.add(activeThread);\r\n            \r\n            if (typeof window !== 'undefined') {\r\n              const readThreadsKey = `panty_read_threads_${user.username}`;\r\n              await storageService.setItem(readThreadsKey, Array.from(readThreadsRef.current));\r\n              \r\n              const event = new CustomEvent('readThreadsUpdated', { \r\n                detail: { threads: Array.from(readThreadsRef.current), username: user.username }\r\n              });\r\n              window.dispatchEvent(event);\r\n            }\r\n            \r\n            setMessageUpdate(prev => prev + 1);\r\n          }\r\n        }\r\n        \r\n        if (typeof window !== 'undefined') {\r\n          const event = new CustomEvent('threadSelected', { \r\n            detail: { thread: activeThread, username: user.username }\r\n          });\r\n          window.dispatchEvent(event);\r\n        }\r\n      }\r\n    };\r\n    \r\n    markThreadAsRead();\r\n  }, [activeThread, user, threads, markMessagesAsRead]);\r\n\r\n  // Save read threads to localStorage\r\n  useEffect(() => {\r\n    const saveReadThreads = async () => {\r\n      if (user && readThreadsRef.current.size > 0 && typeof window !== 'undefined') {\r\n        const readThreadsKey = `panty_read_threads_${user.username}`;\r\n        const threadsArray = Array.from(readThreadsRef.current);\r\n        await storageService.setItem(readThreadsKey, threadsArray);\r\n        \r\n        const event = new CustomEvent('readThreadsUpdated', { \r\n          detail: { threads: threadsArray, username: user.username }\r\n        });\r\n        window.dispatchEvent(event);\r\n      }\r\n    };\r\n    \r\n    saveReadThreads();\r\n  }, [messageUpdate, user]);\r\n\r\n  const handleSend = useCallback(() => {\r\n    if (!activeThread || (!content.trim() && !selectedImage)) {\r\n      alert('Please enter a message.');\r\n      return;\r\n    }\r\n\r\n    // Clear rate limit error\r\n    setRateLimitError(null);\r\n\r\n    // Check rate limit\r\n    const rateLimitResult = rateLimiter.check('MESSAGE_SEND', RATE_LIMITS.MESSAGE_SEND);\r\n    if (!rateLimitResult.allowed) {\r\n      setRateLimitError(`Too many messages sent. Please wait ${rateLimitResult.waitTime} seconds.`);\r\n      return;\r\n    }\r\n\r\n    // Sanitize message content\r\n    const sanitizedContent = sanitize.strict(content.trim());\r\n\r\n    // Validate image URL if provided\r\n    if (selectedImage) {\r\n      const sanitizedImageUrl = sanitize.url(selectedImage);\r\n      if (!sanitizedImageUrl) {\r\n        alert('Invalid image URL');\r\n        return;\r\n      }\r\n    }\r\n\r\n    sendMessage(username, activeThread, sanitizedContent, {\r\n      type: selectedImage ? 'image' : 'normal',\r\n      meta: selectedImage ? { imageUrl: selectedImage } : undefined,\r\n    });\r\n    \r\n    setContent('');\r\n    setSelectedImage(null);\r\n  }, [activeThread, content, selectedImage, username, sendMessage, rateLimiter]);\r\n\r\n  const handleBlockToggle = useCallback(() => {\r\n    if (!activeThread) return;\r\n    \r\n    // Rate limit block/unblock actions\r\n    const rateLimitResult = rateLimiter.check('REPORT_ACTION', RATE_LIMITS.REPORT_ACTION);\r\n    if (!rateLimitResult.allowed) {\r\n      alert(`Please wait ${rateLimitResult.waitTime} seconds before performing this action.`);\r\n      return;\r\n    }\r\n\r\n    if (isBlocked(username, activeThread)) {\r\n      unblockUser(username, activeThread);\r\n    } else {\r\n      blockUser(username, activeThread);\r\n    }\r\n  }, [activeThread, username, isBlocked, unblockUser, blockUser, rateLimiter]);\r\n\r\n  const handleReport = useCallback(() => {\r\n    if (activeThread && !hasReported(username, activeThread)) {\r\n      // Rate limit report actions\r\n      const rateLimitResult = rateLimiter.check('REPORT_ACTION', RATE_LIMITS.REPORT_ACTION);\r\n      if (!rateLimitResult.allowed) {\r\n        alert(`Please wait ${rateLimitResult.waitTime} seconds before reporting.`);\r\n        return;\r\n      }\r\n      \r\n      reportUser(username, activeThread);\r\n    }\r\n  }, [activeThread, username, hasReported, reportUser, rateLimiter]);\r\n\r\n  const handleThreadSelect = useCallback((userId: string) => {\r\n    // Sanitize username\r\n    const sanitizedUserId = sanitize.username(userId);\r\n    \r\n    if (activeThread === sanitizedUserId) return;\r\n    setActiveThread(sanitizedUserId);\r\n    setShowUserDirectory(false);\r\n  }, [activeThread]);\r\n\r\n  const handleStartConversation = useCallback((targetUsername: string) => {\r\n    // Sanitize username\r\n    const sanitizedUsername = sanitize.username(targetUsername);\r\n    \r\n    setActiveThread(sanitizedUsername);\r\n    setShowUserDirectory(false);\r\n  }, []);\r\n\r\n  // Create enhanced search setters that sanitize input\r\n  const setSearchQuerySafe = useCallback((value: string | ((prev: string) => string)) => {\r\n    if (typeof value === 'function') {\r\n      setSearchQuery(prev => {\r\n        const newValue = value(prev);\r\n        return sanitize.searchQuery(newValue);\r\n      });\r\n    } else {\r\n      setSearchQuery(sanitize.searchQuery(value));\r\n    }\r\n  }, []);\r\n\r\n  const setDirectorySearchQuerySafe = useCallback((value: string | ((prev: string) => string)) => {\r\n    if (typeof value === 'function') {\r\n      setDirectorySearchQuery(prev => {\r\n        const newValue = value(prev);\r\n        return sanitize.searchQuery(newValue);\r\n      });\r\n    } else {\r\n      setDirectorySearchQuery(sanitize.searchQuery(value));\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (selectedUser && !activeThread) {\r\n      const sanitizedUser = sanitize.username(selectedUser);\r\n      setActiveThread(sanitizedUser);\r\n    }\r\n  }, [selectedUser, activeThread]);\r\n\r\n  const isUserBlocked = !!(activeThread && isBlocked(username, activeThread));\r\n  const isUserReported = !!(activeThread && hasReported(username, activeThread));\r\n\r\n  return {\r\n    // Auth & Users\r\n    user,\r\n    isAdmin,\r\n    username,\r\n    allUsers,\r\n    \r\n    // Messages & Threads\r\n    threads,\r\n    unreadCounts,\r\n    lastMessages,\r\n    userProfiles,\r\n    activeMessages,\r\n    totalUnreadCount,\r\n    \r\n    // State\r\n    selectedUser,\r\n    setSelectedUser,\r\n    content,\r\n    setContent, // Keep the original setter for compatibility\r\n    activeThread,\r\n    setActiveThread,\r\n    searchQuery,\r\n    setSearchQuery: setSearchQuerySafe, // Use the safe setter\r\n    selectedImage,\r\n    setSelectedImage,\r\n    filterBy,\r\n    setFilterBy,\r\n    showUserDirectory,\r\n    setShowUserDirectory,\r\n    directorySearchQuery,\r\n    setDirectorySearchQuery: setDirectorySearchQuerySafe, // Use the safe setter\r\n    \r\n    // Computed\r\n    isUserBlocked,\r\n    isUserReported,\r\n    \r\n    // Handlers\r\n    handleSend,\r\n    handleBlockToggle,\r\n    handleReport,\r\n    handleThreadSelect,\r\n    handleStartConversation,\r\n    \r\n    // Other\r\n    viewsData,\r\n    messageUpdate,\r\n    rateLimitError\r\n  };\r\n};\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 493, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gerom/OneDrive/Documents/pantypost/src/components/admin/messages/MessagesHeader.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { MessageCircle, Filter, User, BellRing, Users, Search } from 'lucide-react';\r\nimport { SecureInput } from '@/components/ui/SecureInput';\r\nimport { sanitizeSearchQuery } from '@/utils/security/sanitization';\r\n\r\ninterface MessagesHeaderProps {\r\n  filterBy: 'all' | 'buyers' | 'sellers';\r\n  setFilterBy: (filter: 'all' | 'buyers' | 'sellers') => void;\r\n  totalUnreadCount: number;\r\n  showUserDirectory: boolean;\r\n  setShowUserDirectory: (show: boolean) => void;\r\n  searchQuery: string;\r\n  setSearchQuery: (query: string) => void;\r\n  directorySearchQuery: string;\r\n  setDirectorySearchQuery: (query: string) => void;\r\n}\r\n\r\nexport default function MessagesHeader({\r\n  filterBy,\r\n  setFilterBy,\r\n  totalUnreadCount,\r\n  showUserDirectory,\r\n  setShowUserDirectory,\r\n  searchQuery,\r\n  setSearchQuery,\r\n  directorySearchQuery,\r\n  setDirectorySearchQuery\r\n}: MessagesHeaderProps) {\r\n  const handleSearchChange = (value: string) => {\r\n    const sanitized = sanitizeSearchQuery(value);\r\n    if (showUserDirectory) setDirectorySearchQuery(sanitized);\r\n    else setSearchQuery(sanitized);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"px-4 pt-4 pb-2\">\r\n        <h2 className=\"text-2xl font-bold text-[#ff950e] mb-2 flex items-center\">\r\n          <MessageCircle size={24} className=\"mr-2 text-[#ff950e]\" />\r\n          Admin Messages\r\n        </h2>\r\n        <div className=\"flex space-x-2 mb-3\" role=\"tablist\" aria-label=\"User role filter\">\r\n          <button\r\n            onClick={() => setFilterBy('all')}\r\n            className={`px-4 py-2 rounded-full text-sm font-medium transition flex items-center ${\r\n              filterBy === 'all' ? 'bg-[#ff950e] text-black' : 'bg-[#1a1a1a] text-white hover:bg-[#222]'\r\n            }`}\r\n            role=\"tab\"\r\n            aria-selected={filterBy === 'all'}\r\n          >\r\n            <Filter size={14} className=\"mr-1\" />\r\n            All Users\r\n          </button>\r\n          <button\r\n            onClick={() => setFilterBy('buyers')}\r\n            className={`px-4 py-2 rounded-full text-sm font-medium transition flex items-center ${\r\n              filterBy === 'buyers' ? 'bg-[#ff950e] text-black' : 'bg-[#1a1a1a] text-white hover:bg-[#222]'\r\n            }`}\r\n            role=\"tab\"\r\n            aria-selected={filterBy === 'buyers'}\r\n          >\r\n            <User size={14} className=\"mr-1\" />\r\n            Buyers\r\n          </button>\r\n          <button\r\n            onClick={() => setFilterBy('sellers')}\r\n            className={`px-4 py-2 rounded-full text-sm font-medium transition flex items-center ${\r\n              filterBy === 'sellers' ? 'bg-[#ff950e] text-black' : 'bg-[#1a1a1a] text-white hover:bg-[#222]'\r\n            }`}\r\n            role=\"tab\"\r\n            aria-selected={filterBy === 'sellers'}\r\n          >\r\n            <BellRing size={14} className=\"mr-1\" />\r\n            Sellers\r\n            {totalUnreadCount > 0 && (\r\n              <span className=\"ml-1 bg-[#ff950e] text-black rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold border border-black\">\r\n                {totalUnreadCount}\r\n              </span>\r\n            )}\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"flex space-x-1 mb-3 bg-[#222] p-1 rounded-lg\" role=\"tablist\" aria-label=\"View toggle\">\r\n          <button\r\n            onClick={() => setShowUserDirectory(false)}\r\n            className={`flex-1 px-3 py-2 rounded-md text-sm font-medium transition-all ${\r\n              !showUserDirectory ? 'bg-[#ff950e] text-black shadow-lg' : 'text-gray-300 hover:text-white hover:bg-[#333]'\r\n            }`}\r\n            role=\"tab\"\r\n            aria-selected={!showUserDirectory}\r\n          >\r\n            <MessageCircle size={16} className=\"mr-2 inline\" />\r\n            Conversations\r\n          </button>\r\n          <button\r\n            onClick={() => setShowUserDirectory(true)}\r\n            className={`flex-1 px-3 py-2 rounded-md text-sm font-medium transition-all ${\r\n              showUserDirectory ? 'bg-[#ff950e] text-black shadow-lg' : 'text-gray-300 hover:text-white hover:bg-[#333]'\r\n            }`}\r\n            role=\"tab\"\r\n            aria-selected={showUserDirectory}\r\n          >\r\n            <Users size={16} className=\"mr-2 inline\" />\r\n            All Users\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"px-4 pb-3\">\r\n        <div className=\"relative\">\r\n          <SecureInput\r\n            type=\"text\"\r\n            placeholder={showUserDirectory ? 'Search all users...' : 'Search conversations...'}\r\n            value={showUserDirectory ? directorySearchQuery : searchQuery}\r\n            onChange={handleSearchChange}\r\n            className=\"w-full py-2 px-4 pr-10 rounded-full bg-[#222] border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-[#ff950e] focus:border-transparent\"\r\n            maxLength={100}\r\n            sanitize\r\n            sanitizer={sanitizeSearchQuery}\r\n            aria-label=\"Search\"\r\n          />\r\n          <div className=\"absolute right-3 top-3 text-gray-400 z-10\">\r\n            <Search size={18} />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAJA;;;;;AAkBe,SAAS,eAAe,EACrC,QAAQ,EACR,WAAW,EACX,gBAAgB,EAChB,iBAAiB,EACjB,oBAAoB,EACpB,WAAW,EACX,cAAc,EACd,oBAAoB,EACpB,uBAAuB,EACH;IACpB,MAAM,qBAAqB,CAAC;QAC1B,MAAM,YAAY,CAAA,GAAA,wIAAA,CAAA,sBAAmB,AAAD,EAAE;QACtC,IAAI,mBAAmB,wBAAwB;aAC1C,eAAe;IACtB;IAEA,qBACE;;0BACE,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;;0CACZ,8OAAC,wNAAA,CAAA,gBAAa;gCAAC,MAAM;gCAAI,WAAU;;;;;;4BAAwB;;;;;;;kCAG7D,8OAAC;wBAAI,WAAU;wBAAsB,MAAK;wBAAU,cAAW;;0CAC7D,8OAAC;gCACC,SAAS,IAAM,YAAY;gCAC3B,WAAW,CAAC,wEAAwE,EAClF,aAAa,QAAQ,4BAA4B,2CACjD;gCACF,MAAK;gCACL,iBAAe,aAAa;;kDAE5B,8OAAC,sMAAA,CAAA,SAAM;wCAAC,MAAM;wCAAI,WAAU;;;;;;oCAAS;;;;;;;0CAGvC,8OAAC;gCACC,SAAS,IAAM,YAAY;gCAC3B,WAAW,CAAC,wEAAwE,EAClF,aAAa,WAAW,4BAA4B,2CACpD;gCACF,MAAK;gCACL,iBAAe,aAAa;;kDAE5B,8OAAC,kMAAA,CAAA,OAAI;wCAAC,MAAM;wCAAI,WAAU;;;;;;oCAAS;;;;;;;0CAGrC,8OAAC;gCACC,SAAS,IAAM,YAAY;gCAC3B,WAAW,CAAC,wEAAwE,EAClF,aAAa,YAAY,4BAA4B,2CACrD;gCACF,MAAK;gCACL,iBAAe,aAAa;;kDAE5B,8OAAC,8MAAA,CAAA,WAAQ;wCAAC,MAAM;wCAAI,WAAU;;;;;;oCAAS;oCAEtC,mBAAmB,mBAClB,8OAAC;wCAAK,WAAU;kDACb;;;;;;;;;;;;;;;;;;kCAMT,8OAAC;wBAAI,WAAU;wBAA+C,MAAK;wBAAU,cAAW;;0CACtF,8OAAC;gCACC,SAAS,IAAM,qBAAqB;gCACpC,WAAW,CAAC,+DAA+D,EACzE,CAAC,oBAAoB,sCAAsC,kDAC3D;gCACF,MAAK;gCACL,iBAAe,CAAC;;kDAEhB,8OAAC,wNAAA,CAAA,gBAAa;wCAAC,MAAM;wCAAI,WAAU;;;;;;oCAAgB;;;;;;;0CAGrD,8OAAC;gCACC,SAAS,IAAM,qBAAqB;gCACpC,WAAW,CAAC,+DAA+D,EACzE,oBAAoB,sCAAsC,kDAC1D;gCACF,MAAK;gCACL,iBAAe;;kDAEf,8OAAC,oMAAA,CAAA,QAAK;wCAAC,MAAM;wCAAI,WAAU;;;;;;oCAAgB;;;;;;;;;;;;;;;;;;;0BAMjD,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC,uIAAA,CAAA,cAAW;4BACV,MAAK;4BACL,aAAa,oBAAoB,wBAAwB;4BACzD,OAAO,oBAAoB,uBAAuB;4BAClD,UAAU;4BACV,WAAU;4BACV,WAAW;4BACX,QAAQ;4BACR,WAAW,wIAAA,CAAA,sBAAmB;4BAC9B,cAAW;;;;;;sCAEb,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC,sMAAA,CAAA,SAAM;gCAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;;AAM1B","debugId":null}},
    {"offset": {"line": 732, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gerom/OneDrive/Documents/pantypost/src/components/admin/messages/ConversationsContent.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useMemo } from 'react';\r\nimport { MessageCircle, Clock } from 'lucide-react';\r\nimport { Message } from '@/types/message';\r\nimport { sanitizeSearchQuery, sanitizeUrl } from '@/utils/security/sanitization';\r\nimport { SecureMessageDisplay } from '@/components/ui/SecureMessageDisplay';\r\n\r\ninterface ConversationsContentProps {\r\n  threads: { [user: string]: Message[] };\r\n  lastMessages: { [user: string]: Message };\r\n  unreadCounts: { [user: string]: number };\r\n  userProfiles: { [user: string]: { pic: string | null; verified: boolean; role: string } };\r\n  activeThread: string | null;\r\n  searchQuery: string;\r\n  filterBy: 'all' | 'buyers' | 'sellers';\r\n  onThreadSelect: (userId: string) => void;\r\n  onStartNewConversation: () => void;\r\n}\r\n\r\nexport default function ConversationsContent({\r\n  threads,\r\n  lastMessages,\r\n  unreadCounts,\r\n  userProfiles,\r\n  activeThread,\r\n  searchQuery,\r\n  filterBy,\r\n  onThreadSelect,\r\n  onStartNewConversation\r\n}: ConversationsContentProps) {\r\n  const getInitial = (username: string) => (username ? username.charAt(0).toUpperCase() : '?');\r\n\r\n  const formatTimeAgo = (date: string) => {\r\n    const now = new Date().getTime();\r\n    const then = new Date(date).getTime();\r\n    const diffMs = Math.max(0, now - then);\r\n\r\n    const d = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n    if (d > 0) return d === 1 ? '1d ago' : `${d}d ago`;\r\n\r\n    const h = Math.floor(diffMs / (1000 * 60 * 60));\r\n    if (h > 0) return h === 1 ? '1h ago' : `${h}h ago`;\r\n\r\n    const m = Math.floor(diffMs / (1000 * 60));\r\n    if (m > 0) return m === 1 ? '1m ago' : `${m}m ago`;\r\n\r\n    return 'Just now';\r\n  };\r\n\r\n  const filteredAndSortedThreads = useMemo(() => {\r\n    const sanitizedSearch = searchQuery ? sanitizeSearchQuery(searchQuery).toLowerCase() : '';\r\n\r\n    const filtered = Object.keys(threads).filter((userKey) => {\r\n      const matchesSearch = sanitizedSearch ? userKey.toLowerCase().includes(sanitizedSearch) : true;\r\n      if (!matchesSearch) return false;\r\n\r\n      const role = userProfiles[userKey]?.role;\r\n      if (filterBy === 'buyers' && role !== 'buyer') return false;\r\n      if (filterBy === 'sellers' && role !== 'seller') return false;\r\n\r\n      return true;\r\n    });\r\n\r\n    return filtered.sort((a, b) => {\r\n      const dateA = new Date(lastMessages[a]?.date || 0).getTime();\r\n      const dateB = new Date(lastMessages[b]?.date || 0).getTime();\r\n      return dateB - dateA;\r\n    });\r\n  }, [threads, lastMessages, searchQuery, filterBy, userProfiles]);\r\n\r\n  if (filteredAndSortedThreads.length === 0) {\r\n    return (\r\n      <div className=\"p-4 text-center text-gray-400\">\r\n        <MessageCircle size={48} className=\"mx-auto text-gray-600 mb-2\" />\r\n        <p className=\"text-lg mb-2\">No conversations found</p>\r\n        <p className=\"text-sm mb-4\">Switch to \"All Users\" to start new conversations</p>\r\n        <button\r\n          onClick={onStartNewConversation}\r\n          className=\"px-4 py-2 bg-[#ff950e] text-black font-medium rounded-lg hover:bg-[#e88800] transition-colors inline-flex items-center justify-center\"\r\n        >\r\n          Browse Users\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div role=\"list\">\r\n      {filteredAndSortedThreads.map((userKey) => {\r\n        const lastMessage = lastMessages[userKey];\r\n        const isActive = activeThread === userKey;\r\n        const userProfile = userProfiles[userKey];\r\n        const unreadCount = unreadCounts[userKey] || 0;\r\n\r\n        return (\r\n          <div\r\n            key={userKey}\r\n            onClick={() => onThreadSelect(userKey)}\r\n            className={`flex items-center p-3 cursor-pointer relative border-b border-gray-800 ${\r\n              isActive ? 'bg-[#2a2a2a]' : 'hover:bg-[#1a1a1a]'\r\n            } transition-colors duration-150 ease-in-out`}\r\n            role=\"listitem\"\r\n          >\r\n            {isActive && <div className=\"absolute left-0 top-0 bottom-0 w-1 bg-[#ff950e]\" />}\r\n\r\n            <div className=\"relative mr-3\">\r\n              <div className=\"relative w-12 h-12 rounded-full bg-[#333] flex items-center justify-center text-white font-bold overflow-hidden shadow-md\">\r\n                {userProfile?.pic ? (\r\n                  <img\r\n                    src={sanitizeUrl(userProfile.pic)}\r\n                    alt=\"\"\r\n                    className=\"w-full h-full object-cover\"\r\n                    onError={(e) => {\r\n                      e.currentTarget.style.display = 'none';\r\n                    }}\r\n                  />\r\n                ) : (\r\n                  getInitial(userKey)\r\n                )}\r\n\r\n                <div className=\"absolute bottom-0 right-0 text-[8px] bg-black px-1 rounded text-[#ff950e] border border-[#ff950e]\">\r\n                  {userProfile?.role === 'buyer' ? 'B' : userProfile?.role === 'seller' ? 'S' : '?'}\r\n                </div>\r\n              </div>\r\n\r\n              {unreadCount > 0 && (\r\n                <div className=\"absolute -top-1 -right-1 w-6 h-6 bg-[#ff950e] text-black text-xs rounded-full flex items-center justify-center font-bold border-2 border-[#121212] shadow-lg\">\r\n                  {Math.min(unreadCount, 99)}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"flex-1 min-w-0\">\r\n              <div className=\"flex justify-between\">\r\n                <h3 className=\"font-bold text-white truncate\">\r\n                  <span>\r\n                    <SecureMessageDisplay content={userKey} allowBasicFormatting={false} />\r\n                  </span>\r\n                </h3>\r\n                <span className=\"text-xs text-gray-400 whitespace-nowrap ml-1 flex items-center\">\r\n                  <Clock size={12} className=\"mr-1\" />\r\n                  {lastMessage ? formatTimeAgo(lastMessage.date) : ''}\r\n                </span>\r\n              </div>\r\n              <div className=\"text-sm text-gray-400 truncate\">\r\n                {lastMessage ? (\r\n                  lastMessage.type === 'customRequest' ? (\r\n                    'üõ†Ô∏è Custom Request'\r\n                  ) : lastMessage.type === 'image' ? (\r\n                    'üì∑ Image'\r\n                  ) : (\r\n                    <span>\r\n                      <SecureMessageDisplay content={lastMessage.content} allowBasicFormatting={false} maxLength={50} />\r\n                    </span>\r\n                  )\r\n                ) : (\r\n                  ''\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAAA;AAEA;AACA;AANA;;;;;;AAoBe,SAAS,qBAAqB,EAC3C,OAAO,EACP,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,WAAW,EACX,QAAQ,EACR,cAAc,EACd,sBAAsB,EACI;IAC1B,MAAM,aAAa,CAAC,WAAsB,WAAW,SAAS,MAAM,CAAC,GAAG,WAAW,KAAK;IAExF,MAAM,gBAAgB,CAAC;QACrB,MAAM,MAAM,IAAI,OAAO,OAAO;QAC9B,MAAM,OAAO,IAAI,KAAK,MAAM,OAAO;QACnC,MAAM,SAAS,KAAK,GAAG,CAAC,GAAG,MAAM;QAEjC,MAAM,IAAI,KAAK,KAAK,CAAC,SAAS,CAAC,OAAO,KAAK,KAAK,EAAE;QAClD,IAAI,IAAI,GAAG,OAAO,MAAM,IAAI,WAAW,GAAG,EAAE,KAAK,CAAC;QAElD,MAAM,IAAI,KAAK,KAAK,CAAC,SAAS,CAAC,OAAO,KAAK,EAAE;QAC7C,IAAI,IAAI,GAAG,OAAO,MAAM,IAAI,WAAW,GAAG,EAAE,KAAK,CAAC;QAElD,MAAM,IAAI,KAAK,KAAK,CAAC,SAAS,CAAC,OAAO,EAAE;QACxC,IAAI,IAAI,GAAG,OAAO,MAAM,IAAI,WAAW,GAAG,EAAE,KAAK,CAAC;QAElD,OAAO;IACT;IAEA,MAAM,2BAA2B,CAAA,GAAA,qMAAA,CAAA,UAAO,AAAD,EAAE;QACvC,MAAM,kBAAkB,cAAc,CAAA,GAAA,wIAAA,CAAA,sBAAmB,AAAD,EAAE,aAAa,WAAW,KAAK;QAEvF,MAAM,WAAW,OAAO,IAAI,CAAC,SAAS,MAAM,CAAC,CAAC;YAC5C,MAAM,gBAAgB,kBAAkB,QAAQ,WAAW,GAAG,QAAQ,CAAC,mBAAmB;YAC1F,IAAI,CAAC,eAAe,OAAO;YAE3B,MAAM,OAAO,YAAY,CAAC,QAAQ,EAAE;YACpC,IAAI,aAAa,YAAY,SAAS,SAAS,OAAO;YACtD,IAAI,aAAa,aAAa,SAAS,UAAU,OAAO;YAExD,OAAO;QACT;QAEA,OAAO,SAAS,IAAI,CAAC,CAAC,GAAG;YACvB,MAAM,QAAQ,IAAI,KAAK,YAAY,CAAC,EAAE,EAAE,QAAQ,GAAG,OAAO;YAC1D,MAAM,QAAQ,IAAI,KAAK,YAAY,CAAC,EAAE,EAAE,QAAQ,GAAG,OAAO;YAC1D,OAAO,QAAQ;QACjB;IACF,GAAG;QAAC;QAAS;QAAc;QAAa;QAAU;KAAa;IAE/D,IAAI,yBAAyB,MAAM,KAAK,GAAG;QACzC,qBACE,8OAAC;YAAI,WAAU;;8BACb,8OAAC,wNAAA,CAAA,gBAAa;oBAAC,MAAM;oBAAI,WAAU;;;;;;8BACnC,8OAAC;oBAAE,WAAU;8BAAe;;;;;;8BAC5B,8OAAC;oBAAE,WAAU;8BAAe;;;;;;8BAC5B,8OAAC;oBACC,SAAS;oBACT,WAAU;8BACX;;;;;;;;;;;;IAKP;IAEA,qBACE,8OAAC;QAAI,MAAK;kBACP,yBAAyB,GAAG,CAAC,CAAC;YAC7B,MAAM,cAAc,YAAY,CAAC,QAAQ;YACzC,MAAM,WAAW,iBAAiB;YAClC,MAAM,cAAc,YAAY,CAAC,QAAQ;YACzC,MAAM,cAAc,YAAY,CAAC,QAAQ,IAAI;YAE7C,qBACE,8OAAC;gBAEC,SAAS,IAAM,eAAe;gBAC9B,WAAW,CAAC,uEAAuE,EACjF,WAAW,iBAAiB,qBAC7B,2CAA2C,CAAC;gBAC7C,MAAK;;oBAEJ,0BAAY,8OAAC;wBAAI,WAAU;;;;;;kCAE5B,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;;oCACZ,aAAa,oBACZ,8OAAC;wCACC,KAAK,CAAA,GAAA,wIAAA,CAAA,cAAW,AAAD,EAAE,YAAY,GAAG;wCAChC,KAAI;wCACJ,WAAU;wCACV,SAAS,CAAC;4CACR,EAAE,aAAa,CAAC,KAAK,CAAC,OAAO,GAAG;wCAClC;;;;;+CAGF,WAAW;kDAGb,8OAAC;wCAAI,WAAU;kDACZ,aAAa,SAAS,UAAU,MAAM,aAAa,SAAS,WAAW,MAAM;;;;;;;;;;;;4BAIjF,cAAc,mBACb,8OAAC;gCAAI,WAAU;0CACZ,KAAK,GAAG,CAAC,aAAa;;;;;;;;;;;;kCAK7B,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAG,WAAU;kDACZ,cAAA,8OAAC;sDACC,cAAA,8OAAC,gJAAA,CAAA,uBAAoB;gDAAC,SAAS;gDAAS,sBAAsB;;;;;;;;;;;;;;;;kDAGlE,8OAAC;wCAAK,WAAU;;0DACd,8OAAC,oMAAA,CAAA,QAAK;gDAAC,MAAM;gDAAI,WAAU;;;;;;4CAC1B,cAAc,cAAc,YAAY,IAAI,IAAI;;;;;;;;;;;;;0CAGrD,8OAAC;gCAAI,WAAU;0CACZ,cACC,YAAY,IAAI,KAAK,kBACnB,uBACE,YAAY,IAAI,KAAK,UACvB,2BAEA,8OAAC;8CACC,cAAA,8OAAC,gJAAA,CAAA,uBAAoB;wCAAC,SAAS,YAAY,OAAO;wCAAE,sBAAsB;wCAAO,WAAW;;;;;;;;;;2CAIhG;;;;;;;;;;;;;eA5DD;;;;;QAkEX;;;;;;AAGN","debugId":null}},
    {"offset": {"line": 988, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gerom/OneDrive/Documents/pantypost/src/components/admin/messages/UserDirectoryContent.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useMemo } from 'react';\r\nimport { Users, User, BellRing, BadgeCheck, ChevronRight } from 'lucide-react';\r\nimport { sanitizeSearchQuery, sanitizeUrl } from '@/utils/security/sanitization';\r\nimport { SecureMessageDisplay } from '@/components/ui/SecureMessageDisplay';\r\n\r\ninterface UserInfo {\r\n  username: string;\r\n  role: 'buyer' | 'seller' | string;\r\n  verified: boolean;\r\n  pic: string | null;\r\n}\r\n\r\ninterface UserDirectoryContentProps {\r\n  allUsers: UserInfo[];\r\n  directorySearchQuery: string;\r\n  filterBy: 'all' | 'buyers' | 'sellers';\r\n  onStartConversation: (username: string) => void;\r\n  onClearFilters: () => void;\r\n}\r\n\r\nexport default function UserDirectoryContent({\r\n  allUsers,\r\n  directorySearchQuery,\r\n  filterBy,\r\n  onStartConversation,\r\n  onClearFilters\r\n}: UserDirectoryContentProps) {\r\n  const getInitial = (username: string) => (username ? username.charAt(0).toUpperCase() : '?');\r\n\r\n  const filteredDirectoryUsers = useMemo(() => {\r\n    const sanitizedSearch = directorySearchQuery ? sanitizeSearchQuery(directorySearchQuery).toLowerCase() : '';\r\n\r\n    return (allUsers || [])\r\n      .filter((userInfo) => {\r\n        const matchesSearch = sanitizedSearch ? userInfo.username.toLowerCase().includes(sanitizedSearch) : true;\r\n        if (!matchesSearch) return false;\r\n\r\n        if (filterBy === 'buyers' && userInfo.role !== 'buyer') return false;\r\n        if (filterBy === 'sellers' && userInfo.role !== 'seller') return false;\r\n\r\n        return true;\r\n      })\r\n      .sort((a, b) => a.username.localeCompare(b.username));\r\n  }, [allUsers, directorySearchQuery, filterBy]);\r\n\r\n  const UserListItem = ({ userInfo }: { userInfo: UserInfo }) => (\r\n    <div\r\n      onClick={() => onStartConversation(userInfo.username)}\r\n      className=\"flex items-center p-3 cursor-pointer hover:bg-[#222] transition-all duration-200 border-b border-gray-800 group\"\r\n      role=\"button\"\r\n      aria-label={`Start conversation with ${userInfo.username}`}\r\n    >\r\n      <div className=\"relative mr-3\">\r\n        <div className=\"w-12 h-12 rounded-full bg-[#333] flex items-center justify-center text-white font-bold overflow-hidden shadow-md border-2 border-gray-700 group-hover:border-[#ff950e]/50 transition-colors\">\r\n          {userInfo.pic ? (\r\n            <img\r\n              src={sanitizeUrl(userInfo.pic)}\r\n              alt=\"\"\r\n              className=\"w-full h-full object-cover\"\r\n              onError={(e) => {\r\n                e.currentTarget.style.display = 'none';\r\n              }}\r\n            />\r\n          ) : (\r\n            <span className=\"text-lg\">{getInitial(userInfo.username)}</span>\r\n          )}\r\n        </div>\r\n\r\n        <div\r\n          className={`absolute -bottom-1 -right-1 text-[10px] px-1.5 py-0.5 rounded-full font-bold shadow-lg ${\r\n            userInfo.role === 'buyer' ? 'bg-blue-500 text-white' : 'bg-green-500 text-white'\r\n          }`}\r\n        >\r\n          {userInfo.role === 'buyer' ? 'B' : 'S'}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex-1 min-w-0\">\r\n        <div className=\"flex items-center gap-2 mb-1\">\r\n          <h4 className=\"font-medium text-white truncate group-hover:text-[#ff950e] transition-colors\">\r\n            <SecureMessageDisplay content={userInfo.username} allowBasicFormatting={false} />\r\n          </h4>\r\n          {userInfo.verified && <BadgeCheck size={14} className=\"text-[#ff950e] flex-shrink-0\" />}\r\n        </div>\r\n        <p className=\"text-xs text-gray-400\">{userInfo.role === 'buyer' ? 'Buyer Account' : 'Seller Account'}</p>\r\n      </div>\r\n\r\n      <ChevronRight size={16} className=\"text-gray-500 group-hover:text-[#ff950e] transition-colors flex-shrink-0\" />\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"px-4 py-2 border-b border-gray-800 bg-[#1a1a1a]\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <p className=\"text-sm text-gray-400\">\r\n            {filteredDirectoryUsers.length} user{filteredDirectoryUsers.length !== 1 ? 's' : ''} available\r\n          </p>\r\n          {(directorySearchQuery || filterBy !== 'all') && (\r\n            <button onClick={onClearFilters} className=\"text-xs text-[#ff950e] hover:text-[#ffb04e] transition-colors\">\r\n              Clear filters\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {filteredDirectoryUsers.length === 0 ? (\r\n        <div className=\"p-6 text-center text-gray-400\">\r\n          <Users size={48} className=\"mx-auto mb-3 text-gray-600\" />\r\n          <p className=\"text-lg mb-1\">No users found</p>\r\n          <p className=\"text-sm\">Try adjusting your search or filter</p>\r\n        </div>\r\n      ) : (\r\n        <div>\r\n          {filterBy === 'all' ? (\r\n            <>\r\n              {filteredDirectoryUsers.filter((u) => u.role === 'buyer').length > 0 && (\r\n                <>\r\n                  <div className=\"px-4 py-2 bg-[#1a1a1a] border-b border-gray-800\">\r\n                    <h3 className=\"text-sm font-medium text-blue-400 flex items-center gap-2\">\r\n                      <User size={14} />\r\n                      Buyers ({filteredDirectoryUsers.filter((u) => u.role === 'buyer').length})\r\n                    </h3>\r\n                  </div>\r\n                  {filteredDirectoryUsers\r\n                    .filter((u) => u.role === 'buyer')\r\n                    .sort((a, b) => a.username.localeCompare(b.username))\r\n                    .map((userInfo) => (\r\n                      <UserListItem key={`buyer-${userInfo.username}`} userInfo={userInfo} />\r\n                    ))}\r\n                </>\r\n              )}\r\n\r\n              {filteredDirectoryUsers.filter((u) => u.role === 'seller').length > 0 && (\r\n                <>\r\n                  <div className=\"px-4 py-2 bg-[#1a1a1a] border-b border-gray-800\">\r\n                    <h3 className=\"text-sm font-medium text-green-400 flex items-center gap-2\">\r\n                      <BellRing size={14} />\r\n                      Sellers ({filteredDirectoryUsers.filter((u) => u.role === 'seller').length})\r\n                    </h3>\r\n                  </div>\r\n                  {filteredDirectoryUsers\r\n                    .filter((u) => u.role === 'seller')\r\n                    .sort((a, b) => a.username.localeCompare(b.username))\r\n                    .map((userInfo) => (\r\n                      <UserListItem key={`seller-${userInfo.username}`} userInfo={userInfo} />\r\n                    ))}\r\n                </>\r\n              )}\r\n            </>\r\n          ) : (\r\n            filteredDirectoryUsers\r\n              .sort((a, b) => a.username.localeCompare(b.username))\r\n              .map((userInfo) => <UserListItem key={userInfo.username} userInfo={userInfo} />)\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1307, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gerom/OneDrive/Documents/pantypost/src/components/messaging/ImagePreviewModal.tsx"],"sourcesContent":["// src/components/messaging/ImagePreviewModal.tsx\r\n'use client';\r\n\r\nimport React, { useEffect, useCallback } from 'react';\r\nimport { X } from 'lucide-react';\r\n\r\ninterface ImagePreviewModalProps {\r\n  imageUrl: string;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nconst ImagePreviewModal: React.FC<ImagePreviewModalProps> = ({\r\n  imageUrl,\r\n  isOpen,\r\n  onClose,\r\n}) => {\r\n  // Close on Escape\r\n  const handleKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') onClose();\r\n    },\r\n    [onClose]\r\n  );\r\n\r\n  // Prevent background scroll while open + add key listener\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    document.body.style.overflow = 'hidden';\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => {\r\n      document.body.style.overflow = '';\r\n      window.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n  }, [isOpen, handleKeyDown]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div\r\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/75\"\r\n      onClick={onClose}\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      aria-label=\"Image preview\"\r\n    >\r\n      <div\r\n        className=\"relative max-w-[90vw] max-h-[90vh] outline-none\"\r\n        onClick={(e) => e.stopPropagation()}\r\n        tabIndex={-1}\r\n      >\r\n        <button\r\n          onClick={onClose}\r\n          className=\"absolute -top-4 -right-4 bg-red-500 text-white rounded-full p-2 shadow-lg\"\r\n          aria-label=\"Close preview\"\r\n        >\r\n          <X size={20} />\r\n        </button>\r\n        {/* Guard against empty URL */}\r\n        {imageUrl ? (\r\n          <img\r\n            src={imageUrl}\r\n            alt=\"Full size preview\"\r\n            className=\"max-w-full max-h-[90vh] object-contain rounded-lg\"\r\n            draggable={false}\r\n          />\r\n        ) : (\r\n          <div className=\"max-w-full max-h-[90vh] p-8 bg-[#1a1a1a] text-gray-400 rounded-lg\">\r\n            Image unavailable\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ImagePreviewModal;\r\n"],"names":[],"mappings":"AAAA,iDAAiD;;;;;AAGjD;AACA;AAHA;;;;AAWA,MAAM,oBAAsD,CAAC,EAC3D,QAAQ,EACR,MAAM,EACN,OAAO,EACR;IACC,kBAAkB;IAClB,MAAM,gBAAgB,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAC9B,CAAC;QACC,IAAI,EAAE,GAAG,KAAK,UAAU;IAC1B,GACA;QAAC;KAAQ;IAGX,0DAA0D;IAC1D,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,CAAC,QAAQ;QACb,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QAC/B,OAAO,gBAAgB,CAAC,WAAW;QACnC,OAAO;YACL,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;YAC/B,OAAO,mBAAmB,CAAC,WAAW;QACxC;IACF,GAAG;QAAC;QAAQ;KAAc;IAE1B,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,8OAAC;QACC,WAAU;QACV,SAAS;QACT,MAAK;QACL,cAAW;QACX,cAAW;kBAEX,cAAA,8OAAC;YACC,WAAU;YACV,SAAS,CAAC,IAAM,EAAE,eAAe;YACjC,UAAU,CAAC;;8BAEX,8OAAC;oBACC,SAAS;oBACT,WAAU;oBACV,cAAW;8BAEX,cAAA,8OAAC,4LAAA,CAAA,IAAC;wBAAC,MAAM;;;;;;;;;;;gBAGV,yBACC,8OAAC;oBACC,KAAK;oBACL,KAAI;oBACJ,WAAU;oBACV,WAAW;;;;;6EAGb,8OAAC;oBAAI,WAAU;8BAAoE;;;;;;;;;;;;;;;;;AAO7F;uCAEe","debugId":null}},
    {"offset": {"line": 1400, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gerom/OneDrive/Documents/pantypost/src/components/admin/messages/EmojiPicker.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useRef, useEffect, useState } from 'react';\r\nimport { storageService } from '@/services';\r\n\r\n// Flat emoji list (trimmed for brevity in this snippet)\r\nconst ALL_EMOJIS: string[] = [\r\n  'üòÄ','üòÉ','üòÑ','üòÅ','üòÜ','üòÖ','üòÇ','ü§£','üòä','üòá','üôÇ','üôÉ','üòâ','üòå','üòç','ü•∞','üòò','üòó','üòô','üòö','üòã','üòõ','üòù','üòú','üòè','üòí',\r\n  // ... keep your full list unchanged ...\r\n  'üè¥‚Äç‚ò†Ô∏è'\r\n];\r\n\r\ninterface EmojiPickerProps {\r\n  onEmojiSelect: (emoji: string) => void;\r\n  onClose: () => void;\r\n}\r\n\r\nexport default function EmojiPicker({ onEmojiSelect, onClose }: EmojiPickerProps) {\r\n  const [recentEmojis, setRecentEmojis] = useState<string[]>([]);\r\n  const emojiPickerRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Load recent\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const stored = await storageService.getItem<string[]>('panty_recent_emojis', []);\r\n        if (Array.isArray(stored)) {\r\n          setRecentEmojis(stored.slice(0, 30));\r\n        }\r\n      } catch (error) {\r\n        console.error('Failed to load recent emojis:', error);\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  // Save recent\r\n  useEffect(() => {\r\n    if (recentEmojis.length === 0) return;\r\n    (async () => {\r\n      try {\r\n        await storageService.setItem('panty_recent_emojis', recentEmojis);\r\n      } catch (error) {\r\n        console.error('Failed to save recent emojis:', error);\r\n      }\r\n    })();\r\n  }, [recentEmojis]);\r\n\r\n  // Close on outside click\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (emojiPickerRef.current && !emojiPickerRef.current.contains(event.target as Node)) {\r\n        onClose();\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, [onClose]);\r\n\r\n  const handleEmojiClick = (emoji: string) => {\r\n    onEmojiSelect(emoji);\r\n    setRecentEmojis((prev) => {\r\n      const filtered = prev.filter((e) => e !== emoji);\r\n      return [emoji, ...filtered].slice(0, 30);\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div\r\n      ref={emojiPickerRef}\r\n      className=\"absolute left-0 right-0 mx-4 bottom-full mb-2 bg-black border border-gray-800 shadow-lg z-50 rounded-lg overflow-hidden\"\r\n      role=\"dialog\"\r\n      aria-label=\"Emoji picker\"\r\n    >\r\n      {recentEmojis.length > 0 && (\r\n        <div className=\"px-3 pt-3\">\r\n          <div className=\"text-xs text-gray-400 mb-2\">Recent</div>\r\n          <div className=\"grid grid-cols-8 gap-1 mb-3\">\r\n            {recentEmojis.slice(0, 16).map((emoji, index) => (\r\n              <button\r\n                key={`recent-${emoji}-${index}`}\r\n                onClick={() => handleEmojiClick(emoji)}\r\n                className=\"flex items-center justify-center text-xl rounded-full w-10 h-10 bg-black hover:bg-[#222] transition-colors duration-150\"\r\n                type=\"button\"\r\n                aria-label={`Insert emoji ${emoji}`}\r\n              >\r\n                {emoji}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"px-3 pt-2 pb-3\">\r\n        {recentEmojis.length > 0 && <div className=\"text-xs text-gray-400 mb-2\">All Emojis</div>}\r\n        <div className=\"grid grid-cols-8 gap-1 p-0 overflow-auto\" style={{ maxHeight: 200 }}>\r\n          {ALL_EMOJIS.map((emoji, index) => (\r\n            <button\r\n              key={`emoji-${emoji}-${index}`}\r\n              onClick={() => handleEmojiClick(emoji)}\r\n              className=\"flex items-center justify-center text-xl rounded-full w-10 h-10 bg-black hover:bg-[#222] transition-colors duration-150\"\r\n              type=\"button\"\r\n              aria-label={`Insert emoji ${emoji}`}\r\n            >\r\n              {emoji}\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1583, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gerom/OneDrive/Documents/pantypost/src/components/admin/messages/ChatContent.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useRef, useCallback, useState, useEffect, useMemo } from 'react';\r\nimport {\r\n  ArrowRightCircle,\r\n  CheckCheck,\r\n  X,\r\n  Paperclip,\r\n  Smile,\r\n  Image as ImageIcon,\r\n  ShieldAlert,\r\n  AlertTriangle,\r\n  Clock,\r\n  BadgeCheck,\r\n  MessageCircle,\r\n  MessageSquarePlus\r\n} from 'lucide-react';\r\nimport ImagePreviewModal from '@/components/messaging/ImagePreviewModal';\r\nimport { Message } from '@/types/message';\r\nimport EmojiPicker from './EmojiPicker';\r\nimport { SecureTextarea } from '@/components/ui/SecureInput';\r\nimport { SecureMessageDisplay, SecureImage } from '@/components/ui/SecureMessageDisplay';\r\nimport { sanitizeStrict, sanitizeCurrency } from '@/utils/security/sanitization';\r\nimport { securityService } from '@/services/security.service';\r\n\r\nconst MAX_IMAGE_SIZE = 5 * 1024 * 1024; // 5MB\r\nconst ALLOWED_IMAGE_TYPES = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\r\n\r\ninterface ChatContentProps {\r\n  activeThread: string | null;\r\n  activeMessages: Message[];\r\n  userProfiles: { [user: string]: { pic: string | null; verified: boolean; role: string } };\r\n  content: string;\r\n  setContent: React.Dispatch<React.SetStateAction<string>>;\r\n  selectedImage: string | null;\r\n  setSelectedImage: React.Dispatch<React.SetStateAction<string | null>>;\r\n  isUserBlocked: boolean;\r\n  isUserReported: boolean;\r\n  onSend: () => void;\r\n  onBlockToggle: () => void;\r\n  onReport: () => void;\r\n  onStartNewConversation: () => void;\r\n  username: string;\r\n}\r\n\r\nexport default function ChatContent({\r\n  activeThread,\r\n  activeMessages,\r\n  userProfiles,\r\n  content,\r\n  setContent,\r\n  selectedImage,\r\n  setSelectedImage,\r\n  isUserBlocked,\r\n  isUserReported,\r\n  onSend,\r\n  onBlockToggle,\r\n  onReport,\r\n  onStartNewConversation,\r\n  username\r\n}: ChatContentProps) {\r\n  const [isImageLoading, setIsImageLoading] = useState(false);\r\n  const [imageError, setImageError] = useState<string | null>(null);\r\n  const [previewImage, setPreviewImage] = useState<string | null>(null);\r\n  const [showEmojiPicker, setShowEmojiPicker] = useState(false);\r\n\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const inputRef = useRef<HTMLTextAreaElement>(null);\r\n\r\n  // Scroll to bottom on new messages\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [activeMessages]);\r\n\r\n  const getInitial = (name: string) => (name ? name.charAt(0).toUpperCase() : '?');\r\n\r\n  const isSingleEmoji = (text: string) => {\r\n    // Robust single-emoji check\r\n    try {\r\n      const emojiRegex =\r\n        /^(\\p{Emoji_Presentation}|\\p{Extended_Pictographic})(\\u200d(\\p{Emoji_Presentation}|\\p{Extended_Pictographic}))*$/u;\r\n      return !!text && emojiRegex.test(text.trim());\r\n    } catch {\r\n      // Fallback if Unicode props unsupported\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const handleImageSelect = useCallback(\r\n    (event: React.ChangeEvent<HTMLInputElement>) => {\r\n      const file = event.target.files?.[0] || null;\r\n      setImageError(null);\r\n      if (!file) return;\r\n\r\n      const validation = securityService.validateFileUpload(file, {\r\n        maxSize: MAX_IMAGE_SIZE,\r\n        allowedTypes: ALLOWED_IMAGE_TYPES,\r\n        allowedExtensions: ['jpg', 'jpeg', 'png', 'gif', 'webp']\r\n      });\r\n\r\n      if (!validation.valid) {\r\n        setImageError(validation.error || 'Invalid file');\r\n        return;\r\n      }\r\n\r\n      setIsImageLoading(true);\r\n      const reader = new FileReader();\r\n\r\n      reader.onloadend = () => {\r\n        setSelectedImage(reader.result as string);\r\n        setIsImageLoading(false);\r\n      };\r\n\r\n      reader.onerror = () => {\r\n        setImageError('Failed to read the image file. Please try again.');\r\n        setIsImageLoading(false);\r\n      };\r\n\r\n      reader.readAsDataURL(file);\r\n    },\r\n    [setSelectedImage]\r\n  );\r\n\r\n  const triggerFileInput = useCallback(() => fileInputRef.current?.click(), []);\r\n\r\n  const handleKeyDown = useCallback(\r\n    (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n      if (e.key === 'Enter' && !e.shiftKey) {\r\n        e.preventDefault();\r\n        onSend();\r\n      }\r\n    },\r\n    [onSend]\r\n  );\r\n\r\n  const handleEmojiSelect = useCallback(\r\n    (emoji: string) => {\r\n      setContent((prev) => `${prev}${emoji}`);\r\n      inputRef.current?.focus();\r\n    },\r\n    [setContent]\r\n  );\r\n\r\n  const sanitizedActiveThread = useMemo(\r\n    () => (activeThread ? sanitizeStrict(activeThread) : null),\r\n    [activeThread]\r\n  );\r\n  const sanitizedUsername = useMemo(() => sanitizeStrict(username), [username]);\r\n\r\n  if (!activeThread) {\r\n    return (\r\n      <div className=\"flex-1 flex items-center justify-center text-gray-400\">\r\n        <div className=\"text-center p-4\">\r\n          <div className=\"flex justify-center mb-4\">\r\n            <MessageCircle size={64} className=\"text-gray-600\" />\r\n          </div>\r\n          <p className=\"text-xl mb-2\">Select a conversation to view messages</p>\r\n          <p className=\"text-sm mb-4\">Your messages will appear here</p>\r\n          <button\r\n            onClick={onStartNewConversation}\r\n            className=\"px-4 py-2 bg-[#ff950e] text-black font-medium rounded-lg hover:bg-[#e88800] transition-colors flex items-center justify-center mx-auto\"\r\n          >\r\n            <MessageSquarePlus size={16} className=\"mr-2\" />\r\n            Start New Conversation\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const canSend = (!!content.trim() || !!selectedImage) && !isImageLoading;\r\n\r\n  return (\r\n    <>\r\n      {/* Header */}\r\n      <div className=\"px-4 py-3 flex items-center justify-between border-b border-gray-800 bg-[#1a1a1a]\">\r\n        <div className=\"flex items-center\">\r\n          <div className=\"relative w-10 h-10 rounded-full bg-[#333] flex items-center justify-center text-white font-bold mr-3 overflow-hidden shadow-md\">\r\n            {userProfiles[activeThread]?.pic ? (\r\n              <SecureImage\r\n                src={userProfiles[activeThread].pic}\r\n                alt={sanitizedActiveThread || ''}\r\n                className=\"w-full h-full object-cover\"\r\n              />\r\n            ) : (\r\n              getInitial(sanitizedActiveThread || '')\r\n            )}\r\n\r\n            {userProfiles[activeThread]?.verified && (\r\n              <div className=\"absolute bottom-0 right-0 bg-[#1a1a1a] p-0.5 rounded-full border border-[#ff950e] shadow-sm\">\r\n                <BadgeCheck size={12} className=\"text-[#ff950e]\" />\r\n              </div>\r\n            )}\r\n          </div>\r\n          <div>\r\n            <div className=\"flex items-center gap-1\">\r\n              <h2 className=\"font-bold text-lg text-white\">\r\n                <SecureMessageDisplay content={sanitizedActiveThread || ''} allowBasicFormatting={false} />\r\n              </h2>\r\n              <span className=\"text-xs px-2 py-0.5 rounded bg-[#333] text-gray-300\">\r\n                {userProfiles[activeThread]?.role === 'buyer'\r\n                  ? 'Buyer'\r\n                  : userProfiles[activeThread]?.role === 'seller'\r\n                  ? 'Seller'\r\n                  : 'User'}\r\n              </span>\r\n            </div>\r\n            <p className=\"text-xs text-[#ff950e] flex items-center\">\r\n              <Clock size={12} className=\"mr-1 text-[#ff950e]\" />\r\n              Admin conversation\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex space-x-2 text-white\">\r\n          <button\r\n            onClick={onReport}\r\n            disabled={isUserReported}\r\n            className={`px-3 py-1 text-xs border rounded flex items-center ${\r\n              isUserReported\r\n                ? 'text-gray-400 border-gray-500'\r\n                : 'text-red-500 border-red-500 hover:bg-red-500/10'\r\n            } transition-colors duration-150`}\r\n            aria-disabled={isUserReported}\r\n          >\r\n            <AlertTriangle size={12} className=\"mr-1\" />\r\n            {isUserReported ? 'Reported' : 'Report'}\r\n          </button>\r\n          <button\r\n            onClick={onBlockToggle}\r\n            className={`px-3 py-1 text-xs border rounded flex items-center ${\r\n              isUserBlocked\r\n                ? 'text-green-500 border-green-500 hover:bg-green-500/10'\r\n                : 'text-red-500 border-red-500 hover:bg-red-500/10'\r\n            } transition-colors duration-150`}\r\n          >\r\n            <ShieldAlert size={12} className=\"mr-1\" />\r\n            {isUserBlocked ? 'Unblock' : 'Block'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Messages */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 bg-[#121212]\">\r\n        <div className=\"max-w-3xl mx-auto space-y-4\">\r\n          {activeMessages.map((msg, index) => {\r\n            const isFromMe = msg.sender === username;\r\n            const time = new Date(msg.date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n            const isSingleEmojiMsg = !!msg.content && isSingleEmoji(msg.content);\r\n            const sanitizedSender = sanitizeStrict(msg.sender || '');\r\n\r\n            return (\r\n              <div key={`${msg.id || 'm'}-${index}`} className={`flex ${isFromMe ? 'justify-end' : 'justify-start'}`}>\r\n                <div\r\n                  className={`rounded-lg p-3 max-w-[75%] ${\r\n                    isFromMe ? 'bg-[#ff950e] text-white shadow-lg' : 'bg-[#333] text-white shadow-md'\r\n                  }`}\r\n                >\r\n                  {/* Header */}\r\n                  <div className=\"flex items-center text-xs mb-1\">\r\n                    <span className={isFromMe ? 'text-white/75' : 'text-gray-300'}>\r\n                      {isFromMe ? 'You' : sanitizedSender} ‚Ä¢ {time}\r\n                    </span>\r\n                    {isFromMe && (\r\n                      <span className=\"ml-2 text-[10px]\">\r\n                        {msg.read ? (\r\n                          <span className={`flex items-center ${isFromMe ? 'text-white/75' : 'text-gray-400'}`}>\r\n                            <CheckCheck size={12} className=\"mr-1\" /> Read\r\n                          </span>\r\n                        ) : (\r\n                          <span className={isFromMe ? 'text-white/60' : 'text-gray-400'}>Sent</span>\r\n                        )}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Image message */}\r\n                  {msg.type === 'image' && msg.meta?.imageUrl && (\r\n                    <div className=\"mt-1 mb-2\">\r\n                      <SecureImage\r\n                        src={msg.meta.imageUrl}\r\n                        alt=\"Shared image\"\r\n                        className=\"max-w-full rounded cursor-pointer hover:opacity-90 transition-opacity shadow-sm\"\r\n                        onClick={(e: React.MouseEvent<HTMLImageElement>) => {\r\n                          e.stopPropagation();\r\n                          setPreviewImage(msg.meta?.imageUrl || null);\r\n                        }}\r\n                      />\r\n                      {msg.content && (\r\n                        <div className={`mt-2 ${isSingleEmojiMsg ? 'text-3xl' : ''}`}>\r\n                          <SecureMessageDisplay content={msg.content} allowBasicFormatting={false} className=\"text-white\" />\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Text message */}\r\n                  {msg.type !== 'image' && msg.type !== 'customRequest' && (\r\n                    <div className={isSingleEmojiMsg ? 'text-3xl' : ''}>\r\n                      <SecureMessageDisplay content={msg.content || ''} allowBasicFormatting={false} className=\"text-white\" />\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Custom request */}\r\n                  {msg.type === 'customRequest' && msg.meta && (\r\n                    <div className=\"mt-2 text-sm text-orange-400 space-y-1 border-t border-white/20 pt-2\">\r\n                      <p className=\"font-semibold flex items-center\">\r\n                        <Paperclip size={16} className=\"mr-1\" />\r\n                        Custom Request\r\n                      </p>\r\n                      <p>\r\n                        <b>Title:</b> {sanitizeStrict(msg.meta.title || '')}\r\n                      </p>\r\n                      <p>\r\n                        <b>Price:</b> $\r\n                        {Number(sanitizeCurrency(msg.meta.price ?? 0)).toFixed(2)}\r\n                      </p>\r\n                      <p>\r\n                        <b>Tags:</b> {(msg.meta.tags || []).map((tag) => sanitizeStrict(tag)).join(', ')}\r\n                      </p>\r\n                      {msg.meta.message && (\r\n                        <div>\r\n                          <b>Message:</b>{' '}\r\n                          <SecureMessageDisplay content={msg.meta.message} allowBasicFormatting={false} className=\"inline text-orange-400\" />\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n\r\n          <div ref={messagesEndRef} />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Composer */}\r\n      {!isUserBlocked && (\r\n        <div className=\"relative border-t border-gray-800 bg-[#1a1a1a]\">\r\n          {showEmojiPicker && <EmojiPicker onEmojiSelect={handleEmojiSelect} onClose={() => setShowEmojiPicker(false)} />}\r\n\r\n          {/* Selected image preview */}\r\n          {selectedImage && (\r\n            <div className=\"px-4 pt-3 pb-2\">\r\n              <div className=\"relative inline-block\">\r\n                <SecureImage src={selectedImage} alt=\"Preview\" className=\"max-h-20 rounded shadow-md\" />\r\n                <button\r\n                  onClick={() => {\r\n                    setSelectedImage(null);\r\n                    if (fileInputRef.current) fileInputRef.current.value = '';\r\n                  }}\r\n                  className=\"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 text-xs shadow-md transform transition-transform hover:scale-110\"\r\n                  style={{ width: 20, height: 20, display: 'flex', alignItems: 'center', justifyContent: 'center' }}\r\n                  aria-label=\"Remove attached image\"\r\n                >\r\n                  <X size={14} />\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Image states */}\r\n          {isImageLoading && (\r\n            <div className=\"px-4 pt-3 pb-0 text-sm text-gray-400\" role=\"status\" aria-live=\"polite\">\r\n              Loading image...\r\n            </div>\r\n          )}\r\n          {imageError && (\r\n            <div className=\"px-4 pt-3 pb-0 text-sm text-red-400 flex items-center\" role=\"alert\" aria-live=\"assertive\">\r\n              <AlertTriangle size={14} className=\"mr-1\" />\r\n              {imageError}\r\n            </div>\r\n          )}\r\n\r\n          {/* Input */}\r\n          <div className=\"px-4 py-3\">\r\n            <div className=\"relative mb-2\">\r\n              <SecureTextarea\r\n                ref={inputRef}\r\n                value={content}\r\n                onChange={setContent}\r\n                onKeyDown={handleKeyDown}\r\n                placeholder={selectedImage ? 'Add a caption...' : 'Type a message'}\r\n                className=\"w-full p-3 pr-12 rounded-lg bg-[#222] border border-gray-700 text-white focus:outline-none focus:ring-1 focus:ring-[#ff950e] min-h-[40px] max-h-20 resize-none overflow-auto leading-tight\"\r\n                rows={1}\r\n                maxLength={250}\r\n                characterCount={false}\r\n                sanitize\r\n              />\r\n\r\n              {/* Emoji button */}\r\n              <button\r\n                onClick={(e: React.MouseEvent<HTMLButtonElement>) => {\r\n                  e.stopPropagation();\r\n                  setShowEmojiPicker((v) => !v);\r\n                }}\r\n                className={`absolute right-3 top-1/2 -translate-y-1/2 mt-[-4px] flex items-center justify-center h-8 w-8 rounded-full ${\r\n                  showEmojiPicker ? 'bg-[#ff950e] text-black' : 'text-[#ff950e] hover:bg-[#333]'\r\n                } transition-colors duration-150`}\r\n                title=\"Emoji\"\r\n                type=\"button\"\r\n                aria-pressed={showEmojiPicker}\r\n              >\r\n                <Smile size={20} className=\"flex-shrink-0\" />\r\n              </button>\r\n            </div>\r\n\r\n            {content.length > 0 && <div className=\"text-xs text-gray-400 mb-2 text-right\">{content.length}/250</div>}\r\n\r\n            {/* Actions */}\r\n            <div className=\"flex justify-between items-center\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <button\r\n                  onClick={(e: React.MouseEvent<HTMLButtonElement>) => {\r\n                    e.stopPropagation();\r\n                    triggerFileInput();\r\n                  }}\r\n                  disabled={isImageLoading}\r\n                  className={`w-[52px] h-[52px] flex items-center justify-center rounded-full shadow-md ${\r\n                    isImageLoading ? 'bg-gray-700 text-gray-500 cursor-not-allowed' : 'bg-[#ff950e] text-black hover:bg-[#e88800]'\r\n                  } transition-colors duration-150`}\r\n                  title=\"Attach Image\"\r\n                  aria-label=\"Attach Image\"\r\n                  type=\"button\"\r\n                >\r\n                  <ImageIcon size={26} />\r\n                </button>\r\n\r\n                <button\r\n                  onClick={(e: React.MouseEvent<HTMLButtonElement>) => {\r\n                    e.stopPropagation();\r\n                    setShowEmojiPicker((v) => !v);\r\n                  }}\r\n                  className={`md:hidden w-[52px] h-[52px] flex items-center justify-center rounded-full shadow-md text-black text-2xl ${\r\n                    showEmojiPicker ? 'bg-[#e88800]' : 'bg-[#ff950e] hover:bg-[#e88800]'\r\n                  } transition-colors duration-150`}\r\n                  title=\"Emoji\"\r\n                  aria-label=\"Emoji\"\r\n                  type=\"button\"\r\n                >\r\n                  <Smile size={26} />\r\n                </button>\r\n\r\n                <input\r\n                  type=\"file\"\r\n                  accept={ALLOWED_IMAGE_TYPES.join(',')}\r\n                  ref={fileInputRef}\r\n                  style={{ display: 'none' }}\r\n                  onChange={handleImageSelect}\r\n                />\r\n              </div>\r\n\r\n              <button\r\n                onClick={(e: React.MouseEvent<HTMLButtonElement>) => {\r\n                  e.stopPropagation();\r\n                  onSend();\r\n                }}\r\n                disabled={!canSend}\r\n                className={`flex items-center justify-center px-5 py-2 rounded-full ${\r\n                  canSend ? 'bg-[#ff950e] text-black hover:bg-[#e88800]' : 'bg-[#c17200] cursor-not-allowed text-gray-300'\r\n                } transition-colors duration-150 shadow-md`}\r\n                type=\"button\"\r\n              >\r\n                <span className=\"mr-1\">Send</span>\r\n                <ArrowRightCircle size={16} className=\"flex-shrink-0\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {isUserBlocked && (\r\n        <div className=\"p-4 border-t border-gray-800 text-center text-sm text-red-400 bg-[#1a1a1a] flex items-center justify-center\">\r\n          <ShieldAlert size={16} className=\"mr-2\" />\r\n          You have blocked this user\r\n          <button\r\n            onClick={(e: React.MouseEvent<HTMLButtonElement>) => {\r\n              e.stopPropagation();\r\n              onBlockToggle();\r\n            }}\r\n            className=\"ml-2 underline text-gray-400 hover:text-white transition-colors duration-150\"\r\n          >\r\n            Unblock\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      <ImagePreviewModal imageUrl={previewImage || ''} isOpen={!!previewImage} onClose={() => setPreviewImage(null)} />\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2508, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gerom/OneDrive/Documents/pantypost/src/app/admin/messages/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport RequireAuth from '@/components/RequireAuth';\r\nimport { useAdminMessages } from '@/hooks/useAdminMessages';\r\nimport MessagesHeader from '@/components/admin/messages/MessagesHeader';\r\nimport ConversationsContent from '@/components/admin/messages/ConversationsContent';\r\nimport UserDirectoryContent from '@/components/admin/messages/UserDirectoryContent';\r\nimport ChatContent from '@/components/admin/messages/ChatContent';\r\nimport { AlertTriangle } from 'lucide-react';\r\n\r\nexport default function AdminMessagesPage() {\r\n  const {\r\n    // Auth & Users\r\n    // user, // unused\r\n    isAdmin,\r\n    username,\r\n\r\n    // Collections\r\n    allUsers,\r\n\r\n    // Messages & Threads\r\n    threads,\r\n    unreadCounts,\r\n    lastMessages,\r\n    userProfiles,\r\n    activeMessages,\r\n    totalUnreadCount,\r\n\r\n    // State\r\n    content,\r\n    setContent,\r\n    activeThread,\r\n    searchQuery,\r\n    setSearchQuery,\r\n    selectedImage,\r\n    setSelectedImage,\r\n    filterBy,\r\n    setFilterBy,\r\n    showUserDirectory,\r\n    setShowUserDirectory,\r\n    directorySearchQuery,\r\n    setDirectorySearchQuery,\r\n\r\n    // Computed\r\n    isUserBlocked,\r\n    isUserReported,\r\n\r\n    // Handlers\r\n    handleSend,\r\n    handleBlockToggle,\r\n    handleReport,\r\n    handleThreadSelect,\r\n    handleStartConversation\r\n  } = useAdminMessages();\r\n\r\n  // Render access denied if not admin\r\n  if (!isAdmin) {\r\n    return (\r\n      <RequireAuth role=\"admin\">\r\n        <div className=\"h-screen flex items-center justify-center bg-black\">\r\n          <div className=\"bg-[#121212] rounded-lg shadow-lg p-8 max-w-md\">\r\n            <div className=\"flex items-center mb-4\">\r\n              <AlertTriangle size={32} className=\"text-[#ff950e] mr-3\" />\r\n              <h1 className=\"text-2xl font-bold text-[#ff950e]\">Access Denied</h1>\r\n            </div>\r\n            <p className=\"text-gray-300\">Only admin users can access this page.</p>\r\n            <p className=\"text-gray-400 text-sm mt-2\">Please log in with an admin account.</p>\r\n          </div>\r\n        </div>\r\n      </RequireAuth>\r\n    );\r\n  }\r\n\r\n  // Defensive fallbacks to prevent undefined-prop crashes in child components\r\n  const safeThreads = threads ?? [];\r\n  const safeUnreadCounts = unreadCounts ?? {};\r\n  const safeLastMessages = lastMessages ?? {};\r\n  const safeUserProfiles = userProfiles ?? {};\r\n  const safeActiveMessages = activeMessages ?? [];\r\n  const safeUsername = username ?? '';\r\n  const safeAllUsers = allUsers ?? [];\r\n\r\n  return (\r\n    <RequireAuth role=\"admin\">\r\n      <div className=\"py-3 bg-black\"></div>\r\n\r\n      <div className=\"h-screen bg-black flex flex-col overflow-hidden\">\r\n        <div className=\"flex-1 flex flex-col md:flex-row max-w-6xl mx-auto w-full bg-[#121212] rounded-lg shadow-lg overflow-hidden\">\r\n          {/* Left column - Message threads and User Directory */}\r\n          <div className=\"w-full md:w-1/3 border-r border-gray-800 flex flex-col bg-[#121212]\">\r\n            <MessagesHeader\r\n              filterBy={filterBy}\r\n              setFilterBy={setFilterBy}\r\n              totalUnreadCount={totalUnreadCount ?? 0}\r\n              showUserDirectory={showUserDirectory}\r\n              setShowUserDirectory={setShowUserDirectory}\r\n              searchQuery={searchQuery ?? ''}\r\n              setSearchQuery={setSearchQuery}\r\n              directorySearchQuery={directorySearchQuery ?? ''}\r\n              setDirectorySearchQuery={setDirectorySearchQuery}\r\n            />\r\n\r\n            {/* Content Area - Either Conversations or User Directory */}\r\n            <div className=\"flex-1 overflow-y-auto bg-[#121212]\">\r\n              {showUserDirectory ? (\r\n                <UserDirectoryContent\r\n                  allUsers={safeAllUsers}\r\n                  directorySearchQuery={directorySearchQuery ?? ''}\r\n                  filterBy={filterBy}\r\n                  onStartConversation={handleStartConversation}\r\n                  onClearFilters={() => {\r\n                    setDirectorySearchQuery('');\r\n                    setFilterBy('all');\r\n                  }}\r\n                />\r\n              ) : (\r\n                <ConversationsContent\r\n                  threads={safeThreads}\r\n                  lastMessages={safeLastMessages}\r\n                  unreadCounts={safeUnreadCounts}\r\n                  userProfiles={safeUserProfiles}\r\n                  activeThread={activeThread}\r\n                  searchQuery={searchQuery ?? ''}\r\n                  filterBy={filterBy}\r\n                  onThreadSelect={handleThreadSelect}\r\n                  onStartNewConversation={() => setShowUserDirectory(true)}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Right column - Active conversation */}\r\n          <div className=\"w-full md:w-2/3 flex flex-col bg-[#121212]\">\r\n            <ChatContent\r\n              activeThread={activeThread}\r\n              activeMessages={safeActiveMessages}\r\n              userProfiles={safeUserProfiles}\r\n              content={content}\r\n              setContent={setContent}\r\n              selectedImage={selectedImage}\r\n              setSelectedImage={setSelectedImage}\r\n              isUserBlocked={isUserBlocked}\r\n              isUserReported={isUserReported}\r\n              onSend={handleSend}\r\n              onBlockToggle={handleBlockToggle}\r\n              onReport={handleReport}\r\n              onStartNewConversation={() => setShowUserDirectory(true)}\r\n              username={safeUsername}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Bottom Padding */}\r\n        <div className=\"py-6 bg-black\"></div>\r\n      </div>\r\n    </RequireAuth>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;;;;;;;;AAUe,SAAS;IACtB,MAAM,EACJ,eAAe;IACf,kBAAkB;IAClB,OAAO,EACP,QAAQ,EAER,cAAc;IACd,QAAQ,EAER,qBAAqB;IACrB,OAAO,EACP,YAAY,EACZ,YAAY,EACZ,YAAY,EACZ,cAAc,EACd,gBAAgB,EAEhB,QAAQ;IACR,OAAO,EACP,UAAU,EACV,YAAY,EACZ,WAAW,EACX,cAAc,EACd,aAAa,EACb,gBAAgB,EAChB,QAAQ,EACR,WAAW,EACX,iBAAiB,EACjB,oBAAoB,EACpB,oBAAoB,EACpB,uBAAuB,EAEvB,WAAW;IACX,aAAa,EACb,cAAc,EAEd,WAAW;IACX,UAAU,EACV,iBAAiB,EACjB,YAAY,EACZ,kBAAkB,EAClB,uBAAuB,EACxB,GAAG,CAAA,GAAA,gIAAA,CAAA,mBAAgB,AAAD;IAEnB,oCAAoC;IACpC,IAAI,CAAC,SAAS;QACZ,qBACE,8OAAC,iIAAA,CAAA,UAAW;YAAC,MAAK;sBAChB,cAAA,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;;8CACb,8OAAC,wNAAA,CAAA,gBAAa;oCAAC,MAAM;oCAAI,WAAU;;;;;;8CACnC,8OAAC;oCAAG,WAAU;8CAAoC;;;;;;;;;;;;sCAEpD,8OAAC;4BAAE,WAAU;sCAAgB;;;;;;sCAC7B,8OAAC;4BAAE,WAAU;sCAA6B;;;;;;;;;;;;;;;;;;;;;;IAKpD;IAEA,4EAA4E;IAC5E,MAAM,cAAc,WAAW,EAAE;IACjC,MAAM,mBAAmB,gBAAgB,CAAC;IAC1C,MAAM,mBAAmB,gBAAgB,CAAC;IAC1C,MAAM,mBAAmB,gBAAgB,CAAC;IAC1C,MAAM,qBAAqB,kBAAkB,EAAE;IAC/C,MAAM,eAAe,YAAY;IACjC,MAAM,eAAe,YAAY,EAAE;IAEnC,qBACE,8OAAC,iIAAA,CAAA,UAAW;QAAC,MAAK;;0BAChB,8OAAC;gBAAI,WAAU;;;;;;0BAEf,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CAEb,8OAAC;gCAAI,WAAU;;kDACb,8OAAC,yJAAA,CAAA,UAAc;wCACb,UAAU;wCACV,aAAa;wCACb,kBAAkB,oBAAoB;wCACtC,mBAAmB;wCACnB,sBAAsB;wCACtB,aAAa,eAAe;wCAC5B,gBAAgB;wCAChB,sBAAsB,wBAAwB;wCAC9C,yBAAyB;;;;;;kDAI3B,8OAAC;wCAAI,WAAU;kDACZ,kCACC,8OAAC,+JAAA,CAAA,UAAoB;4CACnB,UAAU;4CACV,sBAAsB,wBAAwB;4CAC9C,UAAU;4CACV,qBAAqB;4CACrB,gBAAgB;gDACd,wBAAwB;gDACxB,YAAY;4CACd;;;;;iEAGF,8OAAC,+JAAA,CAAA,UAAoB;4CACnB,SAAS;4CACT,cAAc;4CACd,cAAc;4CACd,cAAc;4CACd,cAAc;4CACd,aAAa,eAAe;4CAC5B,UAAU;4CACV,gBAAgB;4CAChB,wBAAwB,IAAM,qBAAqB;;;;;;;;;;;;;;;;;0CAO3D,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC,sJAAA,CAAA,UAAW;oCACV,cAAc;oCACd,gBAAgB;oCAChB,cAAc;oCACd,SAAS;oCACT,YAAY;oCACZ,eAAe;oCACf,kBAAkB;oCAClB,eAAe;oCACf,gBAAgB;oCAChB,QAAQ;oCACR,eAAe;oCACf,UAAU;oCACV,wBAAwB,IAAM,qBAAqB;oCACnD,UAAU;;;;;;;;;;;;;;;;;kCAMhB,8OAAC;wBAAI,WAAU;;;;;;;;;;;;;;;;;;AAIvB","debugId":null}}]
}